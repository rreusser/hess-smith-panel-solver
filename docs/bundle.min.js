!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("d3/dist/d3.min.js"),require("earcut/dist/earcut.min.js")):"function"==typeof define&&define.amd?define(["d3/dist/d3.min.js","earcut/dist/earcut.min.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3,t.earcut.default)}(this,(function(t,e){"use strict";var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var a,o={exports:{}};var s=(a||(a=1,function(t){t.exports=function(){var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},e=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},n="\n";function r(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function i(t){var e=new Error("(regl) "+t);throw console.error(e),e}function a(t,e){t||i(e)}function o(t){return t?": "+t:""}function s(t,e,n){t in e||i("unknown parameter ("+t+")"+o(n)+". possible values: "+Object.keys(e).join())}function u(e,n){t(e)||i("invalid parameter type"+o(n)+". must be a typed array")}function l(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function c(t,e,n){l(t,e)||i("invalid parameter type"+o(n)+". expected "+e+", got "+typeof t)}function f(t,e){t>=0&&(0|t)===t||i("invalid parameter type, ("+t+")"+o(e)+". must be a nonnegative integer")}function p(t,e,n){e.indexOf(t)<0&&i("invalid value"+o(n)+". must be one of: "+e)}var h=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function d(t){Object.keys(t).forEach((function(t){h.indexOf(t)<0&&i('invalid regl constructor argument "'+t+'". must be one of '+h)}))}function v(t,e){for(t+="";t.length<e;)t=" "+t;return t}function m(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(t,e){this.number=t,this.line=e,this.errors=[]}function g(t,e,n){this.file=t,this.line=e,this.message=n}function y(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function w(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function _(t,e){var n=t.split("\n"),i=1,a=0,o={unknown:new m,0:new m};o.unknown.name=o[0].name=e||y(),o.unknown.lines.push(new b(0,""));for(var s=0;s<n.length;++s){var u=n[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((a=0|c[2])in o||(o[a]=new m)));break;case"define":var f=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);f&&(o[a].name=f[1]?r(f[2]):f[2])}o[a].lines.push(new b(i++,u))}return Object.keys(o).forEach((function(t){var e=o[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),o}function x(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new g(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new g("unknown",0,t))}})),e}function k(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function C(t,e,r,i,o){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var s=t.getShaderInfoLog(e),u=i===t.FRAGMENT_SHADER?"fragment":"vertex";O(r,"string",u+" shader source must be a string",o);var l=_(r,o),c=x(s);k(l,c),Object.keys(l).forEach((function(t){var e=l[t];if(e.hasErrors){var r=[""],i=[""];a("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){a(v(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),a(t.line+n,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(r){var i=r.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(o){var s=o[1];i=o[2],"assign"===s&&(s="="),e=Math.max(t.line.indexOf(s,e),0)}else e=0;a(v("| ",6)),a(v("^^^",e+3)+n,"font-weight:bold"),a(v("| ",6)),a(i+n,"font-weight:bold")})),a(v("| ",6)+n)}else a(v(t.number,4)+"|  "),a(t.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function a(t,e){r.push(t),i.push(e||"")}})),a.raise("Error compiling "+u+" shader, "+l[0].name)}}function E(t,e,r,i,o){if(!t.getProgramParameter(e,t.LINK_STATUS)){var s=t.getProgramInfoLog(e),u=_(r,o),l='Error linking program with vertex shader, "'+_(i,o)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+n+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+n+s),a.raise(l)}}function A(t){t._commandRef=y()}function P(t,e,n,r){function i(t){return t?r.id(t):0}function a(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}A(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var o=t._uniformSet={};a(o,e.static),a(o,e.dynamic);var s=t._attributeSet={};a(s,n.static),a(s,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function S(t,e){var n=w();i(t+" in command "+(e||y())+("unknown"===n?"":" called from "+n))}function V(t,e,n){t||S(e,n||y())}function j(t,e,n,r){t in e||S("unknown parameter ("+t+")"+o(n)+". possible values: "+Object.keys(e).join(),r||y())}function O(t,e,n,r){l(t,e)||S("invalid parameter type"+o(n)+". expected "+e+", got "+typeof t,r||y())}function M(t){t()}function D(t,e,n){t.texture?p(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):p(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var T=33071,B=9728,I=9984,R=9985,L=9986,z=9987,N=5121,U=5122,F=5123,q=5124,K=5125,G=5126,$=32819,H=32820,Y=33635,W=34042,X=36193,Q={};function Z(t,e){return t===H||t===$||t===Y?2:t===W?4:Q[t]*e}function J(t){return!(t&t-1||!t)}function tt(t,e,n){var r,i=e.width,o=e.height,s=e.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),t.wrapS===T&&t.wrapT===T||a(J(i)&&J(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==o&&a(t.minFilter!==I&&t.minFilter!==L&&t.minFilter!==R&&t.minFilter!==z,"min filter requires mipmap"):(a(J(i)&&J(o),"texture must be a square power of 2 to support mipmapping"),a(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===G&&(n.extensions.indexOf("oes_texture_float_linear")<0&&a(t.minFilter===B&&t.magFilter===B,"filter not supported, must enable oes_texture_float_linear"),a(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=o>>r;a(e.mipmask&1<<r,"missing mipmap data");var f=u[r];if(a(f.width===l&&f.height===c,"invalid shape for mip images"),a(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed);else if(f.data){var p=Math.ceil(Z(f.type,s)*l/f.unpackAlignment)*f.unpackAlignment;a(f.data.byteLength===p*c,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else t.genMipmaps||a(!(e.mipmask&1<<r),"extra mipmap data");e.compressed&&a(!t.genMipmaps,"mipmap generation for compressed images not supported")}function et(t,e,n,r){var i=t.width,o=t.height,s=t.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),a(i===o,"cube map must be square"),a(e.wrapS===T&&e.wrapT===T,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];a(l.width===i&&l.height===o,"inconsistent cube map face shape"),e.genMipmaps&&(a(!l.compressed,"can not generate mipmap for compressed textures"),a(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,f=0;f<16;++f){var p=c[f];if(p){var h=i>>f,d=o>>f;a(l.mipmask&1<<f,"missing mipmap data"),a(p.width===h&&p.height===d,"invalid shape for mip images"),a(p.format===t.format&&p.internalformat===t.internalformat&&p.type===t.type,"incompatible type for mip image"),p.compressed||(p.data?a(p.data.byteLength===h*d*Math.max(Z(p.type,s),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):p.element||p.copy)}}}}Q[5120]=Q[N]=1,Q[U]=Q[F]=Q[X]=Q[Y]=Q[$]=Q[H]=2,Q[q]=Q[K]=Q[G]=Q[W]=4;var nt=e(a,{optional:M,raise:i,commandRaise:S,command:V,parameter:s,commandParameter:j,constructor:d,type:c,commandType:O,isTypedArray:u,nni:f,oneOf:p,shaderError:C,linkError:E,callSite:w,saveCommandRef:A,saveDrawInfo:P,framebufferFormat:D,guessCommand:y,texture2D:tt,textureCube:et}),rt=0,it=0,at=5,ot=6;function st(t,e){this.id=rt++,this.type=t,this.data=e}function ut(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function lt(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+ut(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return lt(t.substr(0,r.index)).concat(lt(r[1])).concat(lt(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+ut(t)+'"'];for(var a=[],o=0;o<i.length;++o)a=a.concat(lt(i[o]));return a}function ct(t){return"["+lt(t).join("][")+"]"}function ft(t,e){return new st(t,ct(e+""))}function pt(t){return"function"==typeof t&&!t._reglType||t instanceof st}function ht(t,e){return"function"==typeof t?new st(it,t):"number"==typeof t||"boolean"==typeof t?new st(at,t):Array.isArray(t)?new st(ot,t.map((function(t,n){return ht(t,e+"["+n+"]")}))):t instanceof st?t:void nt(!1,"invalid option type in uniform "+e)}var dt={DynamicVariable:st,define:ft,isDynamic:pt,unbox:ht,accessor:ct},vt={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},mt="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function bt(){var t={"":0},e=[""];return{id:function(n){var r=t[n];return r||(r=t[n]=e.length,e.push(n),r)},str:function(t){return e[t]}}}function gt(t,n,r){var i,a=document.createElement("canvas");function o(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=a.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}a.width=r*e,a.height=r*n}function s(){i?i.disconnect():window.removeEventListener("resize",o),t.removeChild(a)}return e(a.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(a),t===document.body&&(a.style.position="absolute",e(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(o)}))).observe(t):window.addEventListener("resize",o,!1),o(),{canvas:a,onDestroy:s}}function yt(t,e){function n(n){try{return t.getContext(n,e)}catch(t){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function wt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function _t(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function xt(t){return"string"==typeof t?t.split():(nt(Array.isArray(t),"invalid extension array"),t)}function kt(t){return"string"==typeof t?(nt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function Ct(t){var e,n,r,i,a=t||{},o={},s=[],u=[],l="undefined"==typeof window?1:window.devicePixelRatio,c=!1,f=function(t){t&&nt.raise(t)},p=function(){};if("string"==typeof a?(nt("undefined"!=typeof document,"selector queries only supported in DOM environments"),e=document.querySelector(a),nt(e,"invalid query string for element")):"object"==typeof a?wt(a)?e=a:_t(a)?r=(i=a).canvas:(nt.constructor(a),"gl"in a?i=a.gl:"canvas"in a?r=kt(a.canvas):"container"in a&&(n=kt(a.container)),"attributes"in a&&(o=a.attributes,nt.type(o,"object","invalid context attributes")),"extensions"in a&&(s=xt(a.extensions)),"optionalExtensions"in a&&(u=xt(a.optionalExtensions)),"onDone"in a&&(nt.type(a.onDone,"function","invalid or missing onDone callback"),f=a.onDone),"profile"in a&&(c=!!a.profile),"pixelRatio"in a&&(l=+a.pixelRatio,nt(l>0,"invalid pixel ratio"))):nt.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?r=e:n=e),!i){if(!r){nt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var h=gt(n||document.body,f,l);if(!h)return null;r=h.canvas,p=h.onDestroy}void 0===o.premultipliedAlpha&&(o.premultipliedAlpha=!0),i=yt(r,o)}return i?{gl:i,canvas:r,container:n,extensions:s,optionalExtensions:u,pixelRatio:l,profile:c,onDone:f,onDestroy:p}:(p(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Et(t,e){var n={};function r(e){nt.type(e,"string","extension name must be string");var r,i=e.toLowerCase();try{r=n[i]=t.getExtension(i)}catch(t){}return!!r}for(var i=0;i<e.extensions.length;++i){var a=e.extensions[i];if(!r(a))return e.onDestroy(),e.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function At(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}var Pt=5120,St=5121,Vt=5122,jt=5123,Ot=5124,Mt=5125,Dt=5126;function Tt(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function Bt(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function It(){var t=At(8,(function(){return[]}));function e(e){var n=Tt(e),r=t[Bt(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[Bt(e.byteLength)>>2].push(e)}function r(t,n){var r=null;switch(t){case Pt:r=new Int8Array(e(n),0,n);break;case St:r=new Uint8Array(e(n),0,n);break;case Vt:r=new Int16Array(e(2*n),0,n);break;case jt:r=new Uint16Array(e(2*n),0,n);break;case Ot:r=new Int32Array(e(4*n),0,n);break;case Mt:r=new Uint32Array(e(4*n),0,n);break;case Dt:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(t){n(t.buffer)}return{alloc:e,free:n,allocType:r,freeType:i}}var Rt=It();Rt.zero=It();var Lt=3408,zt=3410,Nt=3411,Ut=3412,Ft=3413,qt=3414,Kt=3415,Gt=33901,$t=33902,Ht=3379,Yt=3386,Wt=34921,Xt=36347,Qt=36348,Zt=35661,Jt=35660,te=34930,ee=36349,ne=34076,re=34024,ie=7936,ae=7937,oe=7938,se=35724,ue=34047,le=36063,ce=34852,fe=3553,pe=34067,he=34069,de=33984,ve=6408,me=5126,be=5121,ge=36160,ye=36053,we=36064,_e=16384,xe=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(ue));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(ce),i=t.getParameter(le));var a=!!e.oes_texture_float;if(a){var o=t.createTexture();t.bindTexture(fe,o),t.texImage2D(fe,0,ve,1,1,0,ve,me,null);var s=t.createFramebuffer();if(t.bindFramebuffer(ge,s),t.framebufferTexture2D(ge,we,fe,o,0),t.bindTexture(fe,null),t.checkFramebufferStatus(ge)!==ye)a=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(_e);var u=Rt.allocType(me,4);t.readPixels(0,0,1,1,ve,me,u),t.getError()?a=!1:(t.deleteFramebuffer(s),t.deleteTexture(o),a=1===u[0]),Rt.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=t.createTexture(),f=Rt.allocType(be,36);t.activeTexture(de),t.bindTexture(pe,c),t.texImage2D(he,0,ve,3,3,0,ve,be,f),Rt.freeType(f),t.bindTexture(pe,null),t.deleteTexture(c),l=!t.getError()}return{colorBits:[t.getParameter(zt),t.getParameter(Nt),t.getParameter(Ut),t.getParameter(Ft)],depthBits:t.getParameter(qt),stencilBits:t.getParameter(Kt),subpixelBits:t.getParameter(Lt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(Gt),lineWidthDims:t.getParameter($t),maxViewportDims:t.getParameter(Yt),maxCombinedTextureUnits:t.getParameter(Zt),maxCubeMapSize:t.getParameter(ne),maxRenderbufferSize:t.getParameter(re),maxTextureUnits:t.getParameter(te),maxTextureSize:t.getParameter(Ht),maxAttributes:t.getParameter(Wt),maxVertexUniforms:t.getParameter(Xt),maxVertexTextureUnits:t.getParameter(Jt),maxVaryingVectors:t.getParameter(Qt),maxFragmentUniforms:t.getParameter(ee),glsl:t.getParameter(se),renderer:t.getParameter(ae),vendor:t.getParameter(ie),version:t.getParameter(oe),readFloat:a,npotTextureCube:l}};function ke(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var Ce=function(t){return Object.keys(t).map((function(e){return t[e]}))},Ee={shape:Oe,flatten:je};function Ae(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}function Pe(t,e,n,r){for(var i=0,a=0;a<e;++a)for(var o=t[a],s=0;s<n;++s)r[i++]=o[s]}function Se(t,e,n,r,i,a){for(var o=a,s=0;s<e;++s)for(var u=t[s],l=0;l<n;++l)for(var c=u[l],f=0;f<r;++f)i[o++]=c[f]}function Ve(t,e,n,r,i){for(var a=1,o=n+1;o<e.length;++o)a*=e[o];var s=e[n];if(e.length-n==4){var u=e[n+1],l=e[n+2],c=e[n+3];for(o=0;o<s;++o)Se(t[o],u,l,c,r,i),i+=a}else for(o=0;o<s;++o)Ve(t[o],e,n+1,r,i),i+=a}function je(t,e,n,r){var i=1;if(e.length)for(var a=0;a<e.length;++a)i*=e[a];else i=0;var o=r||Rt.allocType(n,i);switch(e.length){case 0:break;case 1:Ae(t,e[0],o);break;case 2:Pe(t,e[0],e[1],o);break;case 3:Se(t,e[0],e[1],e[2],o,0);break;default:Ve(t,e,0,o,0)}return o}function Oe(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var Me={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},De={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Te={dynamic:35048,stream:35040,static:35044},Be=Ee.flatten,Ie=Ee.shape,Re=35044,Le=35040,ze=5121,Ne=5126,Ue=[];function Fe(t){return 0|Me[Object.prototype.toString.call(t)]}function qe(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function Ke(t,e,n,r,i,a,o){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)t[s++]=e[i*u+a*l+o]}function Ge(e,n,r,i){var a=0,o={};function s(t){this.id=a++,this.buffer=e.createBuffer(),this.type=t,this.usage=Re,this.byteLength=0,this.dimension=1,this.dtype=ze,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function l(t,e){var n=u.pop();return n||(n=new s(t)),n.bind(),p(n,e,Le,0,1,!1),n}function c(t){u.push(t)}function f(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function p(e,n,r,i,a,o){var s,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||Ne,n.length>0)if(Array.isArray(n[0])){s=Ie(n);for(var l=1,c=1;c<s.length;++c)l*=s[c];e.dimension=l,f(e,u=Be(n,s,e.dtype),r),o?e.persistentData=u:Rt.freeType(u)}else if("number"==typeof n[0]){e.dimension=a;var p=Rt.allocType(e.dtype,n.length);qe(p,n),f(e,p,r),o?e.persistentData=p:Rt.freeType(p)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||Fe(n[0])||Ne,f(e,u=Be(n,[n.length,n[0].length],e.dtype),r),o?e.persistentData=u:Rt.freeType(u)):nt.raise("invalid buffer data")}else if(t(n))e.dtype=i||Fe(n),e.dimension=a,f(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(ke(n)){s=n.shape;var h=n.stride,d=n.offset,v=0,m=0,b=0,g=0;1===s.length?(v=s[0],m=1,b=h[0],g=0):2===s.length?(v=s[0],m=s[1],b=h[0],g=h[1]):nt.raise("invalid shape"),e.dtype=i||Fe(n.data)||Ne,e.dimension=m;var y=Rt.allocType(e.dtype,v*m);Ke(y,n.data,v,m,b,g,d),f(e,y,r),o?e.persistentData=y:Rt.freeType(y)}else n instanceof ArrayBuffer?(e.dtype=ze,e.dimension=a,f(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):nt.raise("invalid buffer data")}function h(t){n.bufferCount--,i(t);var r=t.buffer;nt(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete o[t.id]}function d(i,a,u,l){n.bufferCount++;var c=new s(a);function f(n){var i=Re,a=null,o=0,s=0,u=1;return Array.isArray(n)||t(n)||ke(n)||n instanceof ArrayBuffer?a=n:"number"==typeof n?o=0|n:n&&(nt.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(nt(null===a||Array.isArray(a)||t(a)||ke(a),"invalid data for buffer"),a=n.data),"usage"in n&&(nt.parameter(n.usage,Te,"invalid buffer usage"),i=Te[n.usage]),"type"in n&&(nt.parameter(n.type,De,"invalid buffer type"),s=De[n.type]),"dimension"in n&&(nt.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(nt.nni(o,"buffer length must be a nonnegative integer"),o=0|n.length)),c.bind(),a?p(c,a,i,s,u,l):(o&&e.bufferData(c.type,o,i),c.dtype=s||ze,c.usage=i,c.dimension=u,c.byteLength=o),r.profile&&(c.stats.size=c.byteLength*Ue[c.dtype]),f}function d(t,n){nt(n+t.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+c.byteLength),e.bufferSubData(c.type,n,t)}function v(e,n){var r,i=0|(n||0);if(c.bind(),t(e)||e instanceof ArrayBuffer)d(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var a=Rt.allocType(c.dtype,e.length);qe(a,e),d(a,i),Rt.freeType(a)}else if(Array.isArray(e[0])||t(e[0])){r=Ie(e);var o=Be(e,r,c.dtype);d(o,i),Rt.freeType(o)}else nt.raise("invalid buffer data")}else if(ke(e)){r=e.shape;var s=e.stride,u=0,l=0,p=0,h=0;1===r.length?(u=r[0],l=1,p=s[0],h=0):2===r.length?(u=r[0],l=r[1],p=s[0],h=s[1]):nt.raise("invalid shape");var v=Array.isArray(e.data)?c.dtype:Fe(e.data),m=Rt.allocType(v,u*l);Ke(m,e.data,u,l,p,h,e.offset),d(m,i),Rt.freeType(m)}else nt.raise("invalid data for buffer subdata");return f}return o[c.id]=c,u||f(i),f._reglType="buffer",f._buffer=c,f.subdata=v,r.profile&&(f.stats=c.stats),f.destroy=function(){h(c)},f}function v(){Ce(o).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(o).forEach((function(e){t+=o[e].stats.size})),t}),{create:d,createStream:l,destroyStream:c,clear:function(){Ce(o).forEach(h),u.forEach(h)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:v,_initBuffer:p}}Ue[5120]=1,Ue[5122]=2,Ue[5124]=4,Ue[5121]=1,Ue[5123]=2,Ue[5125]=4,Ue[5126]=4;var $e={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},He=0,Ye=1,We=4,Xe=5120,Qe=5121,Ze=5122,Je=5123,tn=5124,en=5125,nn=34963,rn=35040,an=35044;function on(e,n,r,i){var a={},o=0,s={uint8:Qe,uint16:Je};function u(t){this.id=o++,a[this.id]=this,this.buffer=t,this.primType=We,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=en),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(t){var e=l.pop();return e||(e=new u(r.create(null,nn,!0,!1)._buffer)),p(e,t,rn,-1,-1,0,0),e}function f(t){l.push(t)}function p(i,a,o,s,u,l,c){var f;if(i.buffer.bind(),a){var p=c;c||t(a)&&(!ke(a)||t(a.data))||(p=n.oes_element_index_uint?en:Je),r._initBuffer(i.buffer,a,o,p,3)}else e.bufferData(nn,l,o),i.buffer.dtype=f||Qe,i.buffer.usage=o,i.buffer.dimension=3,i.buffer.byteLength=l;if(f=c,!c){switch(i.buffer.dtype){case Qe:case Xe:f=Qe;break;case Je:case Ze:f=Je;break;case en:case tn:f=en;break;default:nt.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,nt(f!==en||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var h=u;h<0&&(h=i.buffer.byteLength,f===Je?h>>=1:f===en&&(h>>=2)),i.vertCount=h;var d=s;if(s<0){d=We;var v=i.buffer.dimension;1===v&&(d=He),2===v&&(d=Ye),3===v&&(d=We)}i.primType=d}function h(t){i.elementsCount--,nt(null!==t.buffer,"must not double destroy elements"),delete a[t.id],t.buffer.destroy(),t.buffer=null}function d(e,n){var a=r.create(null,nn,!0),o=new u(a._buffer);function l(e){if(e)if("number"==typeof e)a(e),o.primType=We,o.vertCount=0|e,o.type=Qe;else{var n=null,r=an,i=-1,u=-1,c=0,f=0;Array.isArray(e)||t(e)||ke(e)?n=e:(nt.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,nt(Array.isArray(n)||t(n)||ke(n),"invalid data for element buffer")),"usage"in e&&(nt.parameter(e.usage,Te,"invalid element buffer usage"),r=Te[e.usage]),"primitive"in e&&(nt.parameter(e.primitive,$e,"invalid element buffer primitive"),i=$e[e.primitive]),"count"in e&&(nt("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(nt.parameter(e.type,s,"invalid buffer type"),f=s[e.type]),"length"in e?c=0|e.length:(c=u,f===Je||f===Ze?c*=2:f!==en&&f!==tn||(c*=4))),p(o,n,r,i,u,c,f)}else a(),o.primType=We,o.vertCount=0,o.type=Qe;return l}return i.elementsCount++,l(e),l._reglType="elements",l._elements=o,l.subdata=function(t,e){return a.subdata(t,e),l},l.destroy=function(){h(o)},l}return{create:d,createStream:c,destroyStream:f,getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){Ce(a).forEach(h)}}}var sn=new Float32Array(1),un=new Uint32Array(sn.buffer),ln=5123;function cn(t){for(var e=Rt.allocType(ln,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{sn[0]=t[n];var r=un[0],i=r>>>31<<15,a=(r<<1>>>24)-127,o=r>>13&1023;if(a<-24)e[n]=i;else if(a<-14){var s=-14-a;e[n]=i+(o+1024>>s)}else e[n]=a>15?i+31744:i+(a+15<<10)+o}return e}function fn(e){return Array.isArray(e)||t(e)}var pn=function(t){return!(t&t-1||!t)},hn=34467,dn=3553,vn=34067,mn=34069,bn=6408,gn=6406,yn=6407,wn=6409,_n=6410,xn=32854,kn=32855,Cn=36194,En=32819,An=32820,Pn=33635,Sn=34042,Vn=6402,jn=34041,On=35904,Mn=35906,Dn=36193,Tn=33776,Bn=33777,In=33778,Rn=33779,Ln=35986,zn=35987,Nn=34798,Un=35840,Fn=35841,qn=35842,Kn=35843,Gn=36196,$n=5121,Hn=5123,Yn=5125,Wn=5126,Xn=10242,Qn=10243,Zn=10497,Jn=33071,tr=33648,er=10240,nr=10241,rr=9728,ir=9729,ar=9984,or=9985,sr=9986,ur=9987,lr=33170,cr=4352,fr=4353,pr=4354,hr=34046,dr=3317,vr=37440,mr=37441,br=37443,gr=37444,yr=33984,wr=[ar,sr,or,ur],_r=[0,wn,_n,yn,bn],xr={};function kr(t){return"[object "+t+"]"}xr[wn]=xr[gn]=xr[Vn]=1,xr[jn]=xr[_n]=2,xr[yn]=xr[On]=3,xr[bn]=xr[Mn]=4;var Cr=kr("HTMLCanvasElement"),Er=kr("OffscreenCanvas"),Ar=kr("CanvasRenderingContext2D"),Pr=kr("ImageBitmap"),Sr=kr("HTMLImageElement"),Vr=kr("HTMLVideoElement"),jr=Object.keys(Me).concat([Cr,Er,Ar,Pr,Sr,Vr]),Or=[];Or[$n]=1,Or[Wn]=4,Or[Dn]=2,Or[Hn]=2,Or[Yn]=4;var Mr=[];function Dr(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function Tr(t){return!!Array.isArray(t)&&!(0===t.length||!fn(t[0]))}function Br(t){return Object.prototype.toString.call(t)}function Ir(t){return Br(t)===Cr}function Rr(t){return Br(t)===Er}function Lr(t){return Br(t)===Ar}function zr(t){return Br(t)===Pr}function Nr(t){return Br(t)===Sr}function Ur(t){return Br(t)===Vr}function Fr(t){if(!t)return!1;var e=Br(t);return jr.indexOf(e)>=0||Dr(t)||Tr(t)||ke(t)}function qr(t){return 0|Me[Object.prototype.toString.call(t)]}function Kr(t,e){var n=e.length;switch(t.type){case $n:case Hn:case Yn:case Wn:var r=Rt.allocType(t.type,n);r.set(e),t.data=r;break;case Dn:t.data=cn(e);break;default:nt.raise("unsupported texture type, must specify a typed array")}}function Gr(t,e){return Rt.allocType(t.type===Dn?Wn:t.type,e)}function $r(t,e){t.type===Dn?(t.data=cn(e),Rt.freeType(e)):t.data=e}function Hr(t,e,n,r,i,a){for(var o=t.width,s=t.height,u=t.channels,l=Gr(t,o*s*u),c=0,f=0;f<s;++f)for(var p=0;p<o;++p)for(var h=0;h<u;++h)l[c++]=e[n*p+r*f+i*h+a];$r(t,l)}function Yr(t,e,n,r,i,a){var o;if(o=void 0!==Mr[t]?Mr[t]:xr[t]*Or[e],a&&(o*=6),i){for(var s=0,u=n;u>=1;)s+=o*u*u,u/=2;return s}return o*n*r}function Wr(n,r,i,a,o,s,u){var l={"don't care":cr,"dont care":cr,nice:pr,fast:fr},c={repeat:Zn,clamp:Jn,mirror:tr},f={nearest:rr,linear:ir},p=e({mipmap:ur,"nearest mipmap nearest":ar,"linear mipmap nearest":or,"nearest mipmap linear":sr,"linear mipmap linear":ur},f),h={none:0,browser:gr},d={uint8:$n,rgba4:En,rgb565:Pn,"rgb5 a1":An},v={alpha:gn,luminance:wn,"luminance alpha":_n,rgb:yn,rgba:bn,rgba4:xn,"rgb5 a1":kn,rgb565:Cn},m={};r.ext_srgb&&(v.srgb=On,v.srgba=Mn),r.oes_texture_float&&(d.float32=d.float=Wn),r.oes_texture_half_float&&(d.float16=d["half float"]=Dn),r.webgl_depth_texture&&(e(v,{depth:Vn,"depth stencil":jn}),e(d,{uint16:Hn,uint32:Yn,"depth stencil":Sn})),r.webgl_compressed_texture_s3tc&&e(m,{"rgb s3tc dxt1":Tn,"rgba s3tc dxt1":Bn,"rgba s3tc dxt3":In,"rgba s3tc dxt5":Rn}),r.webgl_compressed_texture_atc&&e(m,{"rgb atc":Ln,"rgba atc explicit alpha":zn,"rgba atc interpolated alpha":Nn}),r.webgl_compressed_texture_pvrtc&&e(m,{"rgb pvrtc 4bppv1":Un,"rgb pvrtc 2bppv1":Fn,"rgba pvrtc 4bppv1":qn,"rgba pvrtc 2bppv1":Kn}),r.webgl_compressed_texture_etc1&&(m["rgb etc1"]=Gn);var b=Array.prototype.slice.call(n.getParameter(hn));Object.keys(m).forEach((function(t){var e=m[t];b.indexOf(e)>=0&&(v[t]=e)}));var g=Object.keys(v);i.textureFormats=g;var y=[];Object.keys(v).forEach((function(t){var e=v[t];y[e]=t}));var w=[];Object.keys(d).forEach((function(t){var e=d[t];w[e]=t}));var _=[];Object.keys(f).forEach((function(t){var e=f[t];_[e]=t}));var x=[];Object.keys(p).forEach((function(t){var e=p[t];x[e]=t}));var k=[];Object.keys(c).forEach((function(t){var e=c[t];k[e]=t}));var C=g.reduce((function(t,e){var n=v[e];return n===wn||n===gn||n===wn||n===_n||n===Vn||n===jn||r.ext_srgb&&(n===On||n===Mn)?t[n]=n:n===kn||e.indexOf("rgba")>=0?t[n]=bn:t[n]=yn,t}),{});function E(){this.internalformat=bn,this.format=bn,this.type=$n,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=gr,this.width=0,this.height=0,this.channels=0}function A(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function P(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(nt.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(nt.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(nt.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(nt.parameter(e.colorSpace,h,"invalid colorSpace"),t.colorSpace=h[e.colorSpace]),"type"in e){var n=e.type;nt(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),nt(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),nt(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(n,d,"invalid texture type"),t.type=d[n]}var a=t.width,o=t.height,s=t.channels,u=!1;"shape"in e?(nt(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),a=e.shape[0],o=e.shape[1],3===e.shape.length&&(s=e.shape[2],nt(s>0&&s<=4,"invalid number of channels"),u=!0),nt(a>=0&&a<=i.maxTextureSize,"invalid width"),nt(o>=0&&o<=i.maxTextureSize,"invalid height")):("radius"in e&&(a=o=e.radius,nt(a>=0&&a<=i.maxTextureSize,"invalid radius")),"width"in e&&(a=e.width,nt(a>=0&&a<=i.maxTextureSize,"invalid width")),"height"in e&&(o=e.height,nt(o>=0&&o<=i.maxTextureSize,"invalid height")),"channels"in e&&(s=e.channels,nt(s>0&&s<=4,"invalid number of channels"),u=!0)),t.width=0|a,t.height=0|o,t.channels=0|s;var l=!1;if("format"in e){var c=e.format;nt(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(c,v,"invalid texture format");var f=t.internalformat=v[c];t.format=C[f],c in d&&("type"in e||(t.type=d[c])),c in m&&(t.compressed=!0),l=!0}!u&&l?t.channels=xr[t.format]:u&&!l?t.channels!==_r[t.format]&&(t.format=t.internalformat=_r[t.channels]):l&&u&&nt(t.channels===xr[t.format],"number of channels inconsistent with specified format")}}function S(t){n.pixelStorei(vr,t.flipY),n.pixelStorei(mr,t.premultiplyAlpha),n.pixelStorei(br,t.colorSpace),n.pixelStorei(dr,t.unpackAlignment)}function V(){E.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function j(e,n){var r=null;if(Fr(n)?r=n:n&&(nt.type(n,"object","invalid pixel data type"),P(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),Fr(n.data)&&(r=n.data)),nt(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){nt(!r,"can not specify copy and data field for the same texture");var a=o.viewportWidth,s=o.viewportHeight;e.width=e.width||a-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,nt(e.xOffset>=0&&e.xOffset<a&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=a&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||e.type!==$n||(e.type=qr(r));else if(Dr(r))e.channels=e.channels||4,Kr(e,r),e.alignment=1,e.needsFree=!0;else if(ke(r)){var u=r.data;Array.isArray(u)||e.type!==$n||(e.type=qr(u));var l,c,f,p,h,d,v=r.shape,m=r.stride;3===v.length?(f=v[2],d=m[2]):(nt(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,d=1),l=v[0],c=v[1],p=m[0],h=m[1],e.alignment=1,e.width=l,e.height=c,e.channels=f,e.format=e.internalformat=_r[f],e.needsFree=!0,Hr(e,u,p,h,d,r.offset)}else if(Ir(r)||Rr(r)||Lr(r))Ir(r)||Rr(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(zr(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(Nr(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Ur(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(Tr(r)){var b=e.width||r[0].length,g=e.height||r.length,y=e.channels;y=fn(r[0][0])?y||r[0][0].length:y||1;for(var w=Ee.shape(r),_=1,x=0;x<w.length;++x)_*=w[x];var k=Gr(e,_);Ee.flatten(r,w,"",k),$r(e,k),e.alignment=1,e.width=b,e.height=g,e.channels=y,e.format=e.internalformat=_r[y],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===Wn?nt(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===Dn&&nt(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function O(t,e,r){var i=t.element,o=t.data,s=t.internalformat,u=t.format,l=t.type,c=t.width,f=t.height;S(t),i?n.texImage2D(e,r,u,u,l,i):t.compressed?n.compressedTexImage2D(e,r,s,c,f,0,o):t.needsCopy?(a(),n.copyTexImage2D(e,r,u,t.xOffset,t.yOffset,c,f,0)):n.texImage2D(e,r,u,c,f,0,u,l,o||null)}function M(t,e,r,i,o){var s=t.element,u=t.data,l=t.internalformat,c=t.format,f=t.type,p=t.width,h=t.height;S(t),s?n.texSubImage2D(e,o,r,i,c,f,s):t.compressed?n.compressedTexSubImage2D(e,o,r,i,l,p,h,u):t.needsCopy?(a(),n.copyTexSubImage2D(e,o,r,i,t.xOffset,t.yOffset,p,h)):n.texSubImage2D(e,o,r,i,p,h,c,f,u)}var D=[];function T(){return D.pop()||new V}function B(t){t.needsFree&&Rt.freeType(t.data),V.call(t),D.push(t)}function I(){E.call(this),this.genMipmaps=!1,this.mipmapHint=cr,this.mipmask=0,this.images=Array(16)}function R(t,e,n){var r=t.images[0]=T();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function L(t,e){var n=null;if(Fr(e))A(n=t.images[0]=T(),t),j(n,e),t.mipmask=1;else if(P(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)A(n=t.images[i]=T(),t),n.width>>=i,n.height>>=i,j(n,r[i]),t.mipmask|=1<<i;else A(n=t.images[0]=T(),t),j(n,e),t.mipmask=1;A(t,t.images[0]),!t.compressed||t.internalformat!==Tn&&t.internalformat!==Bn&&t.internalformat!==In&&t.internalformat!==Rn||nt(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function z(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;O(n[r],e,r)}}var N=[];function U(){var t=N.pop()||new I;E.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function F(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&B(e[n]),e[n]=null;N.push(t)}function q(){this.minFilter=rr,this.magFilter=rr,this.wrapS=Jn,this.wrapT=Jn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=cr}function K(t,e){if("min"in e){var n=e.min;nt.parameter(n,p),t.minFilter=p[n],wr.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;nt.parameter(r,f),t.magFilter=f[r]}var a=t.wrapS,o=t.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(nt.parameter(s,c),a=o=c[s]):Array.isArray(s)&&(nt.parameter(s[0],c),nt.parameter(s[1],c),a=c[s[0]],o=c[s[1]])}else{if("wrapS"in e){var u=e.wrapS;nt.parameter(u,c),a=c[u]}if("wrapT"in e){var h=e.wrapT;nt.parameter(h,c),o=c[h]}}if(t.wrapS=a,t.wrapT=o,"anisotropic"in e){var d=e.anisotropic;nt("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var v=!1;switch(typeof e.mipmap){case"string":nt.parameter(e.mipmap,l,"invalid mipmap hint"),t.mipmapHint=l[e.mipmap],t.genMipmaps=!0,v=!0;break;case"boolean":v=t.genMipmaps=e.mipmap;break;case"object":nt(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,v=!0;break;default:nt.raise("invalid mipmap type")}v&&!("min"in e)&&(t.minFilter=ar)}}function G(t,e){n.texParameteri(e,nr,t.minFilter),n.texParameteri(e,er,t.magFilter),n.texParameteri(e,Xn,t.wrapS),n.texParameteri(e,Qn,t.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(e,hr,t.anisotropic),t.genMipmaps&&(n.hint(lr,t.mipmapHint),n.generateMipmap(e))}var $=0,H={},Y=i.maxTextureUnits,W=Array(Y).map((function(){return null}));function X(t){E.call(this),this.mipmask=0,this.internalformat=bn,this.id=$++,this.refCount=1,this.target=t,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new q,u.profile&&(this.stats={size:0})}function Q(t){n.activeTexture(yr),n.bindTexture(t.target,t.texture)}function Z(){var t=W[0];t?n.bindTexture(t.target,t.texture):n.bindTexture(dn,null)}function J(t){var e=t.texture;nt(e,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(n.activeTexture(yr+r),n.bindTexture(i,null),W[r]=null),n.deleteTexture(e),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete H[t.id],s.textureCount--}function tt(t,e){var r=new X(dn);function a(t,e){var n=r.texInfo;q.call(n);var o=U();return"number"==typeof t?R(o,0|t,"number"==typeof e?0|e:0|t):t?(nt.type(t,"object","invalid arguments to regl.texture"),K(n,t),L(o,t)):R(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),r.mipmask=o.mipmask,A(r,o),nt.texture2D(n,o,i),r.internalformat=o.internalformat,a.width=o.width,a.height=o.height,Q(r),z(o,dn),G(n,dn),Z(),F(o),u.profile&&(r.stats.size=Yr(r.internalformat,r.type,o.width,o.height,n.genMipmaps,!1)),a.format=y[r.internalformat],a.type=w[r.type],a.mag=_[n.magFilter],a.min=x[n.minFilter],a.wrapS=k[n.wrapS],a.wrapT=k[n.wrapT],a}function o(t,e,n,i){nt(!!t,"must specify image data");var o=0|e,s=0|n,u=0|i,l=T();return A(l,r),l.width=0,l.height=0,j(l,t),l.width=l.width||(r.width>>u)-o,l.height=l.height||(r.height>>u)-s,nt(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),nt(o>=0&&s>=0&&o+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),nt(r.mipmask&1<<u,"missing mipmap data"),nt(l.data||l.element||l.needsCopy,"missing image data"),Q(r),M(l,dn,o,s,u),Z(),B(l),a}function l(t,e){var i=0|t,o=0|e||i;if(i===r.width&&o===r.height)return a;a.width=r.width=i,a.height=r.height=o,Q(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=o>>s;if(!l||!c)break;n.texImage2D(dn,s,r.format,l,c,0,r.format,r.type,null)}return Z(),u.profile&&(r.stats.size=Yr(r.internalformat,r.type,i,o,!1,!1)),a}return H[r.id]=r,s.textureCount++,a(t,e),a.subimage=o,a.resize=l,a._reglType="texture2d",a._texture=r,u.profile&&(a.stats=r.stats),a.destroy=function(){r.decRef()},a}function et(t,e,r,a,o,l){var c=new X(vn);H[c.id]=c,s.cubeCount++;var f=new Array(6);function p(t,e,n,r,a,o){var s,l=c.texInfo;for(q.call(l),s=0;s<6;++s)f[s]=U();if("number"!=typeof t&&t)if("object"==typeof t)if(e)L(f[0],t),L(f[1],e),L(f[2],n),L(f[3],r),L(f[4],a),L(f[5],o);else if(K(l,t),P(c,t),"faces"in t){var h=t.faces;for(nt(Array.isArray(h)&&6===h.length,"cube faces must be a length 6 array"),s=0;s<6;++s)nt("object"==typeof h[s]&&!!h[s],"invalid input for cube map face"),A(f[s],c),L(f[s],h[s])}else for(s=0;s<6;++s)L(f[s],t);else nt.raise("invalid arguments to cube map");else{var d=0|t||1;for(s=0;s<6;++s)R(f[s],d,d)}for(A(c,f[0]),nt.optional((function(){i.npotTextureCube||nt(pn(c.width)&&pn(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(f[0].width<<1)-1:c.mipmask=f[0].mipmask,nt.textureCube(c,l,f,i),c.internalformat=f[0].internalformat,p.width=f[0].width,p.height=f[0].height,Q(c),s=0;s<6;++s)z(f[s],mn+s);for(G(l,vn),Z(),u.profile&&(c.stats.size=Yr(c.internalformat,c.type,p.width,p.height,l.genMipmaps,!0)),p.format=y[c.internalformat],p.type=w[c.type],p.mag=_[l.magFilter],p.min=x[l.minFilter],p.wrapS=k[l.wrapS],p.wrapT=k[l.wrapT],s=0;s<6;++s)F(f[s]);return p}function h(t,e,n,r,i){nt(!!e,"must specify image data"),nt("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var a=0|n,o=0|r,s=0|i,u=T();return A(u,c),u.width=0,u.height=0,j(u,e),u.width=u.width||(c.width>>s)-a,u.height=u.height||(c.height>>s)-o,nt(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),nt(a>=0&&o>=0&&a+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),nt(c.mipmask&1<<s,"missing mipmap data"),nt(u.data||u.element||u.needsCopy,"missing image data"),Q(c),M(u,mn+t,a,o,s),Z(),B(u),p}function d(t){var e=0|t;if(e!==c.width){p.width=c.width=e,p.height=c.height=e,Q(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)n.texImage2D(mn+r,i,c.format,e>>i,e>>i,0,c.format,c.type,null);return Z(),u.profile&&(c.stats.size=Yr(c.internalformat,c.type,p.width,p.height,!1,!0)),p}}return p(t,e,r,a,o,l),p.subimage=h,p.resize=d,p._reglType="textureCube",p._texture=c,u.profile&&(p.stats=c.stats),p.destroy=function(){c.decRef()},p}function rt(){for(var t=0;t<Y;++t)n.activeTexture(yr+t),n.bindTexture(dn,null),W[t]=null;Ce(H).forEach(J),s.cubeCount=0,s.textureCount=0}function it(){for(var t=0;t<Y;++t){var e=W[t];e&&(e.bindCount=0,e.unit=-1,W[t]=null)}Ce(H).forEach((function(t){t.texture=n.createTexture(),n.bindTexture(t.target,t.texture);for(var e=0;e<32;++e)if(t.mipmask&1<<e)if(t.target===dn)n.texImage2D(dn,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)n.texImage2D(mn+r,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);G(t.texInfo,t.target)}))}function at(){for(var t=0;t<Y;++t){var e=W[t];e&&(e.bindCount=0,e.unit=-1,W[t]=null),n.activeTexture(yr+t),n.bindTexture(dn,null),n.bindTexture(vn,null)}}return e(X.prototype,{bind:function(){var t=this;t.bindCount+=1;var e=t.unit;if(e<0){for(var r=0;r<Y;++r){var i=W[r];if(i){if(i.bindCount>0)continue;i.unit=-1}W[r]=t,e=r;break}e>=Y&&nt.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),t.unit=e,n.activeTexture(yr+e),n.bindTexture(t.target,t.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&J(this)}}),u.profile&&(s.getTotalTextureSize=function(){var t=0;return Object.keys(H).forEach((function(e){t+=H[e].stats.size})),t}),{create2D:tt,createCube:et,clear:rt,getTexture:function(t){return null},restore:it,refresh:at}}Mr[xn]=2,Mr[kn]=2,Mr[Cn]=2,Mr[jn]=4,Mr[Tn]=.5,Mr[Bn]=.5,Mr[In]=1,Mr[Rn]=1,Mr[Ln]=.5,Mr[zn]=1,Mr[Nn]=1,Mr[Un]=.5,Mr[Fn]=.25,Mr[qn]=.5,Mr[Kn]=.25,Mr[Gn]=.5;var Xr=36161,Qr=32854,Zr=32855,Jr=36194,ti=33189,ei=36168,ni=34041,ri=35907,ii=34836,ai=34842,oi=34843,si=[];function ui(t,e,n){return si[t]*e*n}si[Qr]=2,si[Zr]=2,si[Jr]=2,si[ti]=2,si[ei]=1,si[ni]=4,si[ri]=4,si[ii]=16,si[ai]=8,si[oi]=6;var li=function(t,e,n,r,i){var a={rgba4:Qr,rgb565:Jr,"rgb5 a1":Zr,depth:ti,stencil:ei,"depth stencil":ni};e.ext_srgb&&(a.srgba=ri),e.ext_color_buffer_half_float&&(a.rgba16f=ai,a.rgb16f=oi),e.webgl_color_buffer_float&&(a.rgba32f=ii);var o=[];Object.keys(a).forEach((function(t){var e=a[t];o[e]=t}));var s=0,u={};function l(t){this.id=s++,this.refCount=1,this.renderbuffer=t,this.format=Qr,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(e){var n=e.renderbuffer;nt(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(Xr,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}function f(e,s){var c=new l(t.createRenderbuffer());function f(e,r){var s=0,u=0,l=Qr;if("object"==typeof e&&e){var p=e;if("shape"in p){var h=p.shape;nt(Array.isArray(h)&&h.length>=2,"invalid renderbuffer shape"),s=0|h[0],u=0|h[1]}else"radius"in p&&(s=u=0|p.radius),"width"in p&&(s=0|p.width),"height"in p&&(u=0|p.height);"format"in p&&(nt.parameter(p.format,a,"invalid renderbuffer format"),l=a[p.format])}else"number"==typeof e?(s=0|e,u="number"==typeof r?0|r:s):e?nt.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(nt(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return f.width=c.width=s,f.height=c.height=u,c.format=l,t.bindRenderbuffer(Xr,c.renderbuffer),t.renderbufferStorage(Xr,l,s,u),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=ui(c.format,c.width,c.height)),f.format=o[c.format],f}function p(e,r){var a=0|e,o=0|r||a;return a===c.width&&o===c.height||(nt(a>0&&o>0&&a<=n.maxRenderbufferSize&&o<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=c.width=a,f.height=c.height=o,t.bindRenderbuffer(Xr,c.renderbuffer),t.renderbufferStorage(Xr,c.format,a,o),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=ui(c.format,c.width,c.height))),f}return u[c.id]=c,r.renderbufferCount++,f(e,s),f.resize=p,f._reglType="renderbuffer",f._renderbuffer=c,i.profile&&(f.stats=c.stats),f.destroy=function(){c.decRef()},f}function p(){Ce(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(Xr,e.renderbuffer),t.renderbufferStorage(Xr,e.format,e.width,e.height)})),t.bindRenderbuffer(Xr,null)}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:f,clear:function(){Ce(u).forEach(c)},restore:p}},ci=36160,fi=36161,pi=3553,hi=34069,di=36064,vi=36096,mi=36128,bi=33306,gi=36053,yi=36054,wi=36055,_i=36057,xi=36061,ki=36193,Ci=5121,Ei=5126,Ai=6407,Pi=6408,Si=6402,Vi=[Ai,Pi],ji=[];ji[Pi]=4,ji[Ai]=3;var Oi=[];Oi[Ci]=1,Oi[Ei]=4,Oi[ki]=2;var Mi=33189,Di=36168,Ti=34041,Bi=[32854,32855,36194,35907,34842,34843,34836],Ii={};function Ri(t,n,r,i,a,o){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&l.push("srgba"),n.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function f(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function h(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),a=Math.max(1,r.height);nt(i===e&&a===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var o=t.renderbuffer._renderbuffer;nt(o.width===e&&o.height===n,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function d(e,n){n&&(n.texture?t.framebufferTexture2D(ci,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(ci,e,fi,n.renderbuffer._renderbuffer.renderbuffer))}function v(t){var e=pi,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),nt.type(i,"function","invalid attachment data");var a=i._reglType;return"texture2d"===a?(n=i,nt(e===pi)):"textureCube"===a?(n=i,nt(e>=hi&&e<hi+6,"invalid cube map target")):"renderbuffer"===a?(r=i,e=fi):nt.raise("invalid regl object for attachment"),new f(e,n,r)}function m(t,e,n,r,o){if(n){var s=i.create2D({width:t,height:e,format:r,type:o});return s._texture.refCount=0,new f(pi,s,null)}var u=a.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new f(fi,null,u)}function b(t){return t&&(t.texture||t.renderbuffer)}function g(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}n.oes_texture_half_float&&c.push("half float","float16"),n.oes_texture_float&&c.push("float","float32");var y=0,w={};function _(){this.id=y++,w[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function x(t){t.colorAttachments.forEach(p),p(t.depthAttachment),p(t.stencilAttachment),p(t.depthStencilAttachment)}function k(e){var n=e.framebuffer;nt(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,o.framebufferCount--,delete w[e.id]}function C(e){var n;t.bindFramebuffer(ci,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)d(di+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(ci,di+n,pi,null,0);t.framebufferTexture2D(ci,bi,pi,null,0),t.framebufferTexture2D(ci,vi,pi,null,0),t.framebufferTexture2D(ci,mi,pi,null,0),d(vi,e.depthAttachment),d(mi,e.stencilAttachment),d(bi,e.depthStencilAttachment);var a=t.checkFramebufferStatus(ci);t.isContextLost()||a===gi||nt.raise("framebuffer configuration not supported, status = "+Ii[a]),t.bindFramebuffer(ci,s.next?s.next.framebuffer:null),s.cur=s.next,t.getError()}function E(t,i){var a=new _;function f(t,e){var i;nt(s.next!==a,"can not update framebuffer which is currently in use");var o=0,p=0,d=!0,g=!0,y=null,w=!0,_="rgba",k="uint8",E=1,A=null,P=null,S=null,V=!1;if("number"==typeof t)o=0|t,p=0|e||o;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var j=t;if("shape"in j){var O=j.shape;nt(Array.isArray(O)&&O.length>=2,"invalid shape for framebuffer"),o=O[0],p=O[1]}else"radius"in j&&(o=p=j.radius),"width"in j&&(o=j.width),"height"in j&&(p=j.height);("color"in j||"colors"in j)&&(y=j.color||j.colors,Array.isArray(y)&&nt(1===y.length||n.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in j&&(E=0|j.colorCount,nt(E>0,"invalid color buffer count")),"colorTexture"in j&&(w=!!j.colorTexture,_="rgba4"),"colorType"in j&&(k=j.colorType,w?(nt(n.oes_texture_float||!("float"===k||"float32"===k),"you must enable OES_texture_float in order to use floating point framebuffer objects"),nt(n.oes_texture_half_float||!("half float"===k||"float16"===k),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===k||"float16"===k?(nt(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==k&&"float32"!==k||(nt(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),nt.oneOf(k,c,"invalid color type")),"colorFormat"in j&&(_=j.colorFormat,u.indexOf(_)>=0?w=!0:l.indexOf(_)>=0?w=!1:nt.optional((function(){w?nt.oneOf(j.colorFormat,u,"invalid color format for texture"):nt.oneOf(j.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in j||"depthStencilTexture"in j)&&(V=!(!j.depthTexture&&!j.depthStencilTexture),nt(!V||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in j&&("boolean"==typeof j.depth?d=j.depth:(A=j.depth,g=!1)),"stencil"in j&&("boolean"==typeof j.stencil?g=j.stencil:(P=j.stencil,d=!1)),"depthStencil"in j&&("boolean"==typeof j.depthStencil?d=g=j.depthStencil:(S=j.depthStencil,d=!1,g=!1))}else o=p=1;var M=null,D=null,T=null,B=null;if(Array.isArray(y))M=y.map(v);else if(y)M=[v(y)];else for(M=new Array(E),i=0;i<E;++i)M[i]=m(o,p,w,_,k);nt(n.webgl_draw_buffers||M.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),nt(M.length<=r.maxColorAttachments,"too many color attachments, not supported"),o=o||M[0].width,p=p||M[0].height,A?D=v(A):d&&!g&&(D=m(o,p,V,"depth","uint32")),P?T=v(P):g&&!d&&(T=m(o,p,!1,"stencil","uint8")),S?B=v(S):!A&&!P&&g&&d&&(B=m(o,p,V,"depth stencil","depth stencil")),nt(!!A+!!P+!!S<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var I=null;for(i=0;i<M.length;++i)if(h(M[i],o,p),nt(!M[i]||M[i].texture&&Vi.indexOf(M[i].texture._texture.format)>=0||M[i].renderbuffer&&Bi.indexOf(M[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),M[i]&&M[i].texture){var R=ji[M[i].texture._texture.format]*Oi[M[i].texture._texture.type];null===I?I=R:nt(I===R,"all color attachments much have the same number of bits per pixel.")}return h(D,o,p),nt(!D||D.texture&&D.texture._texture.format===Si||D.renderbuffer&&D.renderbuffer._renderbuffer.format===Mi,"invalid depth attachment for framebuffer object"),h(T,o,p),nt(!T||T.renderbuffer&&T.renderbuffer._renderbuffer.format===Di,"invalid stencil attachment for framebuffer object"),h(B,o,p),nt(!B||B.texture&&B.texture._texture.format===Ti||B.renderbuffer&&B.renderbuffer._renderbuffer.format===Ti,"invalid depth-stencil attachment for framebuffer object"),x(a),a.width=o,a.height=p,a.colorAttachments=M,a.depthAttachment=D,a.stencilAttachment=T,a.depthStencilAttachment=B,f.color=M.map(b),f.depth=b(D),f.stencil=b(T),f.depthStencil=b(B),f.width=a.width,f.height=a.height,C(a),f}function p(t,e){nt(s.next!==a,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===a.width&&r===a.height)return f;for(var i=a.colorAttachments,o=0;o<i.length;++o)g(i[o],n,r);return g(a.depthAttachment,n,r),g(a.stencilAttachment,n,r),g(a.depthStencilAttachment,n,r),a.width=f.width=n,a.height=f.height=r,C(a),f}return o.framebufferCount++,f(t,i),e(f,{resize:p,_reglType:"framebuffer",_framebuffer:a,destroy:function(){k(a),x(a)},use:function(t){s.setFBO({framebuffer:f},t)}})}function A(t){var a=Array(6);function o(t){var r;nt(a.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,f={color:null},p=0,h=null,d="rgba",v="uint8",m=1;if("number"==typeof t)p=0|t;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var b=t;if("shape"in b){var g=b.shape;nt(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),nt(g[0]===g[1],"cube framebuffer must be square"),p=g[0]}else"radius"in b&&(p=0|b.radius),"width"in b?(p=0|b.width,"height"in b&&nt(b.height===p,"must be square")):"height"in b&&(p=0|b.height);("color"in b||"colors"in b)&&(h=b.color||b.colors,Array.isArray(h)&&nt(1===h.length||n.webgl_draw_buffers,"multiple render targets not supported")),h||("colorCount"in b&&(m=0|b.colorCount,nt(m>0,"invalid color buffer count")),"colorType"in b&&(nt.oneOf(b.colorType,c,"invalid color type"),v=b.colorType),"colorFormat"in b&&(d=b.colorFormat,nt.oneOf(b.colorFormat,u,"invalid color format for texture"))),"depth"in b&&(f.depth=b.depth),"stencil"in b&&(f.stencil=b.stencil),"depthStencil"in b&&(f.depthStencil=b.depthStencil)}else p=1;if(h)if(Array.isArray(h))for(l=[],r=0;r<h.length;++r)l[r]=h[r];else l=[h];else{l=Array(m);var y={radius:p,format:d,type:v};for(r=0;r<m;++r)l[r]=i.createCube(y)}for(f.color=Array(l.length),r=0;r<l.length;++r){var w=l[r];nt("function"==typeof w&&"textureCube"===w._reglType,"invalid cube map"),p=p||w.width,nt(w.width===p&&w.height===p,"invalid cube map shape"),f.color[r]={target:hi,data:l[r]}}for(r=0;r<6;++r){for(var _=0;_<l.length;++_)f.color[_].target=hi+r;r>0&&(f.depth=a[0].depth,f.stencil=a[0].stencil,f.depthStencil=a[0].depthStencil),a[r]?a[r](f):a[r]=E(f)}return e(o,{width:p,height:p,color:l})}function l(t){var e,n=0|t;if(nt(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===o.width)return o;var i=o.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)a[e].resize(n);return o.width=o.height=n,o}return o(t),e(o,{faces:a,resize:l,_reglType:"framebufferCube",destroy:function(){a.forEach((function(t){t.destroy()}))}})}function P(){s.cur=null,s.next=null,s.dirty=!0,Ce(w).forEach((function(e){e.framebuffer=t.createFramebuffer(),C(e)}))}return e(s,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof _)return e}return null},create:E,createCube:A,clear:function(){Ce(w).forEach(k)},restore:P})}Ii[gi]="complete",Ii[yi]="incomplete attachment",Ii[_i]="incomplete dimensions",Ii[wi]="incomplete, missing attachment",Ii[xi]="unsupported";var Li=5126,zi=34962,Ni=34963,Ui=["attributes","elements","offset","count","primitive","instances"];function Fi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Li,this.offset=0,this.stride=0,this.divisor=0}function qi(e,n,r,i,a,o,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new Fi;var f=0,p={},h={Record:Fi,scope:{},state:l,currentVAO:null,targetVAO:null,restore:v()?x:function(){},createVAO:k,getVAO:b,destroyBuffer:d,setVAO:v()?g:y,clear:v()?w:function(){}};function d(t){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}}function v(){return n.oes_vertex_array_object}function m(){return n.angle_instanced_arrays}function b(t){return"function"==typeof t&&t._vao?t._vao:null}function g(t){if(t!==h.currentVAO){var e=v();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),h.currentVAO=t}}function y(t){if(t!==h.currentVAO){if(t)t.bindAttrs();else{for(var n=m(),r=0;r<l.length;++r){var i=l[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?e.bindBuffer(Ni,s.elements.buffer.buffer):e.bindBuffer(Ni,null)}h.currentVAO=t}}function w(){Ce(p).forEach((function(t){t.destroy()}))}function _(){this.id=++f,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=v();this.vao=t?t.createVertexArrayOES():null,p[this.id]=this,this.buffers=[]}function x(){v()&&Ce(p).forEach((function(t){t.refresh()}))}function k(e){var r=new _;function s(e){var i;if(Array.isArray(e))i=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(nt("object"==typeof e,"invalid arguments for create vao"),nt("attributes"in e,"must specify attributes for vao"),e.elements){var l=e.elements;r.ownsElements?"function"==typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):o.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=o.create(e.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(nt(e.primitive in $e,"bad primitive type: "+e.primitive),r.primitive=$e[e.primitive]),nt.optional((()=>{for(var t=Object.keys(e),n=0;n<t.length;++n)nt(Ui.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+Ui)})),nt(Array.isArray(i),"attributes must be an array")}nt(i.length<u,"too many attributes"),nt(i.length>0,"must specify at least one attribute");var c={},f=r.attributes;f.length=i.length;for(var p=0;p<i.length;++p){var h,d=i[p],v=f[p]=new Fi,m=d.data||d;Array.isArray(m)||t(m)||ke(m)?(r.buffers[p]&&(h=r.buffers[p],t(m)&&h._buffer.byteLength>=m.byteLength?h.subdata(m):(h.destroy(),r.buffers[p]=null)),r.buffers[p]||(h=r.buffers[p]=a.create(d,zi,!1,!0)),v.buffer=a.getBuffer(h),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,c[p]=1):a.getBuffer(d)?(v.buffer=a.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):a.getBuffer(d.buffer)?(v.buffer=a.getBuffer(d.buffer),v.size=0|(+d.size||v.buffer.dimension),v.normalized=!!d.normalized||!1,"type"in d?(nt.parameter(d.type,De,"invalid buffer type"),v.type=De[d.type]):v.type=v.buffer.dtype,v.offset=0|(d.offset||0),v.stride=0|(d.stride||0),v.divisor=0|(d.divisor||0),v.state=1,nt(v.size>=1&&v.size<=4,"size must be between 1 and 4"),nt(v.offset>=0,"invalid offset"),nt(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),nt(v.divisor>=0,"divisor must be positive"),nt(!v.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(nt(p>0,"first attribute must not be a constant"),v.x=+d.x||0,v.y=+d.y||0,v.z=+d.z||0,v.w=+d.w||0,v.state=2):nt(!1,"invalid attribute spec for location "+p)}for(var b=0;b<r.buffers.length;++b)!c[b]&&r.buffers[b]&&(r.buffers[b].destroy(),r.buffers[b]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(e)}return _.prototype.bindAttrs=function(){for(var t=m(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(zi,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var a=n.length;a<u;++a)e.disableVertexAttribArray(a);var s=o.getElements(this.elements);s?e.bindBuffer(Ni,s.buffer.buffer):e.bindBuffer(Ni,null)},_.prototype.refresh=function(){var t=v();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),h.currentVAO=null,t.bindVertexArrayOES(null))},_.prototype.destroy=function(){if(this.vao){var t=v();this===h.currentVAO&&(h.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),p[this.id]&&(delete p[this.id],i.vaoCount-=1)},h}var Ki=35632,Gi=35633,$i=35718,Hi=35721;function Yi(t,n,r,i){var a={},o={};function s(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function l(e,r,i){var s=e===Ki?a:o,u=s[r];if(!u){var l=n.str(r);u=t.createShader(e),t.shaderSource(u,l),t.compileShader(u),nt.shaderError(t,u,l,e,i),s[r]=u}return u}var c={},f=[],p=0;function h(t,e){this.id=p++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(e,r,a){var o,c,f=l(Ki,e.fragId),p=l(Gi,e.vertId),h=e.program=t.createProgram();if(t.attachShader(h,f),t.attachShader(h,p),a)for(o=0;o<a.length;++o){var d=a[o];t.bindAttribLocation(h,d[0],d[1])}t.linkProgram(h),nt.linkError(t,h,n.str(e.fragId),n.str(e.vertId),r);var v=t.getProgramParameter(h,$i);i.profile&&(e.stats.uniformsCount=v);var m=e.uniforms;for(o=0;o<v;++o)if(c=t.getActiveUniform(h,o))if(c.size>1)for(var b=0;b<c.size;++b){var g=c.name.replace("[0]","["+b+"]");u(m,new s(g,n.id(g),t.getUniformLocation(h,g),c))}else u(m,new s(c.name,n.id(c.name),t.getUniformLocation(h,c.name),c));var y=t.getProgramParameter(h,Hi);i.profile&&(e.stats.attributesCount=y);var w=e.attributes;for(o=0;o<y;++o)(c=t.getActiveAttrib(h,o))&&u(w,new s(c.name,n.id(c.name),t.getAttribLocation(h,c.name),c))}function v(){a={},o={};for(var t=0;t<f.length;++t)d(f[t],null,f[t].attributes.map((function(t){return[t.location,t.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return f.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return f.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);Ce(a).forEach(e),a={},Ce(o).forEach(e),o={},f.forEach((function(e){t.deleteProgram(e.program)})),f.length=0,c={},r.shaderCount=0},program:function(n,i,s,u){nt.command(n>=0,"missing vertex shader",s),nt.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var p=l[n];if(p&&(p.refCount++,!u))return p;var v=new h(i,n);return r.shaderCount++,d(v,s,u),p||(l[n]=v),f.push(v),e(v,{destroy:function(){if(v.refCount--,v.refCount<=0){t.deleteProgram(v.program);var e=f.indexOf(v);f.splice(e,1),r.shaderCount--}l[v.vertId].refCount<=0&&(t.deleteShader(o[v.vertId]),delete o[v.vertId],delete c[v.fragId][v.vertId]),Object.keys(c[v.fragId]).length||(t.deleteShader(a[v.fragId]),delete a[v.fragId],delete c[v.fragId])}})},restore:v,shader:l,frag:-1,vert:-1}}var Wi=6408,Xi=5121,Qi=3333,Zi=5126;function Ji(e,n,r,i,a,o,s){function u(u){var l;null===n.next?(nt(a.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=Xi):(nt(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,nt.optional((function(){o.oes_texture_float?(nt(l===Xi||l===Zi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===Zi&&nt(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):nt(l===Xi,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,f=0,p=i.framebufferWidth,h=i.framebufferHeight,d=null;t(u)?d=u:u&&(nt.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,f=0|u.y,nt(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),nt(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),p=0|(u.width||i.framebufferWidth-c),h=0|(u.height||i.framebufferHeight-f),d=u.data||null),d&&(l===Xi?nt(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===Zi&&nt(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),nt(p>0&&p+c<=i.framebufferWidth,"invalid width for read pixels"),nt(h>0&&h+f<=i.framebufferHeight,"invalid height for read pixels"),r();var v=p*h*4;return d||(l===Xi?d=new Uint8Array(v):l===Zi&&(d=d||new Float32Array(v))),nt.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),nt(d.byteLength>=v,"data buffer for regl.read() too small"),e.pixelStorei(Qi,4),e.readPixels(c,f,p,h,Wi,l,d),d}function l(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}function c(t){return t&&"framebuffer"in t?l(t):u(t)}return c}function ta(t){return Array.prototype.slice.call(t)}function ea(t){return ta(t).join("")}function na(){var t=0,n=[],r=[];function i(e){for(var i=0;i<r.length;++i)if(r[i]===e)return n[i];var a="g"+t++;return n.push(a),r.push(e),a}function a(){var n=[];function r(){n.push.apply(n,ta(arguments))}var i=[];function a(){var e="v"+t++;return i.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,ta(arguments)),n.push(";")),e}return e(r,{def:a,toString:function(){return ea([i.length>0?"var "+i.join(",")+";":"",ea(n)])}})}function o(){var t=a(),n=a(),r=t.toString,i=n.toString;function o(e,r){n(e,r,"=",t.def(e,r),";")}return e((function(){t.apply(t,ta(arguments))}),{def:t.def,entry:t,exit:n,save:o,set:function(e,n,r){o(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}function s(){var t=ea(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return e(n,{then:function(){return n.apply(n,ta(arguments)),this},else:function(){return r.apply(r,ta(arguments)),this},toString:function(){var e=a();return e&&(e="else{"+e+"}"),ea(["if(",t,"){",i(),"}",e])}})}var u=a(),l={};function c(t,n){var r=[];function i(){var t="a"+r.length;return r.push(t),t}n=n||0;for(var a=0;a<n;++a)i();var s=o(),u=s.toString;return l[t]=e(s,{arg:i,toString:function(){return ea(["function(",r.join(),"){",u(),"}"])}})}function f(){var t=['"use strict";',u,"return {"];Object.keys(l).forEach((function(e){t.push('"',e,'":',l[e].toString(),",")})),t.push("}");var e=ea(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,r)}return{global:u,link:i,block:a,proc:c,scope:o,cond:s,compile:f}}var ra="xyzw".split(""),ia=5121,aa=1,oa=2,sa=0,ua=1,la=2,ca=3,fa=4,pa=5,ha=6,da="dither",va="blend.enable",ma="blend.color",ba="blend.equation",ga="blend.func",ya="depth.enable",wa="depth.func",_a="depth.range",xa="depth.mask",ka="colorMask",Ca="cull.enable",Ea="cull.face",Aa="frontFace",Pa="lineWidth",Sa="polygonOffset.enable",Va="polygonOffset.offset",ja="sample.alpha",Oa="sample.enable",Ma="sample.coverage",Da="stencil.enable",Ta="stencil.mask",Ba="stencil.func",Ia="stencil.opFront",Ra="stencil.opBack",La="scissor.enable",za="scissor.box",Na="viewport",Ua="profile",Fa="framebuffer",qa="vert",Ka="frag",Ga="elements",$a="primitive",Ha="count",Ya="offset",Wa="instances",Xa="vao",Qa="Width",Za="Height",Ja=Fa+Qa,to=Fa+Za,eo=Na+Qa,no=Na+Za,ro="drawingBuffer",io=ro+Qa,ao=ro+Za,oo=[ga,ba,Ba,Ia,Ra,Ma,Na,za,Va],so=34962,uo=34963,lo=3553,co=34067,fo=2884,po=3042,ho=3024,vo=2960,mo=2929,bo=3089,go=32823,yo=32926,wo=32928,_o=5126,xo=35664,ko=35665,Co=35666,Eo=5124,Ao=35667,Po=35668,So=35669,Vo=35670,jo=35671,Oo=35672,Mo=35673,Do=35674,To=35675,Bo=35676,Io=35678,Ro=35680,Lo=4,zo=1028,No=1029,Uo=2304,Fo=2305,qo=32775,Ko=32776,Go=519,$o=7680,Ho=0,Yo=1,Wo=32774,Xo=513,Qo=36160,Zo=36064,Jo={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ts=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],es={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ns={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rs={frag:35632,vert:35633},is={cw:Uo,ccw:Fo};function as(e){return Array.isArray(e)||t(e)||ke(e)}function os(t){return t.sort((function(t,e){return t===Na?-1:e===Na?1:t<e?-1:1}))}function ss(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function us(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function ls(t){return new ss(!1,!1,!1,t)}function cs(t,e){var n=t.type;if(n===sa){var r=t.data.length;return new ss(!0,r>=1,r>=2,e)}if(n===fa){var i=t.data;return new ss(i.thisDep,i.contextDep,i.propDep,e)}if(n===pa)return new ss(!1,!1,!1,e);if(n===ha){for(var a=!1,o=!1,s=!1,u=0;u<t.data.length;++u){var l=t.data[u];if(l.type===ua)s=!0;else if(l.type===la)o=!0;else if(l.type===ca)a=!0;else if(l.type===sa){a=!0;var c=l.data;c>=1&&(o=!0),c>=2&&(s=!0)}else l.type===fa&&(a=a||l.data.thisDep,o=o||l.data.contextDep,s=s||l.data.propDep)}return new ss(a,o,s,e)}return new ss(n===ca,n===la,n===ua,e)}var fs=new ss(!1,!1,!1,(function(){}));function ps(t,n,r,i,a,o,s,u,l,c,f,p,h,d,v){var m=c.Record,b={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(b.min=qo,b.max=Ko);var g=r.angle_instanced_arrays,y=r.webgl_draw_buffers,w=r.oes_vertex_array_object,_={dirty:!0,profile:v.profile},x={},k=[],C={},E={};function A(t){return t.replace(".","_")}function P(t,e,n){var r=A(t);k.push(t),x[r]=_[r]=!!n,C[r]=e}function S(t,e,n){var r=A(t);k.push(t),Array.isArray(n)?(_[r]=n.slice(),x[r]=n.slice()):_[r]=x[r]=n,E[r]=e}P(da,ho),P(va,po),S(ma,"blendColor",[0,0,0,0]),S(ba,"blendEquationSeparate",[Wo,Wo]),S(ga,"blendFuncSeparate",[Yo,Ho,Yo,Ho]),P(ya,mo,!0),S(wa,"depthFunc",Xo),S(_a,"depthRange",[0,1]),S(xa,"depthMask",!0),S(ka,ka,[!0,!0,!0,!0]),P(Ca,fo),S(Ea,"cullFace",No),S(Aa,Aa,Fo),S(Pa,Pa,1),P(Sa,go),S(Va,"polygonOffset",[0,0]),P(ja,yo),P(Oa,wo),S(Ma,"sampleCoverage",[1,!1]),P(Da,vo),S(Ta,"stencilMask",-1),S(Ba,"stencilFunc",[Go,0,-1]),S(Ia,"stencilOpSeparate",[zo,$o,$o,$o]),S(Ra,"stencilOpSeparate",[No,$o,$o,$o]),P(La,bo),S(za,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),S(Na,Na,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var V={gl:t,context:h,strings:n,next:x,current:_,draw:p,elements:o,buffer:a,shader:f,attributes:c.state,vao:c,uniforms:l,framebuffer:u,extensions:r,timer:d,isBufferArgs:as},j={primTypes:$e,compareFuncs:es,blendFuncs:Jo,blendEquations:b,stencilOps:ns,glTypes:De,orientationType:is};nt.optional((function(){V.isArrayLike=fn})),y&&(j.backBuffer=[No],j.drawBuffer=At(i.maxDrawbuffers,(function(t){return 0===t?[0]:At(t,(function(t){return Zo+t}))})));var O=0;function M(){var t=na(),e=t.link,r=t.global;t.id=O++,t.batchId="0";var i=e(V),a=t.shared={props:"a0"};Object.keys(V).forEach((function(t){a[t]=r.def(i,".",t)})),nt.optional((function(){t.CHECK=e(nt),t.commandStr=nt.guessCommand(),t.command=e(t.commandStr),t.assert=function(t,n,r){t("if(!(",n,"))",this.CHECK,".commandRaise(",e(r),",",this.command,");")},j.invalidBlendCombinations=ts}));var o=t.next={},s=t.current={};Object.keys(E).forEach((function(t){Array.isArray(_[t])&&(o[t]=r.def(a.next,".",t),s[t]=r.def(a.current,".",t))}));var u=t.constants={};Object.keys(j).forEach((function(t){u[t]=r.def(JSON.stringify(j[t]))})),t.invoke=function(n,r){switch(r.type){case sa:var i=["this",a.context,a.props,t.batchId];return n.def(e(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case ua:return n.def(a.props,r.data);case la:return n.def(a.context,r.data);case ca:return n.def("this",r.data);case fa:return r.data.append(t,n),r.data.ref;case pa:return r.data.toString();case ha:return r.data.map((function(e){return t.invoke(n,e)}))}},t.attribCache={};var l={};return t.scopeAttrib=function(t){var r=n.id(t);if(r in l)return l[r];var i=c.scope[r];return i||(i=c.scope[r]=new m),l[r]=e(i)},t}function D(t){var e,n=t.static,r=t.dynamic;if(Ua in n){var i=!!n[Ua];(e=ls((function(t,e){return i}))).enable=i}else if(Ua in r){var a=r[Ua];e=cs(a,(function(t,e){return t.invoke(e,a)}))}return e}function T(t,e){var n=t.static,r=t.dynamic;if(Fa in n){var i=n[Fa];return i?(i=u.getFramebuffer(i),nt.command(i,"invalid framebuffer object"),ls((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var a=r.context;return e.set(a,"."+Ja,n+".width"),e.set(a,"."+to,n+".height"),n}))):ls((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+Ja,r+"."+io),e.set(r,"."+to,r+"."+ao),"null"}))}if(Fa in r){var a=r[Fa];return cs(a,(function(t,e){var n=t.invoke(e,a),r=t.shared,i=r.framebuffer,o=e.def(i,".getFramebuffer(",n,")");nt.optional((function(){t.assert(e,"!"+n+"||"+o,"invalid framebuffer object")})),e.set(i,".next",o);var s=r.context;return e.set(s,"."+Ja,o+"?"+o+".width:"+s+"."+io),e.set(s,"."+to,o+"?"+o+".height:"+s+"."+ao),o}))}return null}function B(t,e,n){var r=t.static,i=t.dynamic;function a(t){if(t in r){var a=r[t];nt.commandType(a,"object","invalid "+t,n.commandStr);var o,s,u=!0,l=0|a.x,c=0|a.y;return"width"in a?(o=0|a.width,nt.command(o>=0,"invalid "+t,n.commandStr)):u=!1,"height"in a?(s=0|a.height,nt.command(s>=0,"invalid "+t,n.commandStr)):u=!1,new ss(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=o;"width"in a||(r=e.def(n,".",Ja,"-",l));var i=s;return"height"in a||(i=e.def(n,".",to,"-",c)),[l,c,r,i]}))}if(t in i){var f=i[t],p=cs(f,(function(e,n){var r=e.invoke(n,f);nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,a=n.def(r,".x|0"),o=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Ja,"-",a,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",to,"-",o,")");return nt.optional((function(){e.assert(n,s+">=0&&"+u+">=0","invalid "+t)})),[a,o,s,u]}));return e&&(p.thisDep=p.thisDep||e.thisDep,p.contextDep=p.contextDep||e.contextDep,p.propDep=p.propDep||e.propDep),p}return e?new ss(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",Ja),e.def(n,".",to)]})):null}var o=a(Na);if(o){var s=o;o=new ss(o.thisDep,o.contextDep,o.propDep,(function(t,e){var n=s.append(t,e),r=t.shared.context;return e.set(r,"."+eo,n[2]),e.set(r,"."+no,n[3]),n}))}return{viewport:o,scissor_box:a(za)}}function I(t,e){var n=t.static;if("string"==typeof n[Ka]&&"string"==typeof n[qa]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var a=[],o=0;o<i.length;++o)nt("number"==typeof r[i[o]],"must specify all vertex attribute locations when using vaos"),a.push([0|r[i[o]],i[o]]);return a}}return null}function R(t,e,r){var i=t.static,a=t.dynamic;function o(t){if(t in i){var e=n.id(i[t]);nt.optional((function(){f.shader(rs[t],e,nt.guessCommand())}));var r=ls((function(){return e}));return r.id=e,r}if(t in a){var o=a[t];return cs(o,(function(e,n){var r=e.invoke(n,o),i=n.def(e.shared.strings,".id(",r,")");return nt.optional((function(){n(e.shared.shader,".shader(",rs[t],",",i,",",e.command,");")})),i}))}return null}var s,u=o(Ka),l=o(qa),c=null;return us(u)&&us(l)?(c=f.program(l.id,u.id,null,r),s=ls((function(t,e){return t.link(c)}))):s=new ss(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",Ka);var i=r+".program("+(l?l.append(t,e):e.def(r,".",qa))+","+n;return nt.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}function L(t,e){var n=t.static,r=t.dynamic,i={},a=!1;function s(){if(Xa in n){var t=n[Xa];return null!==t&&null===c.getVAO(t)&&(t=c.createVAO(t)),a=!0,i.vao=t,ls((function(e){var n=c.getVAO(t);return n?e.link(n):"null"}))}if(Xa in r){a=!0;var e=r[Xa];return cs(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}var u=s(),l=!1;function f(){if(Ga in n){var t=n[Ga];if(i.elements=t,as(t)){var s=i.elements=o.create(t,!0);t=o.getElements(s),l=!0}else t&&(t=o.getElements(t),l=!0,nt.command(t,"invalid elements",e.commandStr));var c=ls((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return c.value=t,c}if(Ga in r){l=!0;var f=r[Ga];return cs(f,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,a=t.invoke(e,f),o=e.def("null"),s=e.def(r,"(",a,")"),u=t.cond(s).then(o,"=",i,".createStream(",a,");").else(o,"=",i,".getElements(",a,");");return nt.optional((function(){t.assert(u.else,"!"+a+"||"+o,"invalid elements")})),e.entry(u),e.exit(t.cond(s).then(i,".destroyStream(",o,");")),t.ELEMENTS=o,o}))}return a?new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}var p=f();function h(){if($a in n){var t=n[$a];return i.primitive=t,nt.commandParameter(t,$e,"invalid primitve",e.commandStr),ls((function(e,n){return $e[t]}))}if($a in r){var o=r[$a];return cs(o,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,o);return nt.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys($e))})),e.def(n,"[",r,"]")}))}return l?us(p)?p.value?ls((function(t,e){return e.def(t.ELEMENTS,".primType")})):ls((function(){return Lo})):new ss(p.thisDep,p.contextDep,p.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",Lo)})):a?new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:"+Lo)})):null}function d(t,o){if(t in n){var s=0|n[t];return o?i.offset=s:i.instances=s,nt.command(!o||s>=0,"invalid "+t,e.commandStr),ls((function(t,e){return o&&(t.OFFSET=s),s}))}if(t in r){var c=r[t];return cs(c,(function(e,n){var r=e.invoke(n,c);return o&&(e.OFFSET=r,nt.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(o){if(l)return ls((function(t,e){return t.OFFSET=0,0}));if(a)return new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(a)return new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var v=d(Ya,!0);function m(){if(Ha in n){var t=0|n[Ha];return i.count=t,nt.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),ls((function(){return t}))}if(Ha in r){var o=r[Ha];return cs(o,(function(t,e){var n=t.invoke(e,o);return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(l){if(us(p)){if(p)return v?new ss(v.thisDep,v.contextDep,v.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return nt.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):ls((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var s=ls((function(){return-1}));return nt.optional((function(){s.MISSING=!0})),s}var c=new ss(p.thisDep||v.thisDep,p.contextDep||v.contextDep,p.propDep||v.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return nt.optional((function(){c.DYNAMIC=!0})),c}if(a){var f=new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")}));return f}return null}var b=h(),g=m(),y=d(Wa,!1);return{elements:p,primitive:b,count:g,instances:y,offset:v,vao:u,vaoActive:a,elementsActive:l,static:i}}function z(t,e){var n=t.static,r=t.dynamic,a={};return k.forEach((function(t){var o=A(t);function s(e,i){if(t in n){var s=e(n[t]);a[o]=ls((function(){return s}))}else if(t in r){var u=r[t];a[o]=cs(u,(function(t,e){return i(t,e,t.invoke(e,u))}))}}switch(t){case Ca:case va:case da:case Da:case ya:case La:case Sa:case ja:case Oa:case xa:return s((function(n){return nt.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return nt.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case wa:return s((function(n){return nt.commandParameter(n,es,"invalid "+t,e.commandStr),es[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return nt.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(es))})),n.def(i,"[",r,"]")}));case _a:return s((function(t){return nt.command(fn(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case ga:return s((function(t){nt.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,a="dstAlpha"in t?t.dstAlpha:t.dst;return nt.commandParameter(n,Jo,o+".srcRGB",e.commandStr),nt.commandParameter(r,Jo,o+".srcAlpha",e.commandStr),nt.commandParameter(i,Jo,o+".dstRGB",e.commandStr),nt.commandParameter(a,Jo,o+".dstAlpha",e.commandStr),nt.command(-1===ts.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[Jo[n],Jo[i],Jo[r],Jo[a]]}),(function(e,n,r){var i=e.constants.blendFuncs;function a(a,o){var s=n.def('"',a,o,'" in ',r,"?",r,".",a,o,":",r,".",a);return nt.optional((function(){e.assert(n,s+" in "+i,"invalid "+t+"."+a+o+", must be one of "+Object.keys(Jo))})),s}nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var o=a("src","RGB"),s=a("dst","RGB");nt.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+o+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",o,"]"),l=n.def(i,"[",a("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",a("dst","Alpha"),"]")]}));case ba:return s((function(n){return"string"==typeof n?(nt.commandParameter(n,b,"invalid "+t,e.commandStr),[b[n],b[n]]):"object"==typeof n?(nt.commandParameter(n.rgb,b,t+".rgb",e.commandStr),nt.commandParameter(n.alpha,b,t+".alpha",e.commandStr),[b[n.rgb],b[n.alpha]]):void nt.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,a=n.def(),o=n.def(),s=e.cond("typeof ",r,'==="string"');return nt.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(b))}n(s.then,t,r),e.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(s.else,t+".rgb",r+".rgb"),n(s.else,t+".alpha",r+".alpha")})),s.then(a,"=",o,"=",i,"[",r,"];"),s.else(a,"=",i,"[",r,".rgb];",o,"=",i,"[",r,".alpha];"),n(s),[a,o]}));case ma:return s((function(t){return nt.command(fn(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),At(4,(function(e){return+t[e]}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),At(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case Ta:return s((function(t){return nt.commandType(t,"number",o,e.commandStr),0|t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case Ba:return s((function(n){nt.commandType(n,"object",o,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,a="mask"in n?n.mask:-1;return nt.commandParameter(r,es,t+".cmp",e.commandStr),nt.commandType(i,"number",t+".ref",e.commandStr),nt.commandType(a,"number",t+".mask",e.commandStr),[es[r],i,a]}),(function(t,e,n){var r=t.constants.compareFuncs;return nt.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",$o),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Ia:case Ra:return s((function(n){nt.commandType(n,"object",o,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",a=n.zpass||"keep";return nt.commandParameter(r,ns,t+".fail",e.commandStr),nt.commandParameter(i,ns,t+".zfail",e.commandStr),nt.commandParameter(a,ns,t+".zpass",e.commandStr),[t===Ra?No:zo,ns[r],ns[i],ns[a]]}),(function(e,n,r){var i=e.constants.stencilOps;function a(a){return nt.optional((function(){e.assert(n,'!("'+a+'" in '+r+")||("+r+"."+a+" in "+i+")","invalid "+t+"."+a+", must be one of "+Object.keys(ns))})),n.def('"',a,'" in ',r,"?",i,"[",r,".",a,"]:",$o)}return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===Ra?No:zo,a("fail"),a("zfail"),a("zpass")]}));case Va:return s((function(t){nt.commandType(t,"object",o,e.commandStr);var n=0|t.factor,r=0|t.units;return nt.commandType(n,"number",o+".factor",e.commandStr),nt.commandType(r,"number",o+".units",e.commandStr),[n,r]}),(function(e,n,r){return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Ea:return s((function(t){var n=0;return"front"===t?n=zo:"back"===t&&(n=No),nt.command(!!n,o,e.commandStr),n}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',zo,":",No)}));case Pa:return s((function(t){return nt.command("number"==typeof t&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Aa:return s((function(t){return nt.commandParameter(t,is,o,e.commandStr),is[t]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+Uo+":"+Fo)}));case ka:return s((function(t){return nt.command(fn(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),At(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Ma:return s((function(t){nt.command("object"==typeof t&&t,o,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return nt.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),a}function N(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,a=n[t];if("number"==typeof a||"boolean"==typeof a)r=ls((function(){return a}));else if("function"==typeof a){var o=a._reglType;"texture2d"===o||"textureCube"===o?r=ls((function(t){return t.link(a)})):"framebuffer"===o||"framebufferCube"===o?(nt.command(a.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=ls((function(t){return t.link(a.color[0])}))):nt.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else fn(a)?r=ls((function(e){return e.global.def("[",At(a.length,(function(n){return nt.command("number"==typeof a[n]||"boolean"==typeof a[n],"invalid uniform "+t,e.commandStr),a[n]})),"]")})):nt.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=a,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=cs(e,(function(t,n){return t.invoke(n,e)}))})),i}function U(t,e){var r=t.static,i=t.dynamic,o={};return Object.keys(r).forEach((function(t){var i=r[t],s=n.id(t),u=new m;if(as(i))u.state=aa,u.buffer=a.getBuffer(a.create(i,so,!1,!0)),u.type=0;else{var l=a.getBuffer(i);if(l)u.state=aa,u.buffer=l,u.type=0;else if(nt.command("object"==typeof i&&i,"invalid data for attribute "+t,e.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=oa,"number"==typeof c?u.x=c:(nt.command(fn(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+t,e.commandStr),ra.forEach((function(t,e){e<c.length&&(u[t]=c[e])})))}else{l=as(i.buffer)?a.getBuffer(a.create(i.buffer,so,!1,!0)):a.getBuffer(i.buffer),nt.command(!!l,'missing buffer for attribute "'+t+'"',e.commandStr);var f=0|i.offset;nt.command(f>=0,'invalid offset for attribute "'+t+'"',e.commandStr);var p=0|i.stride;nt.command(p>=0&&p<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',e.commandStr);var h=0|i.size;nt.command(!("size"in i)||h>0&&h<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',e.commandStr);var d=!!i.normalized,v=0;"type"in i&&(nt.commandParameter(i.type,De,"invalid type for attribute "+t,e.commandStr),v=De[i.type]);var b=0|i.divisor;nt.optional((function(){"divisor"in i&&(nt.command(0===b||g,'cannot specify divisor for attribute "'+t+'", instancing not supported',e.commandStr),nt.command(b>=0,'invalid divisor for attribute "'+t+'"',e.commandStr));var n=e.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(e){nt.command(r.indexOf(e)>=0,'unknown parameter "'+e+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",n)}))})),u.buffer=l,u.state=aa,u.size=h,u.normalized=d,u.type=v||l.dtype,u.offset=f,u.stride=p,u.divisor=b}}o[t]=ls((function(t,e){var n=t.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];function n(n,r){var i=n.invoke(r,e),a=n.shared,o=n.constants,s=a.isBufferArgs,u=a.buffer;nt.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+a.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=aa,Object.keys(c).forEach((function(t){l[t]=r.def(""+c[t])}));var f=l.buffer,p=l.type;function h(t){r(l[t],"=",i,".",t,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",f,"=",u,".createStream(",so,",",i,");",p,"=",f,".dtype;","}else{",f,"=",u,".getBuffer(",i,");","if(",f,"){",p,"=",f,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",oa,";","if(typeof "+i+'.constant === "number"){',l[ra[0]],"=",i,".constant;",ra.slice(1).map((function(t){return l[t]})).join("="),"=0;","}else{",ra.map((function(t,e){return l[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",f,"=",u,".createStream(",so,",",i,".buffer);","}else{",f,"=",u,".getBuffer(",i,".buffer);","}",p,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",f,".dtype;",l.normalized,"=!!",i,".normalized;"),h("size"),h("offset"),h("stride"),h("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",f,");","}"),l}o[t]=cs(e,n)})),o}function F(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=ls((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=cs(e,(function(t,n){return t.invoke(n,e)}))})),r}function q(t,e,n,i,a){var o=t.static,s=t.dynamic;nt.optional((function(){var t=[Fa,qa,Ka,Ga,$a,Ya,Ha,Wa,Ua,Xa].concat(k);function e(e){Object.keys(e).forEach((function(e){nt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',a.commandStr)}))}e(o),e(s)}));var u=I(t,e),l=T(t),f=B(t,l,a),p=L(t,a),h=z(t,a),d=R(t,a,u);function v(t){var e=f[t];e&&(h[t]=e)}v(Na),v(A(za));var m=Object.keys(h).length>0,b={framebuffer:l,draw:p,shader:d,state:h,dirty:m,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(b.profile=D(t),b.uniforms=N(n,a),b.drawVAO=b.scopeVAO=p.vao,!b.drawVAO&&d.program&&!u&&r.angle_instanced_arrays&&p.static.elements){var g=!0,y=d.program.attributes.map((function(t){var n=e.static[t];return g=g&&!!n,n}));if(g&&y.length>0){var w=c.getVAO(c.createVAO({attributes:y,elements:p.static.elements}));b.drawVAO=new ss(null,null,null,(function(t,e){return t.link(w)})),b.useVAO=!0}}return u?b.useVAO=!0:b.attributes=U(e,a),b.context=F(i),b}function K(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(a){e.save(r,"."+a);var o=n[a].append(t,e);Array.isArray(o)?i(r,".",a,"=[",o.join(),"];"):i(r,".",a,"=",o,";")})),e(i)}function G(t,e,n,r){var i,a=t.shared,o=a.gl,s=a.framebuffer;y&&(i=e.def(a.extensions,".webgl_draw_buffers"));var u,l=t.constants,c=l.drawBuffer,f=l.backBuffer;u=n?n.append(t,e):e.def(s,".next"),r||e("if(",u,"!==",s,".cur){"),e("if(",u,"){",o,".bindFramebuffer(",Qo,",",u,".framebuffer);"),y&&e(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),e("}else{",o,".bindFramebuffer(",Qo,",null);"),y&&e(i,".drawBuffersWEBGL(",f,");"),e("}",s,".cur=",u,";"),r||e("}")}function $(t,e,n){var r=t.shared,i=r.gl,a=t.current,o=t.next,s=r.current,u=r.next,l=t.cond(s,".dirty");k.forEach((function(e){var r,c,f=A(e);if(!(f in n.state))if(f in o){r=o[f],c=a[f];var p=At(_[f].length,(function(t){return l.def(r,"[",t,"]")}));l(t.cond(p.map((function(t,e){return t+"!=="+c+"["+e+"]"})).join("||")).then(i,".",E[f],"(",p,");",p.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";"))}else{r=l.def(u,".",f);var h=t.cond(r,"!==",s,".",f);l(h),f in C?h(t.cond(r).then(i,".enable(",C[f],");").else(i,".disable(",C[f],");"),s,".",f,"=",r,";"):h(i,".",E[f],"(",r,");",s,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),e(l)}function H(t,e,n,r){var i=t.shared,a=t.current,o=i.current,s=i.gl;os(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(t,e);if(C[i]){var c=C[i];us(u)?e(s,l?".enable(":".disable(",c,");"):e(t.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),e(o,".",i,"=",l,";")}else if(fn(l)){var f=a[i];e(s,".",E[i],"(",l,");",l.map((function(t,e){return f+"["+e+"]="+t})).join(";"),";")}else e(s,".",E[i],"(",l,");",o,".",i,"=",l,";")}}))}function Y(t,e){g&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function W(t,e,n,r,i){var a,o,s,u=t.shared,l=t.stats,c=u.current,f=u.timer,p=n.profile;function h(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function v(t){t(a=e.def(),"=",h(),";"),"string"==typeof i?t(l,".count+=",i,";"):t(l,".count++;"),d&&(r?t(o=e.def(),"=",f,".getNumPendingQueries();"):t(f,".beginQuery(",l,");"))}function m(t){t(l,".cpuTime+=",h(),"-",a,";"),d&&(r?t(f,".pushScopeStats(",o,",",f,".getNumPendingQueries(),",l,");"):t(f,".endQuery();"))}function b(t){var n=e.def(c,".profile");e(c,".profile=",t,";"),e.exit(c,".profile=",n,";")}if(p){if(us(p))return void(p.enable?(v(e),m(e.exit),b("true")):b("false"));b(s=p.append(t,e))}else s=e.def(c,".profile");var g=t.block();v(g),e("if(",s,"){",g,"}");var y=t.block();m(y),e.exit("if(",s,"){",y,"}")}function X(t,e,n,r,i){var a=t.shared;function o(t){switch(t){case xo:case Ao:case jo:return 2;case ko:case Po:case Oo:return 3;case Co:case So:case Mo:return 4;default:return 1}}function s(n,r,i){var o=a.gl,s=e.def(n,".location"),u=e.def(a.attributes,"[",s,"]"),l=i.state,c=i.buffer,f=[i.x,i.y,i.z,i.w],p=["buffer","normalized","offset","stride"];function h(){e("if(!",u,".buffer){",o,".enableVertexAttribArray(",s,");}");var n,a=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",a,"||",u,".size!==",n,"||",p.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",o,".bindBuffer(",so,",",c,".buffer);",o,".vertexAttribPointer(",[s,n,a,i.normalized,i.stride,i.offset],");",u,".type=",a,";",u,".size=",n,";",p.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),g){var l=i.divisor;e("if(",u,".divisor!==",l,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){e("if(",u,".buffer){",o,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",ra.map((function(t,e){return u+"."+t+"!=="+f[e]})).join("||"),"){",o,".vertexAttrib4f(",s,",",f,");",ra.map((function(t,e){return u+"."+t+"="+f[e]+";"})).join(""),"}")}l===aa?h():l===oa?d():(e("if(",l,"===",aa,"){"),h(),e("}else{"),d(),e("}"))}r.forEach((function(r){var a,u=r.name,l=n.attributes[u];if(l){if(!i(l))return;a=l.append(t,e)}else{if(!i(fs))return;var c=t.scopeAttrib(u);nt.optional((function(){t.assert(e,c+".state","missing attribute "+u)})),a={},Object.keys(new m).forEach((function(t){a[t]=e.def(c,".",t)}))}s(t.link(r),o(r.info.type),a)}))}function Q(t,e,r,i,a,o){for(var s,u=t.shared,l=u.gl,c=0;c<i.length;++c){var f,p=i[c],h=p.name,d=p.info.type,v=r.uniforms[h],m=t.link(p)+".location";if(v){if(!a(v))continue;if(us(v)){var b=v.value;if(nt.command(null!=b,'missing uniform "'+h+'"',t.commandStr),d===Io||d===Ro){nt.command("function"==typeof b&&(d===Io&&("texture2d"===b._reglType||"framebuffer"===b._reglType)||d===Ro&&("textureCube"===b._reglType||"framebufferCube"===b._reglType)),"invalid texture for uniform "+h,t.commandStr);var g=t.link(b._texture||b.color[0]._texture);e(l,".uniform1i(",m,",",g+".bind());"),e.exit(g,".unbind();")}else if(d===Do||d===To||d===Bo){nt.optional((function(){nt.command(fn(b),"invalid matrix for uniform "+h,t.commandStr),nt.command(d===Do&&4===b.length||d===To&&9===b.length||d===Bo&&16===b.length,"invalid length for matrix uniform "+h,t.commandStr)}));var y=t.global.def("new Float32Array(["+Array.prototype.slice.call(b)+"])"),w=2;d===To?w=3:d===Bo&&(w=4),e(l,".uniformMatrix",w,"fv(",m,",false,",y,");")}else{switch(d){case _o:nt.commandType(b,"number","uniform "+h,t.commandStr),s="1f";break;case xo:nt.command(fn(b)&&2===b.length,"uniform "+h,t.commandStr),s="2f";break;case ko:nt.command(fn(b)&&3===b.length,"uniform "+h,t.commandStr),s="3f";break;case Co:nt.command(fn(b)&&4===b.length,"uniform "+h,t.commandStr),s="4f";break;case Vo:nt.commandType(b,"boolean","uniform "+h,t.commandStr),s="1i";break;case Eo:nt.commandType(b,"number","uniform "+h,t.commandStr),s="1i";break;case jo:case Ao:nt.command(fn(b)&&2===b.length,"uniform "+h,t.commandStr),s="2i";break;case Oo:case Po:nt.command(fn(b)&&3===b.length,"uniform "+h,t.commandStr),s="3i";break;case Mo:case So:nt.command(fn(b)&&4===b.length,"uniform "+h,t.commandStr),s="4i"}e(l,".uniform",s,"(",m,",",fn(b)?Array.prototype.slice.call(b):b,");")}continue}f=v.append(t,e)}else{if(!a(fs))continue;f=e.def(u.uniforms,"[",n.id(h),"]")}d===Io?(nt(!Array.isArray(f),"must specify a scalar prop for textures"),e("if(",f,"&&",f,'._reglType==="framebuffer"){',f,"=",f,".color[0];","}")):d===Ro&&(nt(!Array.isArray(f),"must specify a scalar prop for cube maps"),e("if(",f,"&&",f,'._reglType==="framebufferCube"){',f,"=",f,".color[0];","}")),nt.optional((function(){function n(n,r){t.assert(e,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(t){nt(!Array.isArray(f),"must not specify an array type for uniform"),n("typeof "+f+'==="'+t+'"',"invalid type, expected "+t)}function i(e,r){Array.isArray(f)?nt(f.length===e,"must have length "+e):n(u.isArrayLike+"("+f+")&&"+f+".length==="+e,"invalid vector, should have length "+e,t.commandStr)}function a(e){nt(!Array.isArray(f),"must not specify a value type"),n("typeof "+f+'==="function"&&'+f+'._reglType==="texture'+(e===lo?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(d){case Eo:r("number");break;case Ao:i(2);break;case Po:i(3);break;case So:i(4);break;case _o:r("number");break;case xo:i(2);break;case ko:i(3);break;case Co:i(4);break;case Vo:r("boolean");break;case jo:i(2);break;case Oo:i(3);break;case Mo:case Do:i(4);break;case To:i(9);break;case Bo:i(16);break;case Io:a(lo);break;case Ro:a(co)}}));var _=1;switch(d){case Io:case Ro:var x=e.def(f,"._texture");e(l,".uniform1i(",m,",",x,".bind());"),e.exit(x,".unbind();");continue;case Eo:case Vo:s="1i";break;case Ao:case jo:s="2i",_=2;break;case Po:case Oo:s="3i",_=3;break;case So:case Mo:s="4i",_=4;break;case _o:s="1f";break;case xo:s="2f",_=2;break;case ko:s="3f",_=3;break;case Co:s="4f",_=4;break;case Do:s="Matrix2fv";break;case To:s="Matrix3fv";break;case Bo:s="Matrix4fv"}if("M"===s.charAt(0)){e(l,".uniform",s,"(",m,",");var k=Math.pow(d-Do+2,2),C=t.global.def("new Float32Array(",k,")");Array.isArray(f)?e("false,(",At(k,(function(t){return C+"["+t+"]="+f[t]})),",",C,")"):e("false,(Array.isArray(",f,")||",f," instanceof Float32Array)?",f,":(",At(k,(function(t){return C+"["+t+"]="+f+"["+t+"]"})),",",C,")"),e(");")}else if(_>1){for(var E=[],A=[],P=0;P<_;++P)Array.isArray(f)?A.push(f[P]):A.push(e.def(f+"["+P+"]")),o&&E.push(e.def());o&&e("if(!",t.batchId,"||",E.map((function(t,e){return t+"!=="+A[e]})).join("||"),"){",E.map((function(t,e){return t+"="+A[e]+";"})).join("")),e(l,".uniform",s,"(",m,",",A.join(","),");"),o&&e("}")}else{if(nt(!Array.isArray(f),"uniform value must not be an array"),o){var S=e.def();e("if(!",t.batchId,"||",S,"!==",f,"){",S,"=",f,";")}e(l,".uniform",s,"(",m,",",f,");"),o&&e("}")}}}function Z(t,e,n,r){var i=t.shared,a=i.gl,o=i.draw,s=r.draw;function u(){var u,l=s.elements,c=e;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(t,c),s.elementsActive&&c("if("+u+")"+a+".bindBuffer("+uo+","+u+".buffer.buffer);")):(u=c.def(),c(u,"=",o,".",Ga,";","if(",u,"){",a,".bindBuffer(",uo,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",w?"":"if("+u+")"+a+".bindBuffer("+uo+","+u+".buffer.buffer);","}")),u}function l(){var i,a=s.count,u=e;return a?((a.contextDep&&r.contextDynamic||a.propDep)&&(u=n),i=a.append(t,u),nt.optional((function(){a.MISSING&&t.assert(e,"false","missing vertex count"),a.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(o,".",Ha),nt.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}var c=u();function f(i){var a=s[i];return a?a.contextDep&&r.contextDynamic||a.propDep?a.append(t,n):a.append(t,e):e.def(o,".",i)}var p,h,d=f($a),v=f(Ya),m=l();if("number"==typeof m){if(0===m)return}else n("if(",m,"){"),n.exit("}");g&&(p=f(Wa),h=t.instancing);var b=c+".type",y=s.elements&&us(s.elements)&&!s.vaoActive;function _(){function t(){n(h,".drawElementsInstancedANGLE(",[d,m,b,v+"<<(("+b+"-"+ia+")>>1)",p],");")}function e(){n(h,".drawArraysInstancedANGLE(",[d,v,m,p],");")}c&&"null"!==c?y?t():(n("if(",c,"){"),t(),n("}else{"),e(),n("}")):e()}function x(){function t(){n(a+".drawElements("+[d,m,b,v+"<<(("+b+"-"+ia+")>>1)"]+");")}function e(){n(a+".drawArrays("+[d,v,m]+");")}c&&"null"!==c?y?t():(n("if(",c,"){"),t(),n("}else{"),e(),n("}")):e()}g&&("number"!=typeof p||p>=0)?"string"==typeof p?(n("if(",p,">0){"),_(),n("}else if(",p,"<0){"),x(),n("}")):_():x()}function J(t,e,n,r,i){var a=M(),o=a.proc("body",i);return nt.optional((function(){a.commandStr=e.commandStr,a.command=a.link(e.commandStr)})),g&&(a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")),t(a,o,n,r),a.compile().body}function tt(t,e,n,r){Y(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),X(t,e,n,r.attributes,(function(){return!0}))),Q(t,e,n,r.uniforms,(function(){return!0}),!1),Z(t,e,e,n)}function et(t,e){var n=t.proc("draw",1);Y(t,n),K(t,n,e.context),G(t,n,e.framebuffer),$(t,n,e),H(t,n,e.state),W(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)tt(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),a=n.def(r,".id"),o=n.def(i,"[",a,"]");n(t.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",t.link((function(n){return J(tt,t,e,n,1)})),"(",r,");",o,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function rt(t,e,n,r){function i(){return!0}t.batchId="a1",Y(t,e),X(t,e,n,r.attributes,i),Q(t,e,n,r.uniforms,i,!1),Z(t,e,e,n)}function it(t,e,n,r){Y(t,e);var i=n.contextDep,a=e.def(),o="a0",s="a1",u=e.def();t.shared.props=u,t.batchId=a;var l=t.scope(),c=t.scope();function f(t){return t.contextDep&&i||t.propDep}function p(t){return!f(t)}if(e(l.entry,"for(",a,"=0;",a,"<",s,";++",a,"){",u,"=",o,"[",a,"];",c,"}",l.exit),n.needsContext&&K(t,c,n.context),n.needsFramebuffer&&G(t,c,n.framebuffer),H(t,c,n.state,f),n.profile&&f(n.profile)&&W(t,c,n,!1,!0),r)n.useVAO?n.drawVAO?f(n.drawVAO)?c(t.shared.vao,".setVAO(",n.drawVAO.append(t,c),");"):l(t.shared.vao,".setVAO(",n.drawVAO.append(t,l),");"):l(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(l(t.shared.vao,".setVAO(null);"),X(t,l,n,r.attributes,p),X(t,c,n,r.attributes,f)),Q(t,l,n,r.uniforms,p,!1),Q(t,c,n,r.uniforms,f,!0),Z(t,l,c,n);else{var h=t.global.def("{}"),d=n.shader.progVar.append(t,c),v=c.def(d,".id"),m=c.def(h,"[",v,"]");c(t.shared.gl,".useProgram(",d,".program);","if(!",m,"){",m,"=",h,"[",v,"]=",t.link((function(e){return J(rt,t,n,e,2)})),"(",d,");}",m,".call(this,a0[",a,"],",a,");")}}function at(t,e){var n=t.proc("batch",2);t.batchId="0",Y(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(K(t,n,e.context),i=!1);var a=e.framebuffer,o=!1;function s(t){return t.contextDep&&r||t.propDep}a?(a.propDep?r=o=!0:a.contextDep&&r&&(o=!0),o||G(t,n,a)):G(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),$(t,n,e),H(t,n,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||W(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=o;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)it(t,n,e,null);else{var l=u.append(t,n);if(n(t.shared.gl,".useProgram(",l,".program);"),e.shader.program)it(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var c=t.global.def("{}"),f=n.def(l,".id"),p=n.def(c,"[",f,"]");n(t.cond(p).then(p,".call(this,a0,a1);").else(p,"=",c,"[",f,"]=",t.link((function(n){return J(it,t,e,n,2)})),"(",l,");",p,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function ot(t,e){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,a=i.current;function o(n){var a=e.shader[n];a&&r.set(i.shader,"."+n,a.append(t,r))}K(t,r,e.context),e.framebuffer&&e.framebuffer.append(t,r),os(Object.keys(e.state)).forEach((function(n){var a=e.state[n].append(t,r);fn(a)?a.forEach((function(e,i){r.set(t.next[n],"["+i+"]",e)})):r.set(i.next,"."+n,a)})),W(t,r,e,!0,!0),[Ga,Ya,Ha,Wa,$a].forEach((function(n){var a=e.draw[n];a&&r.set(i.draw,"."+n,""+a.append(t,r))})),Object.keys(e.uniforms).forEach((function(a){var o=e.uniforms[a].append(t,r);Array.isArray(o)&&(o="["+o.join()+"]"),r.set(i.uniforms,"["+n.id(a)+"]",o)})),Object.keys(e.attributes).forEach((function(n){var i=e.attributes[n].append(t,r),a=t.scopeAttrib(n);Object.keys(new m).forEach((function(t){r.set(a,"."+t,i[t])}))})),e.scopeVAO&&r.set(i.vao,".targetVAO",e.scopeVAO.append(t,r)),o(qa),o(Ka),Object.keys(e.state).length>0&&(r(a,".dirty=true;"),r.exit(a,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function st(t){if("object"==typeof t&&!fn(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(dt.isDynamic(t[e[n]]))return!0;return!1}}function ut(t,e,n){var r=e.static[n];if(r&&st(r)){var i=t.global,a=Object.keys(r),o=!1,s=!1,u=!1,l=t.global.def("{}");a.forEach((function(e){var n=r[e];if(dt.isDynamic(n)){"function"==typeof n&&(n=r[e]=dt.unbox(n));var a=cs(n,null);o=o||a.thisDep,u=u||a.propDep,s=s||a.contextDep}else{switch(i(l,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new dt.DynamicVariable(fa,{thisDep:o,contextDep:s,propDep:u,ref:l,append:c}),delete e.static[n]}function c(t,e){a.forEach((function(n){var i=r[n];if(dt.isDynamic(i)){var a=t.invoke(e,i);e(l,".",n,"=",a,";")}}))}}function lt(t,n,r,i,a){var o=M();o.stats=o.link(a),Object.keys(n.static).forEach((function(t){ut(o,n,t)})),oo.forEach((function(e){ut(o,t,e)}));var s=q(t,n,r,i,o);return et(o,s),ot(o,s),at(o,s),e(o.compile(),{destroy:function(){s.shader.program.destroy()}})}return{next:x,current:_,procs:function(){var t=M(),e=t.proc("poll"),n=t.proc("refresh"),a=t.block();e(a),n(a);var o,s=t.shared,u=s.gl,l=s.next,c=s.current;a(c,".dirty=false;"),G(t,e),G(t,n,null,!0),g&&(o=t.link(g)),r.oes_vertex_array_object&&n(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var p=n.def(s.attributes,"[",f,"]"),h=t.cond(p,".buffer");h.then(u,".enableVertexAttribArray(",f,");",u,".bindBuffer(",so,",",p,".buffer.buffer);",u,".vertexAttribPointer(",f,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(u,".disableVertexAttribArray(",f,");",u,".vertexAttrib4f(",f,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;"),n(h),g&&n(o,".vertexAttribDivisorANGLE(",f,",",p,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(C).forEach((function(r){var i=C[r],o=a.def(l,".",r),s=t.block();s("if(",o,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",o,";"),n(s),e("if(",o,"!==",c,".",r,"){",s,"}")})),Object.keys(E).forEach((function(r){var i,o,s=E[r],f=_[r],p=t.block();if(p(u,".",s,"("),fn(f)){var h=f.length;i=t.global.def(l,".",r),o=t.global.def(c,".",r),p(At(h,(function(t){return i+"["+t+"]"})),");",At(h,(function(t){return o+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",At(h,(function(t){return i+"["+t+"]!=="+o+"["+t+"]"})).join("||"),"){",p,"}")}else i=a.def(l,".",r),o=a.def(c,".",r),p(i,");",c,".",r,"=",i,";"),e("if(",i,"!==",o,"){",p,"}");n(p)})),t.compile()}(),compile:lt}}function hs(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var ds=34918,vs=34919,ms=35007,bs=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){n.push(t)}var a=[];function o(t){var n=r();e.ext_disjoint_timer_query.beginQueryEXT(ms,n),a.push(n),h(a.length-1,a.length,t)}function s(){e.ext_disjoint_timer_query.endQueryEXT(ms)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var l=[];function c(){return l.pop()||new u}function f(t){l.push(t)}var p=[];function h(t,e,n){var r=c();r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,p.push(r)}var d=[],v=[];function m(){var t,n,r=a.length;if(0!==r){v.length=Math.max(v.length,r+1),d.length=Math.max(d.length,r+1),d[0]=0,v[0]=0;var o=0;for(t=0,n=0;n<a.length;++n){var s=a[n];e.ext_disjoint_timer_query.getQueryObjectEXT(s,vs)?(o+=e.ext_disjoint_timer_query.getQueryObjectEXT(s,ds),i(s)):a[t++]=s,d[n+1]=o,v[n+1]=t}for(a.length=t,t=0,n=0;n<p.length;++n){var u=p[n],l=u.startQueryIndex,c=u.endQueryIndex;u.sum+=d[c]-d[l];var h=v[l],m=v[c];m===h?(u.stats.gpuTime+=u.sum/1e6,f(u)):(u.startQueryIndex=h,u.endQueryIndex=m,p[t++]=u)}p.length=t}}return{beginQuery:o,endQuery:s,pushScopeStats:h,update:m,getNumPendingQueries:function(){return a.length},clear:function(){n.push.apply(n,a);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);a.length=0,n.length=0},restore:function(){a.length=0,n.length=0}}},gs=16384,ys=256,ws=1024,_s=34962,xs="webglcontextlost",ks="webglcontextrestored",Cs=1,Es=2,As=3;function Ps(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function Ss(t){var n=Ct(t);if(!n)return null;var r=n.gl,i=r.getContextAttributes(),a=r.isContextLost(),o=Et(r,n);if(!o)return null;var s=bt(),u=hs(),l=o.extensions,c=bs(r,l),f=mt(),p=r.drawingBufferWidth,h=r.drawingBufferHeight,d={tick:0,time:0,viewportWidth:p,viewportHeight:h,framebufferWidth:p,framebufferHeight:h,drawingBufferWidth:p,drawingBufferHeight:h,pixelRatio:n.pixelRatio},v={},m={elements:null,primitive:4,count:-1,offset:0,instances:-1},b=xe(r,l),g=Ge(r,u,n,_),y=on(r,l,g,u),w=qi(r,l,b,u,g,y,m);function _(t){return w.destroyBuffer(t)}var x=Yi(r,s,u,n),k=Wr(r,l,b,(function(){A.procs.poll()}),d,u,n),C=li(r,l,b,u,n),E=Ri(r,l,b,k,C,u),A=ps(r,s,l,b,g,y,k,E,v,w,x,m,d,c,n),P=Ji(r,E,A.procs.poll,d,i,l,b),S=A.next,V=r.canvas,j=[],O=[],M=[],D=[n.onDestroy],T=null;function B(){if(0===j.length)return c&&c.update(),void(T=null);T=vt.next(B),H();for(var t=j.length-1;t>=0;--t){var e=j[t];e&&e(d,null,0)}r.flush(),c&&c.update()}function I(){!T&&j.length>0&&(T=vt.next(B))}function R(){T&&(vt.cancel(B),T=null)}function L(t){t.preventDefault(),a=!0,R(),O.forEach((function(t){t()}))}function z(t){r.getError(),a=!1,o.restore(),x.restore(),g.restore(),k.restore(),C.restore(),E.restore(),w.restore(),c&&c.restore(),A.procs.refresh(),I(),M.forEach((function(t){t()}))}function N(){j.length=0,R(),V&&(V.removeEventListener(xs,L),V.removeEventListener(ks,z)),x.clear(),E.clear(),C.clear(),w.clear(),k.clear(),y.clear(),g.clear(),c&&c.clear(),D.forEach((function(t){t()}))}function U(t){function n(t){var n=e({},t);function r(t){if(t in n){var e=n[t];delete n[t],Object.keys(e).forEach((function(r){n[t+"."+r]=e[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(n.vao=t.vao),n}function r(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var a=t[i];if(dt.isDynamic(a))r[i]=dt.unbox(a,i);else{if(e&&Array.isArray(a))for(var o=0;o<a.length;++o)if(dt.isDynamic(a[o]))return void(r[i]=dt.unbox(a,i));n[i]=a}})),{dynamic:r,static:n}}nt(!!t,"invalid args to regl({...})"),nt.type(t,"object","invalid args to regl({...})");var i=r(t.context||{},!0),o=r(t.uniforms||{},!0),s=r(t.attributes||{},!1),u=r(n(t),!1),l={gpuTime:0,cpuTime:0,count:0},c=A.compile(u,s,o,i,l),f=c.draw,p=c.batch,h=c.scope,d=[];function v(t){for(;d.length<t;)d.push(null);return d}function m(t,e){var n;if(a&&nt.raise("context lost"),"function"==typeof t)return h.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)h.call(this,null,e,n);else{if(!Array.isArray(t))return h.call(this,t,e,0);for(n=0;n<t.length;++n)h.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return p.call(this,v(0|t),0|t)}else{if(!Array.isArray(t))return f.call(this,t);if(t.length)return p.call(this,t,t.length)}}return e(m,{stats:l,destroy:function(){c.destroy()}})}V&&(V.addEventListener(xs,L,!1),V.addEventListener(ks,z,!1));var F=E.setFBO=U({framebuffer:dt.define.call(null,Cs,"framebuffer")});function q(t,e){var n=0;A.procs.poll();var i=e.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=gs),"depth"in e&&(r.clearDepth(+e.depth),n|=ys),"stencil"in e&&(r.clearStencil(0|e.stencil),n|=ws),nt(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function K(t){if(nt("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var n=0;n<6;++n)F(e({framebuffer:t.framebuffer.faces[n]},t),q);else F(t,q);else q(null,t)}function G(t){function e(){var e=Ps(j,t);function n(){var t=Ps(j,n);j[t]=j[j.length-1],j.length-=1,j.length<=0&&R()}nt(e>=0,"cannot cancel a frame twice"),j[e]=n}return nt.type(t,"function","regl.frame() callback must be a function"),j.push(t),I(),{cancel:e}}function $(){var t=S.viewport,e=S.scissor_box;t[0]=t[1]=e[0]=e[1]=0,d.viewportWidth=d.framebufferWidth=d.drawingBufferWidth=t[2]=e[2]=r.drawingBufferWidth,d.viewportHeight=d.framebufferHeight=d.drawingBufferHeight=t[3]=e[3]=r.drawingBufferHeight}function H(){d.tick+=1,d.time=W(),$(),A.procs.poll()}function Y(){k.refresh(),$(),A.procs.refresh(),c&&c.update()}function W(){return(mt()-f)/1e3}function X(t,e){var n;switch(nt.type(e,"function","listener callback must be a function"),t){case"frame":return G(e);case"lost":n=O;break;case"restore":n=M;break;case"destroy":n=D;break;default:nt.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}Y();var Q=e(U,{clear:K,prop:dt.define.bind(null,Cs),context:dt.define.bind(null,Es),this:dt.define.bind(null,As),draw:U({}),buffer:function(t){return g.create(t,_s,!1,!1)},elements:function(t){return y.create(t,!1)},texture:k.create2D,cube:k.createCube,renderbuffer:C.create,framebuffer:E.create,framebufferCube:E.createCube,vao:w.createVAO,attributes:i,frame:G,on:X,limits:b,hasExtension:function(t){return b.extensions.indexOf(t.toLowerCase())>=0},read:P,destroy:N,_gl:r,_refresh:Y,poll:function(){H(),c&&c.update()},now:W,stats:u});return n.onDone(null,Q),Q}return Ss}()}(o)),o.exports),u=r(s);function l(e,n,r){const i=n.x.range(),a=n.y.range(),o=(i[1]-i[0])/(a[0]-a[1]),s=n.x.domain(),u=n.y.domain(),l=.5*(s[1]-s[0]),c=.5*(u[1]+u[0]),f=s[0],p=s[1],h=c-l/o,d=c+l/o;n.x.domain([f,p]).range(i),n.y.domain([h,d]).range(a),e.__zoom=null,t.select(e).call(function(e,n){const r=e.x.copy(),i=e.y.copy();return t.zoom().on("zoom",(function({transform:t}){let a=e.x.range().map(t.invertX,t);e.x.domain(r.domain()),e.x.domain(a.map(e.x.invert,e.x)),a=e.y.range().map(t.invertY,t),e.y.domain(i.domain()),e.y.domain(a.map(e.y.invert,e.y)),n()}))}(n,r)),r()}var c,f={exports:{}};var p,h,d=(c||(c=1,function(t){t.exports=function(){var t={CAP_START:0,CAP_END:1,CAP_SHORT:2};const e=t;var n=function(t,n,r,i,a,o,s,u,l,c,f,p){const h=n?u:s,d=["B","C","D"];n||d.unshift("A");const v={},m={},b=l.concat(h.attrs);if(i){m.vao=t.prop("vao");for(let t=0;t<b.length;t++)v[b[t].name]=t}else for(const t of b)v[t.name]=t.spec;const g=r?n?t=>[t.capRes2,Math.max(t.capRes2,t.joinRes2)]:t=>[Math.max(t.capRes2,t.joinRes2),Math.max(t.capRes2,t.joinRes2)]:n?t=>[t.capRes2,t.joinRes2]:t=>[t.joinRes2,t.joinRes2];return t({vert:`${a.glsl}const float CAP_START=${e.CAP_START}.0;const float CAP_END=${e.CAP_END}.0;${h.glsl}attribute float index;${p?"attribute float debugInstanceID;":""}uniform bool _isRound;uniform vec2 _vertCnt2,_capJoinRes2;uniform vec2 _resolution,_capScale;uniform float _miterLimit;${a.orientation||!n?"":"uniform float _orientation;"}varying vec3 lineCoord;${p?"varying vec2 triStripCoord;":""}${p?"varying float instanceID;":""}${p?"varying float vertexIndex;":""}bool isnan(float val){return(val<0.0||0.0<val||val==0.0)?false:true;}bool invalid(vec4 p){return p.w==0.0||isnan(p.x);}void main(){const float pi=3.141592653589793;${p?"vertexIndex=index;":""}lineCoord=vec3(0);${p?`instanceID=${n?"-1.0":"debugInstanceID"};`:""}${p?"triStripCoord=vec2(floor(index/2.0),mod(index,2.0));":""}${d.map((t=>`vec4 p${t}=${a.position.generate(a,t)};`)).join("\n")}gl_Position=pB;bool aInvalid=${n?"false":"invalid(pA)"};bool bInvalid=invalid(pB);bool cInvalid=invalid(pC);bool dInvalid=invalid(pD);vec2 v=_vertCnt2+3.0;float N=dot(v,vec2(1));bool mirror=index>=v.x;${n?"if(dInvalid && mirror)return;":""}float pw=mirror?pC.w:pB.w;${d.map((t=>`p${t}=vec4(vec3(p${t}.xy*_resolution,p${t}.z)/p${t}.w,1);`)).join("\n")}${n?"vec4 pA=pC;":""}if(bInvalid||cInvalid||max(abs(pB.z),abs(pC.z))>1.0)return;if(mirror){vec4 vTmp=pC; pC=pB; pB=vTmp;vTmp=pD; pD=pA; pA=vTmp;bool bTmp=dInvalid; dInvalid=aInvalid; aInvalid=bTmp;}${n?"bool isCap=!mirror;":(r?"":"const ")+"bool isCap=false"};if(aInvalid){ ${r?"pA=pC; isCap=true;":"pA=2.0*pB-pC;"} }if(dInvalid){ ${r?"pD=pB;":"pD=2.0*pC-pB;"} }bool roundOrCap=_isRound||isCap;float width=mirror?${a.width.generate(a,"C")}:${a.width.generate(a,"B")};vec2 tBC=pC.xy-pB.xy;float lBC=length(tBC);tBC/=lBC;vec2 nBC=vec2(-tBC.y,tBC.x);vec2 tAB=pB.xy-pA.xy;float lAB=length(tAB);if(lAB>0.0)tAB/=lAB;vec2 nAB=vec2(-tAB.y,tAB.x);vec2 tCD=pD.xy-pC.xy;float lCD=length(tCD);if(lCD>0.0)tCD/=lCD;vec2 nCD=vec2(-tCD.y,tCD.x);float cosB=clamp(dot(tAB,tBC),-1.0,1.0);const float tol=1e-4;float mirrorSign=mirror?-1.0:1.0;float dirB=-dot(tBC,nAB);float dirC=dot(tBC,nCD);bool bCollinear=abs(dirB)<tol;bool cCollinear=abs(dirC)<tol;bool bIsHairpin=bCollinear && cosB<0.0;dirB=bCollinear?-mirrorSign:sign(dirB);dirC=cCollinear?-mirrorSign:sign(dirC);vec2 miter=bIsHairpin?-tBC:0.5*(nAB+nBC)*dirB;float i=mirror?N-index:index;float res=(isCap?_capJoinRes2.x:_capJoinRes2.y);i-=max(0.0,(mirror?_vertCnt2.y:_vertCnt2.x)-res);i+=(dirB<0.0?-1.0:0.0);i-=mirror?1.0:0.0;i=max(0.0,i);vec2 xBasis=tBC;vec2 yBasis=nBC*dirB;vec2 xy=vec2(0);lineCoord.y=dirB*mirrorSign;if(i==res+1.0){float m=cosB>-0.9999?(tAB.x*tBC.y-tAB.y*tBC.x)/(1.0+cosB):0.0;xy=vec2(min(abs(m),min(lBC,lAB)/width),-1);lineCoord.y=-lineCoord.y;} else {float m2=dot(miter,miter);float lm=sqrt(m2);yBasis=miter/lm;xBasis=dirB*vec2(yBasis.y,-yBasis.x);bool isBevel=1.0>_miterLimit*m2;if(mod(i,2.0)==0.0){if(roundOrCap||i !=0.0){float theta=-0.5*(acos(cosB)*(clamp(i,0.0,res)/res)-pi)*(isCap?2.0:1.0);xy=vec2(cos(theta),sin(theta));if(isCap){if(xy.y>0.001)xy*=_capScale;lineCoord.xy=xy.yx*lineCoord.y;}} else {yBasis=bIsHairpin?vec2(0):miter;xy.y=isBevel?1.0:1.0/m2;}} else {lineCoord.y=0.0;if(isBevel && !roundOrCap){xy.y=-1.0+sqrt((1.0+cosB)*0.5);}}}${n?`float _orientation=${a.orientation?a.orientation.generate(a,""):"mod(_orientation,2.0)"};`:""};${n?"if(_orientation==CAP_END)lineCoord.xy=-lineCoord.xy;":""}vec2 dP=mat2(xBasis,yBasis)*xy;float dx=dot(dP,tBC)*mirrorSign;float useC=(mirror?1.0:0.0)+dx*(width/lBC);lineCoord.z=useC<0.0||useC>1.0?1.0:0.0;${[...a.varyings.values()].map((t=>t.generate(a,"useC","B","C"))).join("\n")}gl_Position=pB;gl_Position.xy+=width*dP;gl_Position.xy/=_resolution;gl_Position*=pw;${a.postproject?`gl_Position=${a.postproject}(gl_Position);`:""}}`,frag:o,attributes:v,uniforms:{...f,_vertCnt2:(t,e)=>g(e),_capJoinRes2:(t,e)=>[e.capRes2,e.joinRes2],_miterLimit:(t,e)=>e.miterLimit*e.miterLimit,_orientation:t.prop("orientation"),_capScale:t.prop("capScale"),_isRound:(t,e)=>"round"===e.join,_resolution:(t,e)=>e.viewportSize||[t.viewportWidth,t.viewportHeight]},primitive:"triangle strip",instances:n?(t,n)=>n.instances*(n.splitCaps?n.orientation===e.CAP_START?Math.ceil(n.count/2):Math.floor(n.count/2):n.count):(t,e)=>e.instances*(e.count-3),count:(t,e)=>{const n=g(e);return 6+(n[0]+n[1])},...c,...m})},r={NONE:0,REGULAR:1,EXTENDED:2,PER_INSTANCE:4};const i=r;var a=function(t){const e=[],n=t.split("\n");for(let t=0;t<n.length;t++)n[t]=n[t].replace(o,(function(t,n){return e.push(p(n)),""}));return{glsl:n.join("\n").trim(),...h(e)}};const o=/^\s*#pragma\s+lines\s*:\s*([^;]*);?$/i,s=/^\s*(?:(instance)?)\s*attribute\s+(float|vec2|vec3|vec4)\s+([\w\d_]+)\s*$/i,u=/^\s*(position|width|orientation)\s+=\s+([\w\d_]+)\s*\(([^)]*)\)\s*$/i,l=/^\s*(?:(extrapolate)?)\s*varying\s+(float|vec2|vec3|vec4)\s+([\w\d_]+)\s*=\s*([\w\d_]+)\(([^)]*)\)\s*$/,c=/^\s*postproject\s+=\s+([\w\d_]+)\s*$/i,f={float:1,vec2:2,vec3:3,vec4:4};function p(t){let e;if(e=(t=t.trim()).match(s)){const t=!!e[1];return{type:"attribute",dimension:f[e[2]],name:e[3],isInstanceAttr:t}}if(e=t.match(u)){const t=e[1],n={width:"float",position:"vec4",orientation:"bool"}[t],r=e[2],i=e[3].split(",").map((t=>t.trim())).filter((t=>!!t)),a=(t,e,n)=>`${r}(${i.map((r=>t.attrs.get(r).isInstanceAttr?r:(n||"")+r+e)).join(",")})`;return{type:"property",property:t,returnType:n,name:r,inputs:i,generate:a}}if(e=t.match(l)){const t="extrapolate"===e[1],n=e[2],r=e[3],i=e[4],a=e[5].split(",").map((t=>t.trim())).filter((t=>!!t)),o=(e,n,o,s)=>{const u=t?n:`clamp(${n},0.0,1.0)`;return`${r}=${i}(${a.map((t=>`mix(${t+o},${t+s},${u})`)).join(",")});`};return{type:"varying",returnType:n,name:r,getter:i,inputs:a,generate:o}}if(e=t.match(c))return{type:"postproject",name:e[1]};throw new Error(`Unrecognized lines pragma:"${t}"`)}function h(t){let e;const n=new Map,r=new Map;for(const a of t)"attribute"===a.type?(n.set(a.name,a),a.vertexUsage=i.NONE,a.endpointUsage=i.NONE):"varying"===a.type?r.set(a.name,a):"postproject"===a.type&&(e=a.name);let a,o,s;for(const e of t)if("property"===e.type){switch(e.property){case"width":if(a)throw new Error(`Unexpected duplicate pragma for property "${e.property}"`);a=e;break;case"position":if(o)throw new Error(`Unexpected duplicate pragma for property "${e.property}"`);o=e;break;case"orientation":if(s)throw new Error(`Unexpected duplicate pragma for property "${e.property}"`);s=e;break;default:throw new Error(`Invalid pragma property "${e.property}"`)}for(const t of e.inputs)if(!n.has(t))throw new Error(`Missing attribute ${t} of property ${e.property}`)}for(const e of t)if(e.inputs)for(const t of e.inputs){const r=n.get(t);r.isInstanceAttr?(r.vertexUsage=i.PER_INSTANCE,r.endpointUsage=i.PER_INSTANCE):"property"!==e.type&&"varying"!==e.type||("position"===e.property?(r.vertexUsage|=i.EXTENDED,r.endpointUsage|=i.EXTENDED):"orientation"===e.property?r.endpointUsage|=i.PER_INSTANCE:(r.endpointUsage|=i.REGULAR,r.vertexUsage|=i.REGULAR))}return{varyings:r,attrs:n,width:a,position:o,orientation:s,postproject:e}}const d=[];d[5120]=1,d[5122]=2,d[5124]=4,d[5121]=1,d[5123]=2,d[5125]=4,d[5126]=4;var v={int8:5120,uint8:5121,int16:5122,uint16:5123,int32:5124,uint32:5125,float:5126,float32:5126},m=function(t,e,n){const r={};if(!e)return r;for(let[i,a]of t.attrs){const t=e[i];if(!(n?a.endpointUsage:a.vertexUsage))continue;const o={buffer:null,dimension:a.dimension,offset:0,type:NaN,stride:NaN,divisor:1,normalized:!1,bytesPerElement:NaN};if(!t)throw new Error(`Missing buffer for ${n?"endpoint":"vertex"} attribute '${i}'`);if("buffer"===t._reglType)o.buffer=t,o.type=o.buffer._buffer.dtype;else{if(!t.buffer||"buffer"!==t.buffer._reglType)throw new Error(`Invalid buffer for attribute '${i}'. Be sure to wrap in regl.buffer().`);if(o.buffer=t.buffer,y(t,"dimension")&&t.dimension!==o.dimension)throw new Error(`Size of attribute(${t.dimension})does not match dimension specified in shader pragma(${a.dimension})`);y(t,"offset")&&(o.offset=t.offset),y(t,"type")?o.type=g[t.type]:o.type=o.buffer._buffer.dtype,y(t,"divisor")&&(o.divisor=t.divisor),y(t,"normalized")&&(o.normalized=!!t.normalized),y(t,"stride")&&(o.stride=t.stride)}o.bytesPerElement=b[o.type],Number.isNaN(o.stride)&&(o.stride=o.bytesPerElement*a.dimension),r[i]=o}return r};const b=d,g=v;function y(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const w=[];w[1]="float",w[2]="vec2",w[3]="vec3",w[4]="vec4";var _=function(t,e,n){const r=n?["B","C","D"]:["A","B","C","D"],i=[],a=[];return t.attrs.forEach(((t,e)=>{const o=n?t.endpointUsage:t.vertexUsage;if(!o)return;const s=[];function u(r,i){const u=e+i;if(s.push(u),n){const n=o&x.PER_INSTANCE?1:3;a.push({name:u,spec:{buffer:(t,n)=>n.buffers[e].buffer,offset:t.isInstanceAttr?(t,n)=>n.buffers[e].offset+n.buffers[e].stride*r:(t,n)=>n.buffers[e].offset+n.buffers[e].stride*((n.orientation!==E.CAP_START&&n.splitCaps?3:0)+r),stride:(t,r)=>r.buffers[e].stride*n*(r.splitCaps?2:1),divisor:(n,r)=>(t.isInstanceAttr?1:r.instances)*r.buffers[e].divisor,normalized:(t,n)=>void 0!==n.buffers[e].normalized&&n.buffers[e].normalized,type:(t,n)=>{const r=n.buffers[e];return A.get(void 0===r.type?r.buffer._buffer.dtype:r.type)}}})}else a.push({name:u,spec:{buffer:(t,n)=>n.buffers[e].buffer,offset:(t,n)=>n.buffers[e].offset+n.buffers[e].stride*r,stride:(t,n)=>n.buffers[e].stride,divisor:(n,r)=>(t.isInstanceAttr?1:r.instances)*r.buffers[e].divisor,normalized:(t,n)=>void 0!==n.buffers[e].normalized&&n.buffers[e].normalized,type:(t,n)=>{const r=n.buffers[e];return A.get(void 0===r.type?r.buffer._buffer.dtype:r.type)}}})}if(o&x.PER_INSTANCE&&u(0,""),o&x.REGULAR||o&x.EXTENDED)for(let t=0;t<r.length;t++){const e=r[t];(o&x.EXTENDED||"D"!==e&&"A"!==e)&&u(t,e)}i.push(`attribute ${C[t.dimension]} ${s.join(",")};`)})),t.varyings.forEach(((t,e)=>{i.push(`varying ${t.returnType} ${e};`)})),{glsl:i.join("\n"),attrs:a}};const x=r,k=v,C=w,E=t,A=new Map(Object.entries(k).map((t=>t.reverse()))),P=n,S=a,V=m,j=_,O=function(t,e,n){return function(r){if(!r)return n;if(-1===e.indexOf(r))throw new Error(`Invalid ${t} type. Valid options are:${e.join(",")}.`);return r}},M=t;var D=G;G.CAP_START=M.CAP_START,G.CAP_END=M.CAP_END;const T=new Set(["attributes","elements"]),B=["round","bevel","miter"],I=["round","square","none"],R=[1,1],L=[2,2/Math.sqrt(3)],z=32,N=16384,U=1,F=2,q=4;function K(t,e,n){return(t?U:0)+(e?F:0)+(n?q:0)}function G(t,e={}){if(!t.hasExtension("ANGLE_instanced_arrays"))throw new Error("regl-gpu-lines requries the ANGLE_instanced_arrays extension");const{vert:n=null,frag:r=null,debug:i=!1,reorder:a=!1}=e;t._gpuLinesCache||(t._gpuLinesCache={});const o=t._gpuLinesCache,s={...e},u=e.uniforms||{};for(const t of["vert","frag","debug","reorder","uniforms"])delete s[t];if(Object.keys(s).forEach((t=>{if(T.has(t))throw new Error(`Invalid parameter '${t}'. Parameters ${[...T].map((t=>`'${t}'`)).join(",")} may not be forwarded to regl.`)})),!n)throw new Error("Missing vertex shader,`vert`");if(!r)throw new Error("Missing fragment shader,`frag`");const l=S(n),c=j(l,t,!1),f=j(l,t,!0),p=[];i&&(o.debugInstanceIDBuffer||(o.debugInstanceIDBuffer=t.buffer(new Uint16Array([...Array(N).keys()]))),p.push({name:"debugInstanceID",spec:{buffer:o.debugInstanceIDBuffer,divisor:(t,e)=>e.instances}})),o.indexBuffer||(o.indexBuffer=t.buffer(new Uint8Array([...Array(4*z+6).keys()]))),p.push({name:"index",spec:{buffer:o.indexBuffer,divisor:0}});const h=O("join",B,"miter"),d=O("cap",I,"square"),v=new Map;function m(e){return v.has(e)||v.set(e,P(t,e&U,e&F,e&q,l,r,c,f,p,s,u,i)),v.get(e)}const b=[];function g(...t){b.push.apply(b,t)}function y(){a&&b.sort((function(t,e){return t.featureMask-e.featureMask}));let t=0;const e=[];for(;t<b.length;){const{featureMask:n,props:r}=b[t];for(e.push(r);++t<b.length&&b[t].featureMask===n;)e.push(b[t].props);m(n)(e),e.length=0}b.length=0}const w=function(t){if(t){Array.isArray(t)||(t=[t]);for(const e of t){const t=h(e.join),n=d(e.cap),r=!!e.vao;let i=void 0===e.capResolution?12:e.capResolution;"square"===n?i=3:"none"===n&&(i=1);let a=1;"round"===t&&(a=void 0===e.joinResolution?8:e.joinResolution),i*=2,a*=2;const o="bevel"===t?1:void 0===e.miterLimit?4:e.miterLimit,s="square"===n?L:R,u=!!e.insertCaps,c={joinRes2:a,capRes2:i,capScale:s,join:t,miterLimit:o,insertCaps:u};if(e.endpointCount){const t={instances:1,count:e.endpointCount,...e,...c};let n=K(!0,u,r);if(r)if(l.orientation){const e={vao:t.vao.endpoints};g({featureMask:n,props:{...t,...e}})}else{const e={vao:t.vao.startCaps},r={vao:t.vao.endCaps};g({featureMask:n,props:{...t,...e,orientation:M.CAP_START,splitCaps:!0}},{featureMask:n,props:{...t,...r,orientation:M.CAP_END,splitCaps:!0}})}else t.buffers=V(l,e.endpointAttributes,!0),l.orientation?g({featureMask:n,props:{...t,splitCaps:!1}}):g({featureMask:n,props:{...t,orientation:M.CAP_START,splitCaps:!0}},{featureMask:n,props:{...t,orientation:M.CAP_END,splitCaps:!0}})}if(void 0===e.instances&&(e.instances=1),e.vertexCount){const t=K(!1,u,r),n={count:e.vertexCount,...e,...c};r?n.vao=e.vao.vertices:n.buffers=V(l,e.vertexAttributes,!1),g({featureMask:t,props:n})}y()}}};return w.vao=function(e){const n={},r=[["vertices",c.attrs,e.vertexAttributes,!1]];l.orientation?r.push(["endpoints",f.attrs,e.endpointAttributes,!0,!1,null]):r.push(["startCaps",f.attrs,e.endpointAttributes,!0,!0,M.CAP_START],["endCaps",f.attrs,e.endpointAttributes,!0,!0,M.CAP_END]);for(const[e,i,a,o,s,u]of r){if(!a)continue;const r={buffers:V(l,a,o),splitCaps:s,orientation:u},c=[];for(const t of p.concat(i)){const e={};for(const n of["buffer","divisor","offset","stride","normalized","dimension"]){let i=t.spec[n];i&&i.data&&(i=i.data),"function"==typeof i&&(i=i({},r)),void 0!==i&&(e[n]=i)}c.push(e)}n[e]=t.vao(c)}return n.destroy=function(){for(const[t]of r)n[t]&&(n[t].destroy(),delete n[t])},n},w}return D}()}(f)),f.exports),v=r(d);function m(){if(h)return p;return h=1,p=function(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}}var b=r(m());const g={t:0,r:0,b:0,l:0};var y,w,_,x,k,C,E,A,P,S,V,j,O,M,D,T,B,I,R,L,z,N,U,F,q,K,G,$,H,Y,W,X,Q,Z,J,tt;function et(){if(w)return y;return w=1,y=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t[0]=o*c-s*l,t[1]=i*l-r*c,t[2]=r*s-i*o,t[3]=s*u-a*c,t[4]=n*c-i*u,t[5]=i*a-n*s,t[6]=a*l-o*u,t[7]=r*u-n*l,t[8]=n*o-r*a,t}}function nt(){if(x)return _;return x=1,_=function(t){var e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}}function rt(){if(C)return k;return C=1,k=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}}function it(){if(A)return E;return A=1,E=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*(l*a-o*u)+n*(o*s-l*i)+r*(u*i-a*s)}}function at(){if(S)return P;return S=1,P=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8])}}function ot(){if(j)return V;return j=1,V=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}}function st(){if(M)return O;return M=1,O=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}}function ut(){if(T)return D;return T=1,D=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,f=r*s,p=i*o,h=i*s,d=i*u,v=a*o,m=a*s,b=a*u;return t[0]=1-f-d,t[3]=c-b,t[6]=p+m,t[1]=c+b,t[4]=1-l-d,t[7]=h-v,t[2]=p-m,t[5]=h+v,t[8]=1-l-f,t}}function lt(){if(I)return B;return I=1,B=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}}function ct(){if(L)return R;return L=1,R=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],f=c*o-s*l,p=-c*a+s*u,h=l*a-o*u,d=n*f+r*p+i*h;return d?(d=1/d,t[0]=f*d,t[1]=(-c*r+i*l)*d,t[2]=(s*r-i*o)*d,t[3]=p*d,t[4]=(c*n-i*u)*d,t[5]=(-s*n+i*a)*d,t[6]=h*d,t[7]=(-l*n+r*u)*d,t[8]=(o*n-r*a)*d,t):null}}function ft(){if(N)return z;return N=1,z=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],p=n[0],h=n[1],d=n[2],v=n[3],m=n[4],b=n[5],g=n[6],y=n[7],w=n[8];return t[0]=p*r+h*o+d*l,t[1]=p*i+h*s+d*c,t[2]=p*a+h*u+d*f,t[3]=v*r+m*o+b*l,t[4]=v*i+m*s+b*c,t[5]=v*a+m*u+b*f,t[6]=g*r+y*o+w*l,t[7]=g*i+y*s+w*c,t[8]=g*a+y*u+w*f,t}}function pt(){if(F)return U;return F=1,U=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],f=e[9],p=e[10],h=e[11],d=e[12],v=e[13],m=e[14],b=e[15],g=n*s-r*o,y=n*u-i*o,w=n*l-a*o,_=r*u-i*s,x=r*l-a*s,k=i*l-a*u,C=c*v-f*d,E=c*m-p*d,A=c*b-h*d,P=f*m-p*v,S=f*b-h*v,V=p*b-h*m,j=g*V-y*S+w*P+_*A-x*E+k*C;return j?(j=1/j,t[0]=(s*V-u*S+l*P)*j,t[1]=(u*A-o*V-l*E)*j,t[2]=(o*S-s*A+l*C)*j,t[3]=(i*S-r*V-a*P)*j,t[4]=(n*V-i*A+a*E)*j,t[5]=(r*A-n*S-a*C)*j,t[6]=(v*k-m*x+b*_)*j,t[7]=(m*w-d*k-b*y)*j,t[8]=(d*x-v*w+b*g)*j,t):null}}function ht(){if(K)return q;return K=1,q=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],p=Math.sin(n),h=Math.cos(n);return t[0]=h*r+p*o,t[1]=h*i+p*s,t[2]=h*a+p*u,t[3]=h*o-p*r,t[4]=h*s-p*i,t[5]=h*u-p*a,t[6]=l,t[7]=c,t[8]=f,t}}function dt(){if($)return G;return $=1,G=function(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}}function vt(){if(Y)return H;return Y=1,H=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}}function mt(){if(X)return W;return X=1,W=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],p=n[0],h=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=p*r+h*o+l,t[7]=p*i+h*s+c,t[8]=p*a+h*u+f,t}}function bt(){if(Z)return Q;return Z=1,Q=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}}var gt,yt,wt,_t,xt,kt,Ct,Et,At,Pt,St,Vt,jt,Ot,Mt,Dt,Tt,Bt,It,Rt,Lt,zt,Nt,Ut,Ft,qt,Kt,Gt,$t,Ht,Yt,Wt,Xt,Qt,Zt,Jt,te,ee,ne,re,ie,ae,oe,se,ue,le,ce,fe,pe,he,de,ve,me,be,ge,ye,we,_e,xe,ke,Ce=tt?J:(tt=1,J={adjoint:et(),clone:nt(),copy:rt(),create:m(),determinant:it(),frob:at(),fromMat2:ot(),fromMat4:st(),fromQuat:ut(),identity:lt(),invert:ct(),multiply:ft(),normalFromMat4:pt(),rotate:ht(),scale:dt(),str:vt(),translate:mt(),transpose:bt()});function Ee(){if(yt)return gt;return yt=1,gt=function(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}}function Ae(){if(_t)return wt;return _t=1,wt=function(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}}function Pe(){if(kt)return xt;return kt=1,xt=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}}function Se(){if(Et)return Ct;return Et=1,Ct=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}}function Ve(){if(Pt)return At;return Pt=1,At=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}}function je(){if(Vt)return St;return Vt=1,St=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],f=e[9],p=e[10],h=e[11],d=e[12],v=e[13],m=e[14],b=e[15],g=n*s-r*o,y=n*u-i*o,w=n*l-a*o,_=r*u-i*s,x=r*l-a*s,k=i*l-a*u,C=c*v-f*d,E=c*m-p*d,A=c*b-h*d,P=f*m-p*v,S=f*b-h*v,V=p*b-h*m,j=g*V-y*S+w*P+_*A-x*E+k*C;if(!j)return null;return j=1/j,t[0]=(s*V-u*S+l*P)*j,t[1]=(i*S-r*V-a*P)*j,t[2]=(v*k-m*x+b*_)*j,t[3]=(p*x-f*k-h*_)*j,t[4]=(u*A-o*V-l*E)*j,t[5]=(n*V-i*A+a*E)*j,t[6]=(m*w-d*k-b*y)*j,t[7]=(c*k-p*w+h*y)*j,t[8]=(o*S-s*A+l*C)*j,t[9]=(r*A-n*S-a*C)*j,t[10]=(d*x-v*w+b*g)*j,t[11]=(f*w-c*x-h*g)*j,t[12]=(s*E-o*P-u*C)*j,t[13]=(n*P-r*E+i*C)*j,t[14]=(v*y-d*_-m*g)*j,t[15]=(c*_-f*y+p*g)*j,t}}function Oe(){if(Ot)return jt;return Ot=1,jt=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],f=e[9],p=e[10],h=e[11],d=e[12],v=e[13],m=e[14],b=e[15];return t[0]=s*(p*b-h*m)-f*(u*b-l*m)+v*(u*h-l*p),t[1]=-(r*(p*b-h*m)-f*(i*b-a*m)+v*(i*h-a*p)),t[2]=r*(u*b-l*m)-s*(i*b-a*m)+v*(i*l-a*u),t[3]=-(r*(u*h-l*p)-s*(i*h-a*p)+f*(i*l-a*u)),t[4]=-(o*(p*b-h*m)-c*(u*b-l*m)+d*(u*h-l*p)),t[5]=n*(p*b-h*m)-c*(i*b-a*m)+d*(i*h-a*p),t[6]=-(n*(u*b-l*m)-o*(i*b-a*m)+d*(i*l-a*u)),t[7]=n*(u*h-l*p)-o*(i*h-a*p)+c*(i*l-a*u),t[8]=o*(f*b-h*v)-c*(s*b-l*v)+d*(s*h-l*f),t[9]=-(n*(f*b-h*v)-c*(r*b-a*v)+d*(r*h-a*f)),t[10]=n*(s*b-l*v)-o*(r*b-a*v)+d*(r*l-a*s),t[11]=-(n*(s*h-l*f)-o*(r*h-a*f)+c*(r*l-a*s)),t[12]=-(o*(f*m-p*v)-c*(s*m-u*v)+d*(s*p-u*f)),t[13]=n*(f*m-p*v)-c*(r*m-i*v)+d*(r*p-i*f),t[14]=-(n*(s*m-u*v)-o*(r*m-i*v)+d*(r*u-i*s)),t[15]=n*(s*p-u*f)-o*(r*p-i*f)+c*(r*u-i*s),t}}function Me(){if(Dt)return Mt;return Dt=1,Mt=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],f=t[10],p=t[11],h=t[12],d=t[13],v=t[14],m=t[15];return(e*o-n*a)*(f*m-p*v)-(e*s-r*a)*(c*m-p*d)+(e*u-i*a)*(c*v-f*d)+(n*s-r*o)*(l*m-p*h)-(n*u-i*o)*(l*v-f*h)+(r*u-i*s)*(l*d-c*h)}}function De(){if(Bt)return Tt;return Bt=1,Tt=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],p=e[9],h=e[10],d=e[11],v=e[12],m=e[13],b=e[14],g=e[15],y=n[0],w=n[1],_=n[2],x=n[3];return t[0]=y*r+w*s+_*f+x*v,t[1]=y*i+w*u+_*p+x*m,t[2]=y*a+w*l+_*h+x*b,t[3]=y*o+w*c+_*d+x*g,y=n[4],w=n[5],_=n[6],x=n[7],t[4]=y*r+w*s+_*f+x*v,t[5]=y*i+w*u+_*p+x*m,t[6]=y*a+w*l+_*h+x*b,t[7]=y*o+w*c+_*d+x*g,y=n[8],w=n[9],_=n[10],x=n[11],t[8]=y*r+w*s+_*f+x*v,t[9]=y*i+w*u+_*p+x*m,t[10]=y*a+w*l+_*h+x*b,t[11]=y*o+w*c+_*d+x*g,y=n[12],w=n[13],_=n[14],x=n[15],t[12]=y*r+w*s+_*f+x*v,t[13]=y*i+w*u+_*p+x*m,t[14]=y*a+w*l+_*h+x*b,t[15]=y*o+w*c+_*d+x*g,t}}function Te(){if(Rt)return It;return Rt=1,It=function(t,e,n){var r,i,a,o,s,u,l,c,f,p,h,d,v=n[0],m=n[1],b=n[2];e===t?(t[12]=e[0]*v+e[4]*m+e[8]*b+e[12],t[13]=e[1]*v+e[5]*m+e[9]*b+e[13],t[14]=e[2]*v+e[6]*m+e[10]*b+e[14],t[15]=e[3]*v+e[7]*m+e[11]*b+e[15]):(r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],p=e[9],h=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=f,t[9]=p,t[10]=h,t[11]=d,t[12]=r*v+s*m+f*b+e[12],t[13]=i*v+u*m+p*b+e[13],t[14]=a*v+l*m+h*b+e[14],t[15]=o*v+c*m+d*b+e[15]);return t}}function Be(){if(zt)return Lt;return zt=1,Lt=function(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}}function Ie(){if(Ut)return Nt;return Ut=1,Nt=function(t,e,n,r){var i,a,o,s,u,l,c,f,p,h,d,v,m,b,g,y,w,_,x,k,C,E,A,P,S=r[0],V=r[1],j=r[2],O=Math.sqrt(S*S+V*V+j*j);if(Math.abs(O)<1e-6)return null;O=1/O,S*=O,V*=O,j*=O,i=Math.sin(n),a=Math.cos(n),o=1-a,s=e[0],u=e[1],l=e[2],c=e[3],f=e[4],p=e[5],h=e[6],d=e[7],v=e[8],m=e[9],b=e[10],g=e[11],y=S*S*o+a,w=V*S*o+j*i,_=j*S*o-V*i,x=S*V*o-j*i,k=V*V*o+a,C=j*V*o+S*i,E=S*j*o+V*i,A=V*j*o-S*i,P=j*j*o+a,t[0]=s*y+f*w+v*_,t[1]=u*y+p*w+m*_,t[2]=l*y+h*w+b*_,t[3]=c*y+d*w+g*_,t[4]=s*x+f*k+v*C,t[5]=u*x+p*k+m*C,t[6]=l*x+h*k+b*C,t[7]=c*x+d*k+g*C,t[8]=s*E+f*A+v*P,t[9]=u*E+p*A+m*P,t[10]=l*E+h*A+b*P,t[11]=c*E+d*A+g*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t},Nt}function Re(){if(qt)return Ft;return qt=1,Ft=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],f=e[10],p=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[4]=a*i+l*r,t[5]=o*i+c*r,t[6]=s*i+f*r,t[7]=u*i+p*r,t[8]=l*i-a*r,t[9]=c*i-o*r,t[10]=f*i-s*r,t[11]=p*i-u*r,t}}function Le(){if(Gt)return Kt;return Gt=1,Kt=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],c=e[9],f=e[10],p=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[0]=a*i-l*r,t[1]=o*i-c*r,t[2]=s*i-f*r,t[3]=u*i-p*r,t[8]=a*r+l*i,t[9]=o*r+c*i,t[10]=s*r+f*i,t[11]=u*r+p*i,t}}function ze(){if(Ht)return $t;return Ht=1,$t=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],f=e[6],p=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[0]=a*i+l*r,t[1]=o*i+c*r,t[2]=s*i+f*r,t[3]=u*i+p*r,t[4]=l*i-a*r,t[5]=c*i-o*r,t[6]=f*i-s*r,t[7]=p*i-u*r,t}}function Ne(){if(Wt)return Yt;return Wt=1,Yt=function(t,e,n){var r,i,a,o=n[0],s=n[1],u=n[2],l=Math.sqrt(o*o+s*s+u*u);if(Math.abs(l)<1e-6)return null;return l=1/l,o*=l,s*=l,u*=l,r=Math.sin(e),i=Math.cos(e),a=1-i,t[0]=o*o*a+i,t[1]=s*o*a+u*r,t[2]=u*o*a-s*r,t[3]=0,t[4]=o*s*a-u*r,t[5]=s*s*a+i,t[6]=u*s*a+o*r,t[7]=0,t[8]=o*u*a+s*r,t[9]=s*u*a-o*r,t[10]=u*u*a+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Yt}function Ue(){if(Qt)return Xt;return Qt=1,Xt=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,u=i+i,l=a+a,c=r*s,f=r*u,p=r*l,h=i*u,d=i*l,v=a*l,m=o*s,b=o*u,g=o*l;return t[0]=1-(h+v),t[1]=f+g,t[2]=p-b,t[3]=0,t[4]=f-g,t[5]=1-(c+v),t[6]=d+m,t[7]=0,t[8]=p+b,t[9]=d-m,t[10]=1-(c+h),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}}function Fe(){if(Jt)return Zt;return Jt=1,Zt=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}}function qe(){if(ee)return te;return ee=1,te=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}}function Ke(){if(re)return ne;return re=1,ne=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}}function Ge(){if(ae)return ie;return ae=1,ie=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}}function $e(){if(se)return oe;return se=1,oe=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}}function He(){if(le)return ue;return le=1,ue=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,f=r*s,p=i*o,h=i*s,d=i*u,v=a*o,m=a*s,b=a*u;return t[0]=1-f-d,t[1]=c+b,t[2]=p-m,t[3]=0,t[4]=c-b,t[5]=1-l-d,t[6]=h+v,t[7]=0,t[8]=p+m,t[9]=h-v,t[10]=1-l-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}}function Ye(){if(fe)return ce;return fe=1,ce=function(t,e,n,r,i,a,o){var s=1/(n-e),u=1/(i-r),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}}function We(){if(he)return pe;return he=1,pe=function(t,e,n,r,i){var a=1/Math.tan(e/2),o=1/(r-i);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*o,t[15]=0,t}}function Xe(){if(ve)return de;return ve=1,de=function(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(i+a);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(o-s)*u*.5,t[9]=(i-a)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}}function Qe(){if(be)return me;return be=1,me=function(t,e,n,r,i,a,o){var s=1/(e-n),u=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(o+a)*l,t[15]=1,t}}function Ze(){if(ye)return ge;ye=1;var t=Se();return ge=function(e,n,r,i){var a,o,s,u,l,c,f,p,h,d,v=n[0],m=n[1],b=n[2],g=i[0],y=i[1],w=i[2],_=r[0],x=r[1],k=r[2];if(Math.abs(v-_)<1e-6&&Math.abs(m-x)<1e-6&&Math.abs(b-k)<1e-6)return t(e);f=v-_,p=m-x,h=b-k,d=1/Math.sqrt(f*f+p*p+h*h),f*=d,p*=d,h*=d,a=y*h-w*p,o=w*f-g*h,s=g*p-y*f,d=Math.sqrt(a*a+o*o+s*s),d?(a*=d=1/d,o*=d,s*=d):(a=0,o=0,s=0);u=p*s-h*o,l=h*a-f*s,c=f*o-p*a,d=Math.sqrt(u*u+l*l+c*c),d?(u*=d=1/d,l*=d,c*=d):(u=0,l=0,c=0);return e[0]=a,e[1]=u,e[2]=f,e[3]=0,e[4]=o,e[5]=l,e[6]=p,e[7]=0,e[8]=s,e[9]=c,e[10]=h,e[11]=0,e[12]=-(a*v+o*m+s*b),e[13]=-(u*v+l*m+c*b),e[14]=-(f*v+p*m+h*b),e[15]=1,e},ge}function Je(){if(_e)return we;return _e=1,we=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}}var tn,en,nn=ke?xe:(ke=1,xe={create:Ee(),clone:Ae(),copy:Pe(),identity:Se(),transpose:Ve(),invert:je(),adjoint:Oe(),determinant:Me(),multiply:De(),translate:Te(),scale:Be(),rotate:Ie(),rotateX:Re(),rotateY:Le(),rotateZ:ze(),fromRotation:Ne(),fromRotationTranslation:Ue(),fromScaling:Fe(),fromTranslation:qe(),fromXRotation:Ke(),fromYRotation:Ge(),fromZRotation:$e(),fromQuat:He(),frustum:Ye(),perspective:We(),perspectiveFromFieldOfView:Xe(),ortho:Qe(),lookAt:Ze(),str:Je()});var rn,an,on=(en||(en=1,tn=function(t,e){let n=e.x.domain(),r=e.y.domain(),i=2/(n[1]-n[0]),a=2/(r[1]-r[0]);return t[0]=i,t[1]=0,t[2]=0,t[3]=0,t[4]=a,t[5]=0,t[6]=-1-i*n[0],t[7]=-1-a*r[0],t[8]=1,t}),tn),sn=r(on);var un,ln,cn,fn,pn,hn,dn=r(an?rn:(an=1,rn=function(t,e){t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=e[4],t[6]=0,t[7]=e[5],t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[6],t[13]=e[7],t[14]=0,t[15]=e[8]}));function vn(){if(fn)return cn;function t(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}return fn=1,cn=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}}function mn(){if(hn)return pn;hn=1;var t=ln?un:(ln=1,un=function(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=n;return e}),e=vn(),n="undefined"!=typeof Float64Array;function r(t,e){return t[0]-e[0]}function i(){var t,e=this.stride,n=new Array(e.length);for(t=0;t<n.length;++t)n[t]=[Math.abs(e[t]),t];n.sort(r);var i=new Array(n.length);for(t=0;t<i.length;++t)i[t]=n[t][1];return i}function a(e,n){var r=["View",n,"d",e].join("");n<0&&(r="View_Nil"+e);var a="generic"===e;if(-1===n){var s="function "+r+"(a){this.data=a;};\tvar proto="+r+".prototype;\tproto.dtype='"+e+"';\tproto.index=function(){return -1};\tproto.size=0;\tproto.dimension=-1;\tproto.shape=proto.stride=proto.order=[];\tproto.lo=proto.hi=proto.transpose=proto.step=\tfunction(){return new "+r+"(this.data);};\tproto.get=proto.set=function(){};\tproto.pick=function(){return null};\treturn function construct_"+r+"(a){return new "+r+"(a);}";return new Function(s)()}if(0===n){s="function "+r+"(a,d) {\tthis.data = a;\tthis.offset = d\t};\tvar proto="+r+".prototype;\tproto.dtype='"+e+"';\tproto.index=function(){return this.offset};\tproto.dimension=0;\tproto.size=1;\tproto.shape=\tproto.stride=\tproto.order=[];\tproto.lo=\tproto.hi=\tproto.transpose=\tproto.step=function "+r+"_copy() {\treturn new "+r+"(this.data,this.offset)\t};\tproto.pick=function "+r+"_pick(){\treturn TrivialArray(this.data);\t};\tproto.valueOf=proto.get=function "+r+"_get(){\treturn "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};\tproto.set=function "+r+"_set(v){\treturn "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"\t};\treturn function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",s)(o[e][0])}s=["'use strict'"];var u=t(n),l=u.map((function(t){return"i"+t})),c="this.offset+"+u.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),f=u.map((function(t){return"b"+t})).join(","),p=u.map((function(t){return"c"+t})).join(",");s.push("function "+r+"(a,"+f+","+p+",d){this.data=a","this.shape=["+f+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+n),s.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){\treturn "+u.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===n?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),n<4?(s.push("function "+r+"_order(){"),2===n?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===n&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\tif(s0>s1){\tif(s1>s2){\treturn [2,1,0];\t}else if(s0>s2){\treturn [1,2,0];\t}else{\treturn [1,0,2];\t}\t}else if(s0>s2){\treturn [2,0,1];\t}else if(s2>s1){\treturn [0,1,2];\t}else{\treturn [0,2,1];\t}}})")):s.push("ORDER})")),s.push("proto.set=function "+r+"_set("+l.join(",")+",v){"),a?s.push("return this.data.set("+c+",v)}"):s.push("return this.data["+c+"]=v}"),s.push("proto.get=function "+r+"_get("+l.join(",")+"){"),a?s.push("return this.data.get("+c+")}"):s.push("return this.data["+c+"]}"),s.push("proto.index=function "+r+"_index(",l.join(),"){return "+c+"}"),s.push("proto.hi=function "+r+"_hi("+l.join(",")+"){return new "+r+"(this.data,"+u.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+u.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var h=u.map((function(t){return"a"+t+"=this.shape["+t+"]"})),d=u.map((function(t){return"c"+t+"=this.stride["+t+"]"}));s.push("proto.lo=function "+r+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+h.join(",")+","+d.join(","));for(var v=0;v<n;++v)s.push("if(typeof i"+v+"==='number'&&i"+v+">=0){\td=i"+v+"|0;\tb+=c"+v+"*d;\ta"+v+"-=d}");s.push("return new "+r+"(this.data,"+u.map((function(t){return"a"+t})).join(",")+","+u.map((function(t){return"c"+t})).join(",")+",b)}"),s.push("proto.step=function "+r+"_step("+l.join(",")+"){var "+u.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+u.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(v=0;v<n;++v)s.push("if(typeof i"+v+"==='number'){\td=i"+v+"|0;\tif(d<0){\tc+=b"+v+"*(a"+v+"-1);\ta"+v+"=ceil(-a"+v+"/d)\t}else{\ta"+v+"=ceil(a"+v+"/d)\t}\tb"+v+"*=d\t}");s.push("return new "+r+"(this.data,"+u.map((function(t){return"a"+t})).join(",")+","+u.map((function(t){return"b"+t})).join(",")+",c)}");var m=new Array(n),b=new Array(n);for(v=0;v<n;++v)m[v]="a[i"+v+"]",b[v]="b[i"+v+"]";s.push("proto.transpose=function "+r+"_transpose("+l+"){"+l.map((function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+m.join(",")+","+b.join(",")+",this.offset)}"),s.push("proto.pick=function "+r+"_pick("+l+"){var a=[],b=[],c=this.offset");for(v=0;v<n;++v)s.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+u.map((function(t){return"shape["+t+"]"})).join(",")+","+u.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\n"))(o[e],i)}var o={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};return pn=function(t,r,i,s){if(void 0===t)return(0,o.array[0])([]);"number"==typeof t&&(t=[t]),void 0===r&&(r=[t.length]);var u=r.length;if(void 0===i){i=new Array(u);for(var l=u-1,c=1;l>=0;--l)i[l]=c,c*=r[l]}if(void 0===s){s=0;for(l=0;l<u;++l)i[l]<0&&(s-=(r[l]-1)*i[l])}for(var f=function(t){if(e(t))return"buffer";if(n)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),p=o[f];p.length<=u+1;)p.push(a(f,p.length-1));return(0,p[u+1])(t,r,i,s)}}var bn,gn,yn,wn,_n,xn,kn=r(mn());function Cn(){if(wn)return yn;wn=1;var t=function(){if(gn)return bn;gn=1;var t=function(){function e(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function n(t,e){for(var n=[];e>0;n[--e]=t);return n.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.object_stringify=function(t,e,n,i){var a="";if(null!=t)switch(typeof t){case"function":return"[Function"+(t.name?": "+t.name:"")+"]";case"object":if(t instanceof Error)return"["+t.toString()+"]";if(e>=n)return"[Object]";if(i&&(i=i.slice(0)).push(t),null!=t.length){a+="[";var o=[];for(var s in t)i&&i.indexOf(t[s])>=0?o.push("[Circular]"):o.push(r.object_stringify(t[s],e+1,n,i));a+=o.join(", ")+"]"}else{if("getMonth"in t)return"Date("+t+")";for(var u in a+="{",o=[],t)t.hasOwnProperty(u)&&(i&&i.indexOf(t[u])>=0?o.push(u+": [Circular]"):o.push(u+": "+r.object_stringify(t[u],e+1,n,i)));a+=o.join(", ")+"}"}return a;case"string":return'"'+t+'"'}return""+t},r.format=function(i,a){var o,s,u,l,c,f,p,h=1,d=i.length,v="",m=[];for(s=0;s<d;s++)if("string"===(v=e(i[s])))m.push(i[s]);else if("array"===v){if((l=i[s])[2])for(o=a[h],u=0;u<l[2].length;u++){if(!o.hasOwnProperty(l[2][u]))throw new Error(t('[sprintf] property "%s" does not exist',l[2][u]));o=o[l[2][u]]}else o=l[1]?a[l[1]]:a[h++];if(/[^sO]/.test(l[8])&&"number"!=e(o))throw new Error(t('[sprintf] expecting number but found %s "'+o+'"',e(o)));switch(l[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=l[7]?o.toExponential(l[7]):o.toExponential();break;case"f":o=l[7]?parseFloat(o).toFixed(l[7]):parseFloat(o);break;case"O":o=r.object_stringify(o,0,parseInt(l[7])||5);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&l[7]?o.substring(0,l[7]):o;break;case"u":o=Math.abs(o);break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(l[8])&&l[3]&&o>=0?"+"+o:o,f=l[4]?"0"==l[4]?"0":l[4].charAt(1):" ",p=l[6]-String(o).length,c=l[6]?n(f,p):"",m.push(l[5]?o+c:c+o)}return m.join("")},r.cache={},r.parse=function(t){for(var e=t,n=[],r=[],i=0;e;){if(null!==(n=/^[^\x25]+/.exec(e)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(e)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosOuxX])/.exec(e)))throw new Error("[sprintf] "+e);if(n[2]){i|=1;var a=[],o=n[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(o)))throw new Error("[sprintf] "+o);for(a.push(s[1]);""!==(o=o.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(o)))a.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(o)))throw new Error("[sprintf] "+o);a.push(s[1])}n[2]=a}else i|=2;if(3===i)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}e=e.substring(n[0].length)}return r},r}();return bn=t,t.sprintf=t,t.vsprintf=function(e,n){var r=n.slice();return r.unshift(e),t.apply(null,r)},bn}();function e(e,i){var a,o=Math.max(1,r(Math.abs(e))),s=r(Math.abs(o)),u=Math.pow(10,i+1);if(Math.abs(e)<1)e=Math.round(e*u)/u;else{var l=Math.pow(10,o+1);e=Math.round(e/l*u)/u*l}if(i-s-6==-1)e=Math.round(e/Math.pow(10,o)),e*=Math.pow(10,o),a=t("%1e",e).replace(/\.[^e]+/,"");else{if(i-s-6<0)return;a=t("%."+(i-s-6)+"e",e)}return e>0&&(a=" "+a),n(a,i)}function n(t,e){return Array(Math.max(0,e-t.length+1)).join(" ")+t}function r(t){return Math.floor(Math.log(t)/Math.log(10))}return yn=function(i,a){void 0===a&&(a=8);var o="%"+a+"."+a+"s";if(a<=0)return;if(isNaN(i))return t(o,"NaN");if(i===1/0){if(1===a)return;return t(o,a>=9?"Infinity":" Inf").slice(0,a)}if(i===-1/0){if(1===a)return;return t(o,a>=9?"-Infinity":"-Inf").slice(0,a)}return function(i,a){var o=Math.max(1,Math.floor((a-2)/2)),s=a-o-2;if(0===i&&a<4)return n("0",a);if(0===i)return n("0."+Array(s+1).join("0"),a);if(s<=0){var u=t("%"+o+"f",i);if(i>=0&&(u=" "+u),u.length>a)return;return n(u,a)}if(Math.abs(i)<Math.pow(10,1-s))return e(i,a);var l=Math.pow(10,a-3),c=Math.pow(10,r(Math.abs(i))),f=Math.round(i/c*l)/l*c;u=t("%"+o+"."+s+"f",f);f>0&&(u=" "+u);u=u.slice(0,a);var p=u.split(".")[1];return!p||p.length<1?e(f,a):n(u,a).slice(0,a)}(i,a)}}!function(){if(xn)return _n;xn=1;var t=Cn(),e=mn();function n(e,n){for(var r=[],i=0;i<e.shape[0];i++)r.push(t(e.get(i),n.width));return r.join(" ")}function r(t,e){for(var r=[],i=0;i<t.shape[0];i++)r.push(n(t.pick(i,null),e));return r.join("\n")}function i(t,e){for(var n=[],i=0;i<t.shape[0];i++)n.push(r(t.pick(i,null,null),e),"");return n.join("\n")}_n=function(t,a){return a||(a={}),"number"==typeof a&&(a={width:a}),a.width||(a.width=8),void 0===t.dimension&&(t=e(t)),1===t.dimension?n(t,a):2===t.dimension?r(t,a):3===t.dimension?i(t,a):4===t.dimension?function(t,e){for(var n=[],r=3,a=0;a<t.shape[0];a++){var o=i(t.pick(a,null,null,null),e);n.push(o);for(var s=o.split("\n"),u=0;u<s.length;u++)r=Math.max(r,s[u].length)}return n.join("\n"+Array(r+1).join("-")+"\n\n")}(t,a):void 0}}();var En,An,Pn,Sn,Vn,jn,On,Mn,Dn,Tn={},Bn={};function In(){if(An)return En;return An=1,En=function(t,e,n){return 0===t.length?t:e?(n||t.sort(e),function(t,e){for(var n=1,r=t.length,i=t[0],a=t[0],o=1;o<r;++o)if(a=i,e(i=t[o],a)){if(o===n){n++;continue}t[n++]=i}return t.length=n,t}(t,e)):(n||t.sort(),function(t){for(var e=1,n=t.length,r=t[0],i=t[0],a=1;a<n;++a,i=r)if(i=r,(r=t[a])!==i){if(a===e){e++;continue}t[e++]=r}return t.length=e,t}(t))},En}function Rn(){if(Sn)return Pn;Sn=1;var t=In();function e(t,e,n){var r,i,a=t.length,o=e.arrayArgs.length,s=e.indexArgs.length>0,u=[],l=[],c=0,f=0;for(r=0;r<a;++r)l.push(["i",r,"=0"].join(""));for(i=0;i<o;++i)for(r=0;r<a;++r)f=c,c=t[r],0===r?l.push(["d",i,"s",r,"=t",i,"p",c].join("")):l.push(["d",i,"s",r,"=(t",i,"p",c,"-s",f,"*t",i,"p",f,")"].join(""));for(l.length>0&&u.push("var "+l.join(",")),r=a-1;r>=0;--r)c=t[r],u.push(["for(i",r,"=0;i",r,"<s",c,";++i",r,"){"].join(""));for(u.push(n),r=0;r<a;++r){for(f=c,c=t[r],i=0;i<o;++i)u.push(["p",i,"+=d",i,"s",r].join(""));s&&(r>0&&u.push(["index[",f,"]-=s",f].join("")),u.push(["++index[",c,"]"].join(""))),u.push("}")}return u.join("\n")}function n(t,e,n){for(var r=t.body,i=[],a=[],o=0;o<t.args.length;++o){var s=t.args[o];if(!(s.count<=0)){var u=new RegExp(s.name,"g"),l="",c=e.arrayArgs.indexOf(o);switch(e.argTypes[o]){case"offset":var f=e.offsetArgIndex.indexOf(o);c=e.offsetArgs[f].array,l="+q"+f;case"array":l="p"+c+l;var p="l"+o,h="a"+c;if(0===e.arrayBlockIndices[c])1===s.count?"generic"===n[c]?s.lvalue?(i.push(["var ",p,"=",h,".get(",l,")"].join("")),r=r.replace(u,p),a.push([h,".set(",l,",",p,")"].join(""))):r=r.replace(u,[h,".get(",l,")"].join("")):r=r.replace(u,[h,"[",l,"]"].join("")):"generic"===n[c]?(i.push(["var ",p,"=",h,".get(",l,")"].join("")),r=r.replace(u,p),s.lvalue&&a.push([h,".set(",l,",",p,")"].join(""))):(i.push(["var ",p,"=",h,"[",l,"]"].join("")),r=r.replace(u,p),s.lvalue&&a.push([h,"[",l,"]=",p].join("")));else{for(var d=[s.name],v=[l],m=0;m<Math.abs(e.arrayBlockIndices[c]);m++)d.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(m+1)+"*t"+c+"b"+m);if(u=new RegExp(d.join(""),"g"),l=v.join("+"),"generic"===n[c])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(u,[h,"[",l,"]"].join(""))}break;case"scalar":r=r.replace(u,"Y"+e.scalarArgs.indexOf(o));break;case"index":r=r.replace(u,"index");break;case"shape":r=r.replace(u,"shape")}}}return[i.join("\n"),r,a.join("\n")].join("\n").trim()}function r(t){for(var e=new Array(t.length),n=!0,r=0;r<t.length;++r){var i=t[r],a=i.match(/\d+/);a=a?a[0]:"",0===i.charAt(0)?e[r]="u"+i.charAt(1)+a:e[r]=i.charAt(0)+a,r>0&&(n=n&&e[r]===e[r-1])}return n?e[0]:e.join("")}return Pn=function(i,a){for(var o=a[1].length-Math.abs(i.arrayBlockIndices[0])|0,s=new Array(i.arrayArgs.length),u=new Array(i.arrayArgs.length),l=0;l<i.arrayArgs.length;++l)u[l]=a[2*l],s[l]=a[2*l+1];var c=[],f=[],p=[],h=[],d=[];for(l=0;l<i.arrayArgs.length;++l){i.arrayBlockIndices[l]<0?(p.push(0),h.push(o),c.push(o),f.push(o+i.arrayBlockIndices[l])):(p.push(i.arrayBlockIndices[l]),h.push(i.arrayBlockIndices[l]+o),c.push(0),f.push(i.arrayBlockIndices[l]));for(var v=[],m=0;m<s[l].length;m++)p[l]<=s[l][m]&&s[l][m]<h[l]&&v.push(s[l][m]-p[l]);d.push(v)}var b=["SS"],g=["'use strict'"],y=[];for(m=0;m<o;++m)y.push(["s",m,"=SS[",m,"]"].join(""));for(l=0;l<i.arrayArgs.length;++l){b.push("a"+l),b.push("t"+l),b.push("p"+l);for(m=0;m<o;++m)y.push(["t",l,"p",m,"=t",l,"[",p[l]+m,"]"].join(""));for(m=0;m<Math.abs(i.arrayBlockIndices[l]);++m)y.push(["t",l,"b",m,"=t",l,"[",c[l]+m,"]"].join(""))}for(l=0;l<i.scalarArgs.length;++l)b.push("Y"+l);if(i.shapeArgs.length>0&&y.push("shape=SS.slice(0)"),i.indexArgs.length>0){var w=new Array(o);for(l=0;l<o;++l)w[l]="0";y.push(["index=[",w.join(","),"]"].join(""))}for(l=0;l<i.offsetArgs.length;++l){var _=i.offsetArgs[l],x=[];for(m=0;m<_.offset.length;++m)0!==_.offset[m]&&(1===_.offset[m]?x.push(["t",_.array,"p",m].join("")):x.push([_.offset[m],"*t",_.array,"p",m].join("")));0===x.length?y.push("q"+l+"=0"):y.push(["q",l,"=",x.join("+")].join(""))}var k=t([].concat(i.pre.thisVars).concat(i.body.thisVars).concat(i.post.thisVars));for((y=y.concat(k)).length>0&&g.push("var "+y.join(",")),l=0;l<i.arrayArgs.length;++l)g.push("p"+l+"|=0");i.pre.body.length>3&&g.push(n(i.pre,i,u));var C=n(i.body,i,u),E=function(t){for(var e=0,n=t[0].length;e<n;){for(var r=1;r<t.length;++r)if(t[r][e]!==t[0][e])return e;++e}return e}(d);E<o?g.push(function(t,n,r,i){for(var a=n.length,o=r.arrayArgs.length,s=r.blockSize,u=r.indexArgs.length>0,l=[],c=0;c<o;++c)l.push(["var offset",c,"=p",c].join(""));for(c=t;c<a;++c)l.push(["for(var j"+c+"=SS[",n[c],"]|0;j",c,">0;){"].join("")),l.push(["if(j",c,"<",s,"){"].join("")),l.push(["s",n[c],"=j",c].join("")),l.push(["j",c,"=0"].join("")),l.push(["}else{s",n[c],"=",s].join("")),l.push(["j",c,"-=",s,"}"].join("")),u&&l.push(["index[",n[c],"]=j",c].join(""));for(c=0;c<o;++c){for(var f=["offset"+c],p=t;p<a;++p)f.push(["j",p,"*t",c,"p",n[p]].join(""));l.push(["p",c,"=(",f.join("+"),")"].join(""))}for(l.push(e(n,r,i)),c=t;c<a;++c)l.push("}");return l.join("\n")}(E,d[0],i,C)):g.push(e(d[0],i,C)),i.post.body.length>3&&g.push(n(i.post,i,u)),i.debug&&console.log("-----Generated cwise routine for ",a,":\n"+g.join("\n")+"\n----------");var A=[i.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",E,r(u)].join("");return new Function(["function ",A,"(",b.join(","),"){",g.join("\n"),"} return ",A].join(""))()}}function Ln(){if(Mn)return On;Mn=1;var t=function(){if(jn)return Vn;jn=1;var t=Rn();return Vn=function(e){var n=["'use strict'","var CACHED={}"],r=[],i=e.funcName+"_cwise_thunk";n.push(["return function ",i,"(",e.shimArgs.join(","),"){"].join(""));for(var a=[],o=[],s=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],u=[],l=[],c=0;c<e.arrayArgs.length;++c){var f=e.arrayArgs[c];r.push(["t",f,"=array",f,".dtype,","r",f,"=array",f,".order"].join("")),a.push("t"+f),a.push("r"+f),o.push("t"+f),o.push("r"+f+".join()"),s.push("array"+f+".data"),s.push("array"+f+".stride"),s.push("array"+f+".offset|0"),c>0&&(u.push("array"+e.arrayArgs[0]+".shape.length===array"+f+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),l.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+f+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}for(e.arrayArgs.length>1&&(n.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),n.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),n.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),n.push("}")),c=0;c<e.scalarArgs.length;++c)s.push("scalar"+e.scalarArgs[c]);return r.push(["type=[",o.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),n.push("var "+r.join(",")),n.push(["if(!proc){","CACHED[type]=proc=compile([",a.join(","),"])}","return proc(",s.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+n.join("\n")+"\n----------"),new Function("compile",n.join("\n"))(t.bind(void 0,e))}}();function e(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}return On=function(n){var r=new e;r.pre=n.pre,r.body=n.body,r.post=n.post;var i=n.args.slice(0);r.argTypes=i;for(var a=0;a<i.length;++a){var o=i[a];if("array"===o||"object"==typeof o&&o.blockIndices){if(r.argTypes[a]="array",r.arrayArgs.push(a),r.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),r.shimArgs.push("array"+a),a<r.pre.args.length&&r.pre.args[a].count>0)throw new Error("cwise: pre() block may not reference array args");if(a<r.post.args.length&&r.post.args[a].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===o)r.scalarArgs.push(a),r.shimArgs.push("scalar"+a);else if("index"===o){if(r.indexArgs.push(a),a<r.pre.args.length&&r.pre.args[a].count>0)throw new Error("cwise: pre() block may not reference array index");if(a<r.body.args.length&&r.body.args[a].lvalue)throw new Error("cwise: body() block may not write to array index");if(a<r.post.args.length&&r.post.args[a].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===o){if(r.shapeArgs.push(a),a<r.pre.args.length&&r.pre.args[a].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(a<r.body.args.length&&r.body.args[a].lvalue)throw new Error("cwise: body() block may not write to array shape");if(a<r.post.args.length&&r.post.args[a].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof o||!o.offset)throw new Error("cwise: Unknown argument type "+i[a]);r.argTypes[a]="offset",r.offsetArgs.push({array:o.array,offset:o.offset}),r.offsetArgIndex.push(a)}}if(r.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(r.pre.args.length>i.length)throw new Error("cwise: Too many arguments in pre() block");if(r.body.args.length>i.length)throw new Error("cwise: Too many arguments in body() block");if(r.post.args.length>i.length)throw new Error("cwise: Too many arguments in post() block");return r.debug=!!n.printCode||!!n.debug,r.funcName=n.funcName||"cwise",r.blockSize=n.blockSize||64,t(r)}}function zn(){return Dn||(Dn=1,function(t){var e=Ln(),n={body:"",args:[],thisVars:[],localVars:[]};function r(t){if(!t)return n;for(var e=0;e<t.args.length;++e){var r=t.args[e];t.args[e]=0===e?{name:r,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function i(t){for(var n=[],i=0;i<t.args.length;++i)n.push("a"+i);return new Function("P",["return function ",t.funcName,"_ndarrayops(",n.join(","),") {P(",n.join(","),");return a0}"].join(""))(function(t){return e({args:t.args,pre:r(t.pre),body:r(t.body),post:r(t.proc),funcName:t.funcName})}(t))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in a){var n=a[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+n+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+n+"=s"},rvalue:!0,funcName:e+"seq"})}}();var o={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in o){var n=o[e];t[e]=i({args:["array","array"],body:{args:["a","b"],body:"a="+n+"b"},funcName:e}),t[e+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+n+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var s={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in s){var n=s[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+n+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+n+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<u.length;++e){var n=u[e];t[n]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:n}),t[n+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"})}}();var l=["max","min","atan2","pow"];!function(){for(var e=0;e<l.length;++e){var n=l[e];t[n]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n}),t[n+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n+"s"}),t[n+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"}),t[n+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"seq"})}}();var c=["atan2","pow"];!function(){for(var e=0;e<c.length;++e){var n=c[e];t[n+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"op"}),t[n+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"ops"}),t[n+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opeq"}),t[n+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opseq"})}}(),t.any=e({args:["array"],pre:n,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=e({args:["array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=e({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=e({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=e({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=e({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=e({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}(Bn)),Bn}var Nn,Un,Fn,qn={},Kn={};function Gn(){if(Fn)return Un;function t(e,n,r){var i=0|e[r];if(i<=0)return[];var a,o=new Array(i);if(r===e.length-1)for(a=0;a<i;++a)o[a]=n;else for(a=0;a<i;++a)o[a]=t(e,n,r+1);return o}return Fn=1,Un=function(e,n){switch(void 0===n&&(n=0),typeof e){case"number":if(e>0)return function(t,e){var n,r;for(n=new Array(t),r=0;r<t;++r)n[r]=e;return n}(0|e,n);break;case"object":if("number"==typeof e.length)return t(e,n,0)}return[]}}var $n="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Hn=[],Yn=[],Wn="undefined"!=typeof Uint8Array?Uint8Array:Array,Xn=!1;function Qn(){Xn=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0;e<64;++e)Hn[e]=t[e],Yn[t.charCodeAt(e)]=e;Yn["-".charCodeAt(0)]=62,Yn["_".charCodeAt(0)]=63}function Zn(t,e,n){for(var r,i,a=[],o=e;o<n;o+=3)r=(t[o]<<16)+(t[o+1]<<8)+t[o+2],a.push(Hn[(i=r)>>18&63]+Hn[i>>12&63]+Hn[i>>6&63]+Hn[63&i]);return a.join("")}function Jn(t){var e;Xn||Qn();for(var n=t.length,r=n%3,i="",a=[],o=16383,s=0,u=n-r;s<u;s+=o)a.push(Zn(t,s,s+o>u?u:s+o));return 1===r?(e=t[n-1],i+=Hn[e>>2],i+=Hn[e<<4&63],i+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],i+=Hn[e>>10],i+=Hn[e>>4&63],i+=Hn[e<<2&63],i+="="),a.push(i),a.join("")}function tr(t,e,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,f=n?i-1:0,p=n?-1:1,h=t[e+f];for(f+=p,a=h&(1<<-c)-1,h>>=-c,c+=s;c>0;a=256*a+t[e+f],f+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+t[e+f],f+=p,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),a-=l}return(h?-1:1)*o*Math.pow(2,a-r)}function er(t,e,n,r,i,a){var o,s,u,l=8*a-i-1,c=(1<<l)-1,f=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:a-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+f>=1?p/u:p*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=c?(s=0,o=c):o+f>=1?(s=(e*u-1)*Math.pow(2,i),o+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=255&s,h+=d,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;t[n+h]=255&o,h+=d,o/=256,l-=8);t[n+h-d]|=128*v}var nr={}.toString,rr=Array.isArray||function(t){return"[object Array]"==nr.call(t)};sr.TYPED_ARRAY_SUPPORT=void 0===$n.TYPED_ARRAY_SUPPORT||$n.TYPED_ARRAY_SUPPORT;var ir=ar();function ar(){return sr.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function or(t,e){if(ar()<e)throw new RangeError("Invalid typed array length");return sr.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=sr.prototype:(null===t&&(t=new sr(e)),t.length=e),t}function sr(t,e,n){if(!(sr.TYPED_ARRAY_SUPPORT||this instanceof sr))return new sr(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return cr(this,t)}return ur(this,t,e,n)}function ur(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);sr.TYPED_ARRAY_SUPPORT?(t=e).__proto__=sr.prototype:t=fr(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!sr.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|dr(e,n);t=or(t,r);var i=t.write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(hr(e)){var n=0|pr(e.length);return 0===(t=or(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?or(t,0):fr(t,e);if("Buffer"===e.type&&rr(e.data))return fr(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function lr(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function cr(t,e){if(lr(e),t=or(t,e<0?0:0|pr(e)),!sr.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function fr(t,e){var n=e.length<0?0:0|pr(e.length);t=or(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function pr(t){if(t>=ar())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ar().toString(16)+" bytes");return 0|t}function hr(t){return!(null==t||!t._isBuffer)}function dr(t,e){if(hr(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Ur(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Fr(t).length;default:if(r)return Ur(t).length;e=(""+e).toLowerCase(),r=!0}}function vr(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return jr(this,e,n);case"utf8":case"utf-8":return Ar(this,e,n);case"ascii":return Sr(this,e,n);case"latin1":case"binary":return Vr(this,e,n);case"base64":return Er(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Or(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function mr(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function br(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=sr.from(e,r)),hr(e))return 0===e.length?-1:gr(t,e,n,r,i);if("number"==typeof e)return e&=255,sr.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):gr(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function gr(t,e,n,r,i){var a,o=1,s=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,s/=2,u/=2,n/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var c=-1;for(a=n;a<s;a++)if(l(t,a)===l(e,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===u)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var f=!0,p=0;p<u;p++)if(l(t,a+p)!==l(e,p)){f=!1;break}if(f)return a}return-1}function yr(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[n+o]=s}return o}function wr(t,e,n,r){return qr(Ur(e,t.length-n),t,n,r)}function _r(t,e,n,r){return qr(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function xr(t,e,n,r){return _r(t,e,n,r)}function kr(t,e,n,r){return qr(Fr(e),t,n,r)}function Cr(t,e,n,r){return qr(function(t,e){for(var n,r,i,a=[],o=0;o<t.length&&!((e-=2)<0);++o)r=(n=t.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(e,t.length-n),t,n,r)}function Er(t,e,n){return 0===e&&n===t.length?Jn(t):Jn(t.slice(e,n))}function Ar(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var a,o,s,u,l=t[i],c=null,f=l>239?4:l>223?3:l>191?2:1;if(i+f<=n)switch(f){case 1:l<128&&(c=l);break;case 2:128==(192&(a=t[i+1]))&&(u=(31&l)<<6|63&a)>127&&(c=u);break;case 3:a=t[i+1],o=t[i+2],128==(192&a)&&128==(192&o)&&(u=(15&l)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:a=t[i+1],o=t[i+2],s=t[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,f=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=f}return function(t){var e=t.length;if(e<=Pr)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=Pr));return n}(r)}sr.poolSize=8192,sr._augment=function(t){return t.__proto__=sr.prototype,t},sr.from=function(t,e,n){return ur(null,t,e,n)},sr.TYPED_ARRAY_SUPPORT&&(sr.prototype.__proto__=Uint8Array.prototype,sr.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&sr[Symbol.species]),sr.alloc=function(t,e,n){return function(t,e,n,r){return lr(e),e<=0?or(t,e):void 0!==n?"string"==typeof r?or(t,e).fill(n,r):or(t,e).fill(n):or(t,e)}(null,t,e,n)},sr.allocUnsafe=function(t){return cr(null,t)},sr.allocUnsafeSlow=function(t){return cr(null,t)},sr.isBuffer=Kr,sr.compare=function(t,e){if(!hr(t)||!hr(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,a=Math.min(n,r);i<a;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},sr.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},sr.concat=function(t,e){if(!rr(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return sr.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=sr.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var a=t[n];if(!hr(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},sr.byteLength=dr,sr.prototype._isBuffer=!0,sr.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)mr(this,e,e+1);return this},sr.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)mr(this,e,e+3),mr(this,e+1,e+2);return this},sr.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)mr(this,e,e+7),mr(this,e+1,e+6),mr(this,e+2,e+5),mr(this,e+3,e+4);return this},sr.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Ar(this,0,t):vr.apply(this,arguments)},sr.prototype.equals=function(t){if(!hr(t))throw new TypeError("Argument must be a Buffer");return this===t||0===sr.compare(this,t)},sr.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},sr.prototype.compare=function(t,e,n,r,i){if(!hr(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(e>>>=0),s=Math.min(a,o),u=this.slice(r,i),l=t.slice(e,n),c=0;c<s;++c)if(u[c]!==l[c]){a=u[c],o=l[c];break}return a<o?-1:o<a?1:0},sr.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},sr.prototype.indexOf=function(t,e,n){return br(this,t,e,n,!0)},sr.prototype.lastIndexOf=function(t,e,n){return br(this,t,e,n,!1)},sr.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return yr(this,t,e,n);case"utf8":case"utf-8":return wr(this,t,e,n);case"ascii":return _r(this,t,e,n);case"latin1":case"binary":return xr(this,t,e,n);case"base64":return kr(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Cr(this,t,e,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},sr.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Pr=4096;function Sr(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function Vr(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function jr(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=e;a<n;++a)i+=Nr(t[a]);return i}function Or(t,e,n){for(var r=t.slice(e,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function Mr(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function Dr(t,e,n,r,i,a){if(!hr(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<a)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function Tr(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,a=Math.min(t.length-n,2);i<a;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function Br(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,a=Math.min(t.length-n,4);i<a;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function Ir(t,e,n,r,i,a){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Rr(t,e,n,r,i){return i||Ir(t,0,n,4),er(t,e,n,r,23,4),n+4}function Lr(t,e,n,r,i){return i||Ir(t,0,n,8),er(t,e,n,r,52,8),n+8}sr.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),sr.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=sr.prototype;else{var i=e-t;n=new sr(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+t]}return n},sr.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||Mr(t,e,this.length);for(var r=this[t],i=1,a=0;++a<e&&(i*=256);)r+=this[t+a]*i;return r},sr.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||Mr(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},sr.prototype.readUInt8=function(t,e){return e||Mr(t,1,this.length),this[t]},sr.prototype.readUInt16LE=function(t,e){return e||Mr(t,2,this.length),this[t]|this[t+1]<<8},sr.prototype.readUInt16BE=function(t,e){return e||Mr(t,2,this.length),this[t]<<8|this[t+1]},sr.prototype.readUInt32LE=function(t,e){return e||Mr(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},sr.prototype.readUInt32BE=function(t,e){return e||Mr(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},sr.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||Mr(t,e,this.length);for(var r=this[t],i=1,a=0;++a<e&&(i*=256);)r+=this[t+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},sr.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||Mr(t,e,this.length);for(var r=e,i=1,a=this[t+--r];r>0&&(i*=256);)a+=this[t+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*e)),a},sr.prototype.readInt8=function(t,e){return e||Mr(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},sr.prototype.readInt16LE=function(t,e){e||Mr(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},sr.prototype.readInt16BE=function(t,e){e||Mr(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},sr.prototype.readInt32LE=function(t,e){return e||Mr(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},sr.prototype.readInt32BE=function(t,e){return e||Mr(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},sr.prototype.readFloatLE=function(t,e){return e||Mr(t,4,this.length),tr(this,t,!0,23,4)},sr.prototype.readFloatBE=function(t,e){return e||Mr(t,4,this.length),tr(this,t,!1,23,4)},sr.prototype.readDoubleLE=function(t,e){return e||Mr(t,8,this.length),tr(this,t,!0,52,8)},sr.prototype.readDoubleBE=function(t,e){return e||Mr(t,8,this.length),tr(this,t,!1,52,8)},sr.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||Dr(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[e]=255&t;++a<n&&(i*=256);)this[e+a]=t/i&255;return e+n},sr.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||Dr(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+n},sr.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,1,255,0),sr.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},sr.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,2,65535,0),sr.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Tr(this,t,e,!0),e+2},sr.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,2,65535,0),sr.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Tr(this,t,e,!1),e+2},sr.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,4,4294967295,0),sr.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Br(this,t,e,!0),e+4},sr.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,4,4294967295,0),sr.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Br(this,t,e,!1),e+4},sr.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);Dr(this,t,e,n,i-1,-i)}var a=0,o=1,s=0;for(this[e]=255&t;++a<n&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o|0)-s&255;return e+n},sr.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);Dr(this,t,e,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o|0)-s&255;return e+n},sr.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,1,127,-128),sr.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},sr.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,2,32767,-32768),sr.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Tr(this,t,e,!0),e+2},sr.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,2,32767,-32768),sr.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Tr(this,t,e,!1),e+2},sr.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,4,2147483647,-2147483648),sr.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Br(this,t,e,!0),e+4},sr.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||Dr(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),sr.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Br(this,t,e,!1),e+4},sr.prototype.writeFloatLE=function(t,e,n){return Rr(this,t,e,!0,n)},sr.prototype.writeFloatBE=function(t,e,n){return Rr(this,t,e,!1,n)},sr.prototype.writeDoubleLE=function(t,e,n){return Lr(this,t,e,!0,n)},sr.prototype.writeDoubleBE=function(t,e,n){return Lr(this,t,e,!1,n)},sr.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,a=r-n;if(this===t&&n<e&&e<r)for(i=a-1;i>=0;--i)t[i+e]=this[i+n];else if(a<1e3||!sr.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+a),e);return a},sr.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!sr.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var a;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(a=e;a<n;++a)this[a]=t;else{var o=hr(t)?t:Ur(new sr(t,r).toString()),s=o.length;for(a=0;a<n-e;++a)this[a+e]=o[a%s]}return this};var zr=/[^+\/0-9A-Za-z-_]/g;function Nr(t){return t<16?"0"+t.toString(16):t.toString(16)}function Ur(t,e){var n;e=e||1/0;for(var r=t.length,i=null,a=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;a.push(n)}else if(n<2048){if((e-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function Fr(t){return function(t){var e,n,r,i,a,o;Xn||Qn();var s=t.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a="="===t[s-2]?2:"="===t[s-1]?1:0,o=new Wn(3*s/4-a),r=a>0?s-4:s;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)i=Yn[t.charCodeAt(e)]<<18|Yn[t.charCodeAt(e+1)]<<12|Yn[t.charCodeAt(e+2)]<<6|Yn[t.charCodeAt(e+3)],o[u++]=i>>16&255,o[u++]=i>>8&255,o[u++]=255&i;return 2===a?(i=Yn[t.charCodeAt(e)]<<2|Yn[t.charCodeAt(e+1)]>>4,o[u++]=255&i):1===a&&(i=Yn[t.charCodeAt(e)]<<10|Yn[t.charCodeAt(e+1)]<<4|Yn[t.charCodeAt(e+2)]>>2,o[u++]=i>>8&255,o[u++]=255&i),o}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(zr,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function qr(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function Kr(t){return null!=t&&(!!t._isBuffer||Gr(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Gr(t.slice(0,0))}(t))}function Gr(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var $r,Hr,Yr,Wr,Xr,Qr,Zr,Jr,ti=i(Object.freeze({__proto__:null,Buffer:sr,INSPECT_MAX_BYTES:50,SlowBuffer:function(t){return+t!=t&&(t=0),sr.alloc(+t)},isBuffer:Kr,kMaxLength:ir}));function ei(){if($r)return qn;$r=1;var t=function(){if(Nn)return Kn;function t(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}Nn=1,Kn.INT_BITS=32,Kn.INT_MAX=2147483647,Kn.INT_MIN=-1<<31,Kn.sign=function(t){return(t>0)-(t<0)},Kn.abs=function(t){var e=t>>31;return(t^e)-e},Kn.min=function(t,e){return e^(t^e)&-(t<e)},Kn.max=function(t,e){return t^(t^e)&-(t<e)},Kn.isPow2=function(t){return!(t&t-1||!t)},Kn.log2=function(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1},Kn.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},Kn.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},Kn.countTrailingZeros=t,Kn.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)},Kn.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},Kn.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var e=new Array(256);return function(t){for(var e=0;e<256;++e){var n=e,r=e,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;t[e]=r<<i&255}}(e),Kn.reverse=function(t){return e[255&t]<<24|e[t>>>8&255]<<16|e[t>>>16&255]<<8|e[t>>>24&255]},Kn.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},Kn.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},Kn.interleave3=function(t,e,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},Kn.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},Kn.nextCombination=function(e){var n=e|e-1;return n+1|(~n&-~n)-1>>>t(e)+1},Kn}(),e=Gn(),r=ti.Buffer;n.__TYPEDARRAY_POOL||(n.__TYPEDARRAY_POOL={UINT8:e([32,0]),UINT16:e([32,0]),UINT32:e([32,0]),BIGUINT64:e([32,0]),INT8:e([32,0]),INT16:e([32,0]),INT32:e([32,0]),BIGINT64:e([32,0]),FLOAT:e([32,0]),DOUBLE:e([32,0]),DATA:e([32,0]),UINT8C:e([32,0]),BUFFER:e([32,0])});var i="undefined"!=typeof Uint8ClampedArray,a="undefined"!=typeof BigUint64Array,o="undefined"!=typeof BigInt64Array,s=n.__TYPEDARRAY_POOL;s.UINT8C||(s.UINT8C=e([32,0])),s.BIGUINT64||(s.BIGUINT64=e([32,0])),s.BIGINT64||(s.BIGINT64=e([32,0])),s.BUFFER||(s.BUFFER=e([32,0]));var u=s.DATA,l=s.BUFFER;function c(e){if(e){var n=e.length||e.byteLength,r=t.log2(n);u[r].push(e)}}function f(e){e=t.nextPow2(e);var n=t.log2(e),r=u[n];return r.length>0?r.pop():new ArrayBuffer(e)}function p(t){return new Uint8Array(f(t),0,t)}function h(t){return new Uint16Array(f(2*t),0,t)}function d(t){return new Uint32Array(f(4*t),0,t)}function v(t){return new Int8Array(f(t),0,t)}function m(t){return new Int16Array(f(2*t),0,t)}function b(t){return new Int32Array(f(4*t),0,t)}function g(t){return new Float32Array(f(4*t),0,t)}function y(t){return new Float64Array(f(8*t),0,t)}function w(t){return i?new Uint8ClampedArray(f(t),0,t):p(t)}function _(t){return a?new BigUint64Array(f(8*t),0,t):null}function x(t){return o?new BigInt64Array(f(8*t),0,t):null}function k(t){return new DataView(f(t),0,t)}function C(e){e=t.nextPow2(e);var n=t.log2(e),i=l[n];return i.length>0?i.pop():new r(e)}return qn.free=function(e){if(r.isBuffer(e))l[t.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var n=e.length||e.byteLength,i=0|t.log2(n);u[i].push(e)}},qn.freeUint8=qn.freeUint16=qn.freeUint32=qn.freeBigUint64=qn.freeInt8=qn.freeInt16=qn.freeInt32=qn.freeBigInt64=qn.freeFloat32=qn.freeFloat=qn.freeFloat64=qn.freeDouble=qn.freeUint8Clamped=qn.freeDataView=function(t){c(t.buffer)},qn.freeArrayBuffer=c,qn.freeBuffer=function(e){l[t.log2(e.length)].push(e)},qn.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return f(t);switch(e){case"uint8":return p(t);case"uint16":return h(t);case"uint32":return d(t);case"int8":return v(t);case"int16":return m(t);case"int32":return b(t);case"float":case"float32":return g(t);case"double":case"float64":return y(t);case"uint8_clamped":return w(t);case"bigint64":return x(t);case"biguint64":return _(t);case"buffer":return C(t);case"data":case"dataview":return k(t);default:return null}return null},qn.mallocArrayBuffer=f,qn.mallocUint8=p,qn.mallocUint16=h,qn.mallocUint32=d,qn.mallocInt8=v,qn.mallocInt16=m,qn.mallocInt32=b,qn.mallocFloat32=qn.mallocFloat=g,qn.mallocFloat64=qn.mallocDouble=y,qn.mallocUint8Clamped=w,qn.mallocBigUint64=_,qn.mallocBigInt64=x,qn.mallocDataView=k,qn.mallocBuffer=C,qn.clearCache=function(){for(var t=0;t<32;++t)s.UINT8[t].length=0,s.UINT16[t].length=0,s.UINT32[t].length=0,s.INT8[t].length=0,s.INT16[t].length=0,s.INT32[t].length=0,s.FLOAT[t].length=0,s.DOUBLE[t].length=0,s.BIGUINT64[t].length=0,s.BIGINT64[t].length=0,s.UINT8C[t].length=0,u[t].length=0,l[t].length=0},qn}function ni(){if(Hr)return Tn;Hr=1;var t=mn(),e=zn(),n=ei();return Tn.clone=function(r){var i=r.dtype;"generic"!==i&&"array"!==i||(i="double");var a=n.malloc(r.size,i),o=t(a,r.shape);return e.assign(o,r),o},Tn.malloc=function(e,r){r||(r="double");for(var i=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=i,i*=e[o];return t(n.malloc(i,r),e,a,0)},Tn.free=function(t){"generic"!==t.dtype&&"array"!==t.dtype&&n.free(t.data)},Tn.zeros=function(e,r){r||(r="double");for(var i=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=i,i*=e[o];var s=n.malloc(i,r);for(o=0;o<i;++o)s[o]=0;return t(s,e,a,0)},Tn.ones=function(e,r){r||(r="double");for(var i=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=i,i*=e[o];var s=n.malloc(i,r);for(o=0;o<i;++o)s[o]=1;return t(s,e,a,0)},Tn.eye=function(e,r){var i,a;r||(r="double");var o=1,s=new Array(e.length);for(i=e.length-1;i>=0;--i)s[i]=o,o*=e[i];var u=n.malloc(o,r);for(i=0;i<o;++i)u[i]=0;var l=1/0,c=0;for(i=e.length-1;i>=0;i--)c+=s[i],l=Math.min(l,e[i]);for(i=0,a=0;i<l;i++,a+=c)u[a]=1;return t(u,e,s,0)},Tn}!function(){if(Jr)return Zr;Jr=1;var t=function(){if(Wr)return Yr;Wr=1,mn();var t=ni();return Yr=function(e,n,r,i,a){var o=e.shape[0],s=e.shape[1],u=!1;1===n.dimension&&(a=i,i=r,r=n,n=e),i||(i=t.malloc([o])),a||(a=t.malloc([o]),u=!0);for(var l=0;l<s;l++){for(var c=0,f=0;f<l;f++)c+=e.get(f,l)*a.get(f);a.set(l,(r.get(l)-c)/e.get(l,l))}for(l=s-1;l>=0;l--){for(c=0,f=s-1;f>l;f--)c+=n.get(f,l)*i.get(f);i.set(l,a.get(l)-c)}return u&&t.free(a),i}}(),e=Qr?Xr:(Qr=1,Xr=function(t,e,n){var r=t.shape[0],i=t.shape[1];if(r!==i)return!1;e&&!n&&(n=e);for(var a=0;a<i;a++)n.set(a,a,1);for(var o=0;o<i;o++){for(a=o;a<i;a++){for(var s=0,u=0;u<o;u++)s+=e.get(u,a)*n.get(o,u);e.set(o,a,t.get(o,a)-s)}var l=e.get(o,o);if(0===l)return!1;for(a=o+1;a<i;a++){for(s=0,u=0;u<o;u++)s+=e.get(u,o)*n.get(a,u);n.set(a,o,(t.get(a,o)-s)/l)}}return!0});mn();var n=ni();Zr=function(r,i,a){if(2!==i.dimension)throw new Error("not a 2-dimensional matrix");var o=i.shape[0],s=i.shape[1];if(o!==s)throw new Error("not a square matrix: "+o+"x"+s);if(1!==a.dimension)throw new Error("B is not a vector");if(a.shape[0]!==o)throw new Error("B has an invalid length");if(1!==r.dimension)throw new Error("X is not a vector");if(r.shape[0]!==o)throw new Error("X has an invalid length");return function(r,i,a,o){var s=n.malloc([r,r]),u=e(a,s,s);if(!u)return n.free(s),!1;var l=n.malloc([r]),c=t(s,s,o,i,l);return n.free(l),n.free(s),!!c}(o,r,i,a)}}();var ri,ii,ai,oi,si,ui,li,ci,fi,pi,hi,di,vi,mi,bi,gi,yi,wi,_i,xi,ki,Ci,Ei,Ai,Pi,Si={};function Vi(){return ki||(ki=1,Si.swap=ii?ri:(ii=1,ri=function(t,e){var n,r,i=t.data,a=e.data,o=t.stride[0],s=e.stride[0],u=t.offset,l=e.offset;for(n=t.shape[0]-1;n>=0;n--,u+=o,l+=s)r=i[u],i[u]=a[l],a[l]=r}),Si.scal=oi?ai:(oi=1,ai=function(t,e){var n,r=e.data,i=e.stride[0],a=e.offset;for(n=e.shape[0]-1;n>=0;n--,a+=i)r[a]*=t}),Si.copy=ui?si:(ui=1,si=function(t,e){var n,r=t.data,i=e.data,a=t.stride[0],o=e.stride[0],s=t.offset,u=e.offset;for(n=t.shape[0]-1;n>=0;n--,s+=a,u+=o)i[u]=r[s]}),Si.axpy=ci?li:(ci=1,li=function(t,e,n){var r,i=e.data,a=n.data,o=e.stride[0],s=n.stride[0],u=e.offset,l=n.offset;for(r=e.shape[0]-1;r>=0;r--,u+=o,l+=s)a[l]+=t*i[u]}),Si.dot=pi?fi:(pi=1,fi=function(t,e){var n,r,i=t.data,a=t.stride[0],o=t.offset,s=0;if(t===e)for(n=t.shape[0]-1;n>=0;n--,o+=a)s+=(r=i[o])*r;else{var u=e.data,l=e.stride[0],c=e.offset;for(n=t.shape[0]-1;n>=0;n--,o+=a,c+=l)s+=u[c]*i[o]}return s}),Si.cpsc=di?hi:(di=1,hi=function(t,e,n){var r,i=e.data,a=n.data,o=e.stride[0],s=n.stride[0],u=e.offset,l=n.offset;for(r=e.shape[0]-1;r>=0;r--,u+=o,l+=s)a[l]=t*i[u]}),Si.nrm2=function(){if(mi)return vi;mi=1;var t=function(t,e){if(0===t&&0===e)return 0;var n=Math.abs(t),r=Math.abs(e),i=Math.min(n,r),a=Math.max(n,r);return i/=a,a*Math.sqrt(1+i*i)};return vi=function(e){var n,r,i=e.data,a=e.stride[0],o=e.offset,s=0;for(n=e.shape[0]-1;n>=0;n--,o+=a)r=i[o],s=t(s,r);return s}}(),Si.asum=gi?bi:(gi=1,bi=function(t){var e,n=t.data,r=t.stride[0],i=t.offset,a=0;for(e=t.shape[0]-1;e>=0;e--,i+=r)a+=Math.abs(n[i]);return a}),Si.iamax=wi?yi:(wi=1,yi=function(t){var e,n,r,i=-1/0,a=t.data,o=t.stride[0],s=t.offset,u=t.shape[0];for(e=0;e<u;e++,s+=o)(n=Math.abs(a[s]))>i&&(i=n,r=e);return r}),Si.rotg=xi?_i:(xi=1,Math.sign=Math.sign||function(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1},_i=function(t,e,n){var r=0,i=0,a=0,o=0,s=0;if(0===e?(r=Math.sign(t),i=0,a=Math.abs(t)):0===t?(r=0,i=Math.sign(e),a=Math.abs(e)):Math.abs(t)>Math.abs(e)?(i=(o=e/t)*(r=1/(s=Math.sign(t)*Math.sqrt(1+o*o))),a=t*s):(r=(o=t/e)*(i=1/(s=Math.sign(t)*Math.sqrt(1+o*o))),a=e*s),!(void 0!==n&&n.length>2))return[r,i,a];n[0]=r,n[1]=i,n[2]=a})),Si}var ji,Oi,Mi=function(){if(Pi)return Ai;Pi=1;var t=Vi(),e=zn(),n=function(){if(Ei)return Ci;Ei=1;var t=mn();return Ci=function(e){var n=e.dimension;if(n<=1)return e;for(var r=1<<30,i=0,a=e.shape,o=e.stride,s=0;s<n;++s)r=0|Math.min(r,a[s]),i+=o[s];return t(e.data,[r],[i],e.offset)}}();return Ai=function(r,i,a){var o,s,u,l,c,f,p,h=r.shape[1];if((h=r.shape[0])!==r.shape[1])throw new Error("LUP Decomposition::factorize():: Input matrix A must be square");var d=r!==i;for(d&&e.assigns(n(i),1),o=0;o<h;o++)a[o]=o;for(u=0;u<h;u++){if(o=t.iamax(r.pick(null,u).lo(u).hi(h-u))+u,c=r.pick(u,null),t.swap(c.lo(u).hi(h-u),r.pick(o,null).lo(u).hi(h-u)),u>0&&t.swap(i.pick(u,null).hi(u),i.pick(o,null).hi(u)),p=a[o],a[o]=a[u],a[u]=p,0===(f=r.get(u,u)))return!1;for(s=u+1;s<h;s++)l=r.get(s,u)/f,t.axpy(-l,c.lo(u+1).hi(h-u-1),r.pick(s,null).lo(u+1).hi(h-u-1)),i.set(s,u,l);d&&e.assigns(r.pick(null,u).lo(u+1).hi(h-u-1),0)}return!0}}(),Di=r(Mi);var Ti=function(){if(Oi)return ji;Oi=1;var t=Vi(),e=ni();return ji=function(n,r,i,a,o){var s,u,l=void 0===o,c=t.dot;if(2!==n.dimension||n.shape[0]!==n.shape[1])throw new Error("ndarray-lup-solve:: L must be a square, two-dimensional ndarray");var f=n.shape[0];if(2!==r.dimension||r.shape[0]!==r.shape[1])throw new Error("ndarray-lup-solve:: U must be a square, two-dimensional ndarray");if(r!==n&&r.shape[0]!==f)throw new Error("ndarray-lup-solve:: shape of L must be the same as U");if(i.length!==f)throw new Error("ndarray-lup-solve:: P must be an Array with length matching the dimensions of L and U");if(a.shape[0]!==f)throw new Error("ndarray-lup-solve:: x must be an ndarray with length matching the dimensions of L and U");if(o&&o.shape[0]!==f)throw new Error("ndarray-lup-solve:: if provided, work vector must be an ndarray with length matching the dimensions of L and U");for(l&&(o=e.malloc([f])),s=0;s<f;s++)o.set(s,a.get(i[s]));for(t.copy(o,a),s=1;s<f;s++)a.set(s,a.get(s)-c(n.pick(s,null).hi(s),a.hi(s)));for(a.set(f-1,a.get(f-1)/r.get(f-1,f-1)),s=f-2;s>=0;s--){if(0===(u=r.get(s,s)))return!1;a.set(s,(a.get(s)-c(r.pick(s,null).lo(s+1),a.lo(s+1)))/u)}return l&&e.free(o),!0},ji}(),Bi=r(Ti);function Ii({geometry:t,kuttaCondition:e=!0,vInf:n,alpha:r}={}){const{x:i,y:a}=t,o=[],s=[],u=[],l=i.length-1;for(let t=0;t<l;t++){s[t]=.5*(i[t]+i[t+1]),u[t]=.5*(a[t]+a[t+1]);const e=a[t+1]-a[t],n=i[t+1]-i[t];o[t]=Math.atan2(e,n)}const c=e?l+1:l,f=kn(new Array(c**2).fill(0),[c,c]),p=kn(new Array(c).fill(0),[c]),h=r*Math.PI/180,d=function(t,e){if(t.length!==e.length||t.length<3)throw new Error("Input arrays must have the same length and contain at least 3 points.");const n=t.length;let r=0;for(let i=0;i<n;i++){const a=(i+1)%n;r+=(t[a]-t[i])*(e[a]+e[i])}return Math.sign(r)}(i,a);for(let t=0;t<l;t++){const r=o[t];for(let n=0;n<l;n++){const c=Math.sqrt((s[t]-i[n])**2+(u[t]-a[n])**2),p=Math.sqrt((s[t]-i[n+1])**2+(u[t]-a[n+1])**2),h=o[n];let v=Math.PI*d;if(t!==n){const e=s[t]-i[n],r=s[t]-i[n+1],o=u[t]-a[n],l=u[t]-a[n+1],c=e*l-r*o,f=r*e+l*o;v=Math.atan2(c,f)}const m=Math.sin(r-h),b=Math.cos(r-h),g=Math.log(p/c),y=.5/Math.PI;f.set(t,n,y*(m*g+b*v)),e&&(f.set(t,l,f.get(t,l)+y*(b*g-m*v)),0!==t&&t!==l-1||(f.set(l,n,f.get(l,n)+y*(m*v-b*g)),f.set(l,l,f.get(l,l)+y*(m*g+b*v))))}p.set(t,n*Math.sin(r-h))}e&&p.set(l,-n*(Math.cos(o[0]-h)+Math.cos(o[l-1]-h)));const v=[];return Di(f,f,v),Bi(f,f,v,p),p}var Ri,Li={exports:{}};var zi,Ni,Ui=(Ri||(Ri=1,function(t,e){!function(t){function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function n(t,e,n){return e=l(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,f()?Reflect.construct(e,n||[],l(t).constructor):e.apply(t,n))}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,n){if(f())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,e),new(t.bind.apply(t,r))}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,m(r.key),r)}}function o(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,n){return(e=m(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},u.apply(null,arguments)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}function f(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(f=function(){return!!t})()}function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e,n,r){var i=u(l(t.prototype),e,n);return"function"==typeof i?function(t){return i.apply(n,t)}:i}function v(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function g(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0
/*! Tweakpane 4.0.5 (c) 2016 cocopon, licensed under the MIT license. */}}function y(t){return null==t}function w(t){return null!==t&&"object"===b(t)}function _(t){return null!==t&&"object"===b(t)}function x(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function k(t,e){return Array.from(new Set([].concat(v(Object.keys(t)),v(Object.keys(e))))).reduce((function(n,r){var i=t[r],a=e[r];return _(i)&&_(a)?Object.assign(Object.assign({},n),s({},r,k(i,a))):Object.assign(Object.assign({},n),s({},r,r in e?a:i))}),{})}function C(t){return!!w(t)&&"target"in t}var E={alreadydisposed:function(){return"View has been already disposed"},invalidparams:function(t){return"Invalid parameters for '".concat(t.name,"'")},nomatchingcontroller:function(t){return"No matching controller for '".concat(t.key,"'")},nomatchingview:function(t){return"No matching view for '".concat(JSON.stringify(t.params),"'")},notbindable:function(){return"Value is not bindable"},notcompatible:function(t){return"Not compatible with  plugin '".concat(t.id,"'")},propertynotfound:function(t){return"Property '".concat(t.name,"' not found")},shouldneverhappen:function(){return"This error should never happen"}},A=function(){function t(e){var n;r(this,t),this.message=null!==(n=E[e.type](e.context))&&void 0!==n?n:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}return o(t,[{key:"toString",value:function(){return this.message}}],[{key:"alreadyDisposed",value:function(){return new t({type:"alreadydisposed"})}},{key:"notBindable",value:function(){return new t({type:"notbindable"})}},{key:"notCompatible",value:function(e,n){return new t({type:"notcompatible",context:{id:"".concat(e,".").concat(n)}})}},{key:"propertyNotFound",value:function(e){return new t({type:"propertynotfound",context:{name:e}})}},{key:"shouldNeverHappen",value:function(){return new t({type:"shouldneverhappen"})}}])}(),P=function(){function t(e,n){r(this,t),this.obj_=e,this.key=n}return o(t,[{key:"read",value:function(){return this.obj_[this.key]}},{key:"write",value:function(t){this.obj_[this.key]=t}},{key:"writeProperty",value:function(e,n){var r=this.read();if(!t.isBindable(r))throw A.notBindable();if(!(e in r))throw A.propertyNotFound(e);r[e]=n}}],[{key:"isBindable",value:function(t){return null!==t&&("object"===b(t)||"function"==typeof t)}}])}(),S=o((function t(){r(this,t),this.observers_={}}),[{key:"on",value:function(t,e,n){var r,i=this.observers_[t];return i||(i=this.observers_[t]=[]),i.push({handler:e,key:null!==(r=null==n?void 0:n.key)&&void 0!==r?r:e}),this}},{key:"off",value:function(t,e){var n=this.observers_[t];return n&&(this.observers_[t]=n.filter((function(t){return t.key!==e}))),this}},{key:"emit",value:function(t,e){var n=this.observers_[t];n&&n.forEach((function(t){t.handler(e)}))}}]),V=o((function t(e,n){var i;r(this,t),this.constraint_=null==n?void 0:n.constraint,this.equals_=null!==(i=null==n?void 0:n.equals)&&void 0!==i?i:function(t,e){return t===e},this.emitter=new S,this.rawValue_=e}),[{key:"constraint",get:function(){return this.constraint_}},{key:"rawValue",get:function(){return this.rawValue_},set:function(t){this.setRawValue(t,{forceEmit:!1,last:!0})}},{key:"setRawValue",value:function(t,e){var n=null!=e?e:{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(t):t,i=this.rawValue_;(!this.equals_(i,r)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:r,sender:this}))}}]),j=o((function t(e){r(this,t),this.emitter=new S,this.value_=e}),[{key:"rawValue",get:function(){return this.value_},set:function(t){this.setRawValue(t,{forceEmit:!1,last:!0})}},{key:"setRawValue",value:function(t,e){var n=null!=e?e:{forceEmit:!1,last:!0},r=this.value_;(r!==t||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:n,previousRawValue:r,rawValue:this.value_,sender:this}))}}]),O=o((function t(e){r(this,t),this.emitter=new S,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}),[{key:"rawValue",get:function(){return this.value_.rawValue}},{key:"onValueBeforeChange_",value:function(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}},{key:"onValueChange_",value:function(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}]);function M(t,e){var n=null==e?void 0:e.constraint,r=null==e?void 0:e.equals;return n||r?new V(t,e):new j(t)}var D=function(){function t(e){var n=this;r(this,t),this.emitter=new S,this.valMap_=e;var i=function(t){n.valMap_[t].emitter.on("change",(function(){n.emitter.emit("change",{key:t,sender:n})}))};for(var a in this.valMap_)i(a)}return o(t,[{key:"get",value:function(t){return this.valMap_[t].rawValue}},{key:"set",value:function(t,e){this.valMap_[t].rawValue=e}},{key:"value",value:function(t){return this.valMap_[t]}}],[{key:"createCore",value:function(t){return Object.keys(t).reduce((function(e,n){return Object.assign(e,s({},n,M(t[n])))}),{})}},{key:"fromObject",value:function(e){return new t(this.createCore(e))}}])}(),T=o((function t(e){r(this,t),this.values=D.fromObject({max:e.max,min:e.min})}),[{key:"constrain",value:function(t){var e=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(t,n),e)}}]),B=o((function t(e){r(this,t),this.values=D.fromObject({max:e.max,min:e.min})}),[{key:"constrain",value:function(t){var e=this.values.get("max"),n=this.values.get("min"),r=t;return y(n)||(r=Math.max(r,n)),y(e)||(r=Math.min(r,e)),r}}]),I=o((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,t),this.step=e,this.origin=n}),[{key:"constrain",value:function(t){var e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}]),R=o((function t(e){r(this,t),this.text=e}),[{key:"evaluate",value:function(){return Number(this.text)}},{key:"toString",value:function(){return this.text}}]),L={"**":function(t,e){return Math.pow(t,e)},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"&":function(t,e){return t&e},"^":function(t,e){return t^e},"|":function(t,e){return t|e}},z=o((function t(e,n,i){r(this,t),this.left=n,this.operator=e,this.right=i}),[{key:"evaluate",value:function(){var t=L[this.operator];if(!t)throw new Error("unexpected binary operator: '".concat(this.operator));return t(this.left.evaluate(),this.right.evaluate())}},{key:"toString",value:function(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}]),N={"+":function(t){return t},"-":function(t){return-t},"~":function(t){return~t}},U=o((function t(e,n){r(this,t),this.operator=e,this.expression=n}),[{key:"evaluate",value:function(){var t=N[this.operator];if(!t)throw new Error("unexpected unary operator: '".concat(this.operator));return t(this.expression.evaluate())}},{key:"toString",value:function(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}]);function F(t){return function(e,n){for(var r=0;r<t.length;r++){var i=t[r](e,n);if(""!==i)return i}return""}}function q(t,e){var n,r=t.substr(e).match(/^\s+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function K(t,e){var n,r=t.substr(e).match(/^[0-9]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function G(t,e){var n=t.substr(e,1);if(e+=1,"e"!==n.toLowerCase())return"";var r=function(t,e){var n=K(t,e);if(""!==n)return n;var r=t.substr(e,1);if("-"!==r&&"+"!==r)return"";var i=K(t,e+=1);return""===i?"":r+i}(t,e);return""===r?"":n+r}function $(t,e){var n=t.substr(e,1);if("0"===n)return n;var r=function(t,e){var n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}(t,e);return e+=r.length,""===r?"":r+K(t,e)}var H=F([function(t,e){var n=$(t,e);if(e+=n.length,""===n)return"";var r=t.substr(e,1);if(e+=r.length,"."!==r)return"";var i=K(t,e);return n+r+i+G(t,e+=i.length)},function(t,e){var n=t.substr(e,1);if(e+=n.length,"."!==n)return"";var r=K(t,e);return e+=r.length,""===r?"":n+r+G(t,e)},function(t,e){var n=$(t,e);return e+=n.length,""===n?"":n+G(t,e)}]),Y=F([function(t,e){var n=t.substr(e,2);if(e+=n.length,"0b"!==n.toLowerCase())return"";var r=function(t,e){var n,r=t.substr(e).match(/^[01]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r},function(t,e){var n=t.substr(e,2);if(e+=n.length,"0o"!==n.toLowerCase())return"";var r=function(t,e){var n,r=t.substr(e).match(/^[0-7]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r},function(t,e){var n=t.substr(e,2);if(e+=n.length,"0x"!==n.toLowerCase())return"";var r=function(t,e){var n,r=t.substr(e).match(/^[0-9a-f]+/i);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r}]),W=F([Y,H]);function X(t,e){var n;return null!==(n=function(t,e){var n=W(t,e);return e+=n.length,""===n?null:{evaluable:new R(n),cursor:e}}(t,e))&&void 0!==n?n:function(t,e){var n=t.substr(e,1);if(e+=n.length,"("!==n)return null;var r=J(t,e);if(!r)return null;e=r.cursor,e+=q(t,e).length;var i=t.substr(e,1);return e+=i.length,")"!==i?null:{evaluable:r.evaluable,cursor:e}}(t,e)}function Q(t,e,n){n+=q(e,n).length;var r=t.filter((function(t){return e.startsWith(t,n)}))[0];return r?(n+=r.length,{cursor:n+=q(e,n).length,operator:r}):null}var Z=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((function(t,e){return function(t,e){return function(n,r){var i=t(n,r);if(!i)return null;r=i.cursor;for(var a=i.evaluable;;){var o=Q(e,n,r);if(!o)break;r=o.cursor;var s=t(n,r);if(!s)return null;r=s.cursor,a=new z(o.operator,a,s.evaluable)}return a?{cursor:r,evaluable:a}:null}}(t,e)}),(function t(e,n){var r=X(e,n);if(r)return r;var i=e.substr(n,1);if(n+=i.length,"+"!==i&&"-"!==i&&"~"!==i)return null;var a=t(e,n);return a?{cursor:n=a.cursor,evaluable:new U(i,a.evaluable)}:null}));function J(t,e){return e+=q(t,e).length,Z(t,e)}function tt(t){var e,n=function(t){var e=J(t,0);return e?e.cursor+q(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==n?void 0:n.evaluate())&&void 0!==e?e:null}function et(t){if("number"==typeof t)return t;if("string"==typeof t){var e=tt(t);if(!y(e))return e}return 0}function nt(t){return String(t)}function rt(t){return function(e){return e.toFixed(Math.max(Math.min(t,20),0))}}function it(t,e,n,r,i){return r+(t-e)/(n-e)*(i-r)}function at(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ot(t,e,n){return Math.min(Math.max(t,e),n)}function st(t,e){return(t%e+e)%e}function ut(t,e){return y(t.step)?Math.max(at(e),2):at(t.step)}function lt(t){var e;return null!==(e=t.step)&&void 0!==e?e:1}function ct(t,e){var n,r=Math.abs(null!==(n=t.step)&&void 0!==n?n:e);return 0===r?.1:Math.pow(10,Math.floor(Math.log10(r))-1)}function ft(t,e){return y(t.step)?null:new I(t.step,e)}function pt(t){return y(t.max)||y(t.min)?y(t.max)&&y(t.min)?null:new B({max:t.max,min:t.min}):new T({max:t.max,min:t.min})}function ht(t,e){var n,r,i;return{formatter:null!==(n=t.format)&&void 0!==n?n:rt(ut(t,e)),keyScale:null!==(r=t.keyScale)&&void 0!==r?r:lt(t),pointerScale:null!==(i=t.pointerScale)&&void 0!==i?i:ct(t,e)}}function dt(t){return{format:t.optional.function,keyScale:t.optional.number,max:t.optional.number,min:t.optional.number,pointerScale:t.optional.number,step:t.optional.number}}function vt(t){return{constraint:t.constraint,textProps:D.fromObject(ht(t.params,t.initialValue))}}var mt=o((function t(e){r(this,t),this.controller=e}),[{key:"element",get:function(){return this.controller.view.element}},{key:"disabled",get:function(){return this.controller.viewProps.get("disabled")},set:function(t){this.controller.viewProps.set("disabled",t)}},{key:"hidden",get:function(){return this.controller.viewProps.get("hidden")},set:function(t){this.controller.viewProps.set("hidden",t)}},{key:"dispose",value:function(){this.controller.viewProps.set("disposed",!0)}},{key:"importState",value:function(t){return this.controller.importState(t)}},{key:"exportState",value:function(){return this.controller.exportState()}}]),bt=o((function t(e){r(this,t),this.target=e})),gt=function(t){function e(t,i,a){var o;return r(this,e),(o=n(this,e,[t])).value=i,o.last=null==a||a,o}return c(e,t),o(e)}(bt),yt=function(t){function e(t,i){var a;return r(this,e),(a=n(this,e,[t])).expanded=i,a}return c(e,t),o(e)}(bt),wt=function(t){function e(t,i){var a;return r(this,e),(a=n(this,e,[t])).index=i,a}return c(e,t),o(e)}(bt),_t=function(t){function e(t,i){var a;return r(this,e),(a=n(this,e,[t])).native=i,a}return c(e,t),o(e)}(bt),xt=function(t){function e(t){var i;return r(this,e),(i=n(this,e,[t])).onValueChange_=i.onValueChange_.bind(i),i.emitter_=new S,i.controller.value.emitter.on("change",i.onValueChange_),i}return c(e,t),o(e,[{key:"label",get:function(){return this.controller.labelController.props.get("label")},set:function(t){this.controller.labelController.props.set("label",t)}},{key:"key",get:function(){return this.controller.value.binding.target.key}},{key:"tag",get:function(){return this.controller.tag},set:function(t){this.controller.tag=t}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t)}),{key:e}),this}},{key:"off",value:function(t,e){return this.emitter_.off(t,e),this}},{key:"refresh",value:function(){this.controller.value.fetch()}},{key:"onValueChange_",value:function(t){var e=this.controller.value;this.emitter_.emit("change",new gt(this,e.binding.target.read(),t.options.last))}}])}(mt),kt=o((function t(e,n){r(this,t),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=n,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new S}),[{key:"rawValue",get:function(){return this.value_.rawValue},set:function(t){this.value_.rawValue=t}},{key:"setRawValue",value:function(t,e){this.value_.setRawValue(t,e)}},{key:"fetch",value:function(){this.value_.rawValue=this.binding.read()}},{key:"push",value:function(){this.binding.write(this.value_.rawValue)}},{key:"onValueBeforeChange_",value:function(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}},{key:"onValueChange_",value:function(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}]);function Ct(t){return function(e){return function(n){if(!e&&void 0===n)return{succeeded:!1,value:void 0};if(e&&void 0===n)return{succeeded:!0,value:void 0};var r=t(n);return void 0!==r?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}}function Et(t){return{custom:function(e){return Ct(e)(t)},boolean:Ct((function(t){return"boolean"==typeof t?t:void 0}))(t),number:Ct((function(t){return"number"==typeof t?t:void 0}))(t),string:Ct((function(t){return"string"==typeof t?t:void 0}))(t),function:Ct((function(t){return"function"==typeof t?t:void 0}))(t),constant:function(e){return Ct((function(t){return t===e?e:void 0}))(t)},raw:Ct((function(t){return t}))(t),object:function(e){return Ct((function(t){var n;if(null!==(n=t)&&"object"===b(n))return function(t,e){return Object.keys(e).reduce((function(n,r){if(void 0!==n){var i=(0,e[r])(t[r]);return i.succeeded?Object.assign(Object.assign({},n),s({},r,i.value)):void 0}}),{})}(t,e)}))(t)},array:function(e){return Ct((function(t){var n;if(Array.isArray(t))return n=e,t.reduce((function(t,e){if(void 0!==t){var r=n(e);if(r.succeeded&&void 0!==r.value)return[].concat(v(t),[r.value])}}),[])}))(t)}}}var At={optional:Et(!0),required:Et(!1)};function Pt(t,e){var n=e(At),r=At.required.object(n)(t);return r.succeeded?r.value:void 0}function St(t,e,n,r){if(e&&!e(t))return!1;var i=Pt(t,n);return!!i&&r(i)}function Vt(t,e){var n;return k(null!==(n=null==t?void 0:t())&&void 0!==n?n:{},e)}function jt(t){return"value"in t}function Ot(t){return!(!w(t)||!("binding"in t))&&C(t.binding)}var Mt="http://www.w3.org/2000/svg";function Dt(t){t.offsetHeight}function Tt(t){return void 0!==t.ontouchstart}function Bt(){return globalThis.document}var It={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Rt(t,e){var n=t.createElementNS(Mt,"svg");return n.innerHTML=It[e],n}function Lt(t,e,n){t.insertBefore(e,t.children[n])}function zt(t){t.parentElement&&t.parentElement.removeChild(t)}function Nt(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function Ut(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}function Ft(t,e){t.emitter.on("change",(function(t){e(t.rawValue)})),e(t.rawValue)}function qt(t,e,n){Ft(t.value(e),n)}var Kt="tp";function Gt(t){return function(e,n){return[Kt,"-",t,"v",e?"_".concat(e):"",n?"-".concat(n):""].join("")}}var $t=Gt("lbl"),Ht=o((function t(e,n){var i=this;r(this,t),this.element=e.createElement("div"),this.element.classList.add($t()),n.viewProps.bindClassModifiers(this.element);var a=e.createElement("div");a.classList.add($t("l")),qt(n.props,"label",(function(t){y(t)?i.element.classList.add($t(void 0,"nol")):(i.element.classList.remove($t(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(a),a.appendChild(function(t,e){var n=t.createDocumentFragment();return e.split("\n").map((function(e){return t.createTextNode(e)})).forEach((function(e,r){r>0&&n.appendChild(t.createElement("br")),n.appendChild(e)})),n}(e,t)))})),this.element.appendChild(a),this.labelElement=a;var o=e.createElement("div");o.classList.add($t("v")),this.element.appendChild(o),this.valueElement=o})),Yt=o((function t(e,n){r(this,t),this.props=n.props,this.valueController=n.valueController,this.viewProps=n.valueController.viewProps,this.view=new Ht(e,{props:n.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}),[{key:"importProps",value:function(t){var e=this;return St(t,null,(function(t){return{label:t.optional.string}}),(function(t){return e.props.set("label",t.label),!0}))}},{key:"exportProps",value:function(){return Vt(null,{label:this.props.get("label")})}}]),Wt=Gt(""),Xt={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"},Qt=o((function t(e){var n=this;r(this,t),this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;var i=this.view.element;this.blade.value("positions").emitter.on("change",(function(){["veryfirst","first","last","verylast"].forEach((function(t){i.classList.remove(Wt(void 0,Xt[t]))})),n.blade.get("positions").forEach((function(t){i.classList.add(Wt(void 0,Xt[t]))}))})),this.viewProps.handleDispose((function(){zt(i)}))}),[{key:"parent",get:function(){return this.parent_},set:function(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}},{key:"importState",value:function(t){var e=this;return St(t,null,(function(t){return{disabled:t.required.boolean,hidden:t.required.boolean}}),(function(t){return e.viewProps.importState(t),!0}))}},{key:"exportState",value:function(){return Vt(null,Object.assign({},this.viewProps.exportState()))}}]),Zt=function(t){function e(t,i){var a;if(r(this,e),i.value!==i.valueController.value)throw A.shouldNeverHappen();var o=i.valueController.viewProps,s=new Yt(t,{blade:i.blade,props:i.props,valueController:i.valueController});return(a=n(this,e,[Object.assign(Object.assign({},i),{view:new Ht(t,{props:i.props,viewProps:o}),viewProps:o})])).labelController=s,a.value=i.value,a.valueController=i.valueController,a.view.valueElement.appendChild(a.valueController.view.element),a}return c(e,t),o(e,[{key:"importState",value:function(t){var n=this;return St(t,(function(r){var i,a,o;return d(e,"importState",n)([r])&&n.labelController.importProps(r)&&(null===(o=null===(a=(i=n.valueController).importProps)||void 0===a?void 0:a.call(i,t))||void 0===o||o)}),(function(t){return{value:t.optional.raw}}),(function(t){return t.value&&(n.value.rawValue=t.value),!0}))}},{key:"exportState",value:function(){var t,n,r,i=this;return Vt((function(){return d(e,"exportState",i)([])}),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(r=null===(n=(t=this.valueController).exportProps)||void 0===n?void 0:n.call(t))&&void 0!==r?r:{}))}}])}(Qt);function Jt(t){var e=Object.assign({},t);return delete e.value,e}var te=function(t){function e(t,i){var a;return r(this,e),(a=n(this,e,[t,i])).tag=i.tag,a}return c(e,t),o(e,[{key:"importState",value:function(t){var n=this;return St(t,(function(r){return d(e,"importState",n)([Jt(t)])}),(function(t){return{tag:t.optional.string}}),(function(t){return n.tag=t.tag,!0}))}},{key:"exportState",value:function(){var t=this;return Vt((function(){return Jt(d(e,"exportState",t)([]))}),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}])}(Zt),ee=function(t){function e(){return r(this,e),n(this,e,arguments)}return c(e,t),o(e,[{key:"importState",value:function(t){var n=this;return St(t,(function(t){return d(e,"importState",n)([t])}),(function(t){return{binding:t.required.object({value:t.required.raw})}}),(function(t){return n.value.binding.inject(t.binding.value),n.value.fetch(),!0}))}}])}(te);function ne(t){return jt(t)&&function(t){if(!("binding"in t))return!1;var e=t.binding;return C(e)&&"read"in e&&"write"in e}(t.value)}function re(t,e){for(;t.length<e;)t.push(void 0)}var ie=o((function t(e){var n;r(this,t),this.emitter=new S,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=M((re(n=[],e.bufferSize),n)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}),[{key:"rawValue",get:function(){return this.value_.rawValue},set:function(t){this.value_.rawValue=t}},{key:"setRawValue",value:function(t,e){this.value_.setRawValue(t,e)}},{key:"fetch",value:function(){var t,e,n;this.value_.rawValue=(t=this.value_.rawValue,e=this.binding.read(),n=[].concat(v(function(t){var e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}(t)),[e]),n.length>t.length?n.splice(0,n.length-t.length):re(n,t.length),n)}},{key:"onTick_",value:function(){this.fetch()}},{key:"onValueBeforeChange_",value:function(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}},{key:"onValueChange_",value:function(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}]),ae=function(t){function e(){return r(this,e),n(this,e,arguments)}return c(e,t),o(e,[{key:"exportState",value:function(){var t=this;return Vt((function(){return d(e,"exportState",t)([])}),{binding:{readonly:!0}})}}])}(te);function oe(t){return jt(t)&&function(t){if(!("binding"in t))return!1;var e=t.binding;return C(e)&&"read"in e&&!("write"in e)}(t.value)}var se=function(t){function e(){return r(this,e),n(this,e,arguments)}return c(e,t),o(e,[{key:"label",get:function(){return this.controller.labelController.props.get("label")},set:function(t){this.controller.labelController.props.set("label",t)}},{key:"title",get:function(){var t;return null!==(t=this.controller.buttonController.props.get("title"))&&void 0!==t?t:""},set:function(t){this.controller.buttonController.props.set("title",t)}},{key:"on",value:function(t,e){var n=this,r=e.bind(this);return this.controller.buttonController.emitter.on(t,(function(t){r(new _t(n,t.nativeEvent))})),this}},{key:"off",value:function(t,e){return this.controller.buttonController.emitter.off(t,e),this}}])}(mt);function ue(t,e){return function(n){!function(t,e,n){n?t.classList.add(e):t.classList.remove(e)}(t,e,n)}}function le(t,e){Ft(t,(function(t){e.textContent=null!=t?t:""}))}var ce=Gt("btn"),fe=o((function t(e,n){r(this,t),this.element=e.createElement("div"),this.element.classList.add(ce()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("button");i.classList.add(ce("b")),n.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;var a=e.createElement("div");a.classList.add(ce("t")),le(n.props.value("title"),a),this.buttonElement.appendChild(a)})),pe=o((function t(e,n){r(this,t),this.emitter=new S,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new fe(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}),[{key:"importProps",value:function(t){var e=this;return St(t,null,(function(t){return{title:t.optional.string}}),(function(t){return e.props.set("title",t.title),!0}))}},{key:"exportProps",value:function(){return Vt(null,{title:this.props.get("title")})}},{key:"onClick_",value:function(t){this.emitter.emit("click",{nativeEvent:t,sender:this})}}]),he=function(t){function e(t,i){var a;r(this,e);var o=new pe(t,{props:i.buttonProps,viewProps:i.viewProps}),s=new Yt(t,{blade:i.blade,props:i.labelProps,valueController:o});return(a=n(this,e,[{blade:i.blade,view:s.view,viewProps:i.viewProps}])).buttonController=o,a.labelController=s,a}return c(e,t),o(e,[{key:"importState",value:function(t){var n=this;return St(t,(function(t){return d(e,"importState",n)([t])&&n.buttonController.importProps(t)&&n.labelController.importProps(t)}),(function(){return{}}),(function(){return!0}))}},{key:"exportState",value:function(){var t=this;return Vt((function(){return d(e,"exportState",t)([])}),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}])}(Qt),de=o((function t(e){r(this,t);var n=h(e.split("-"),2),i=n[0],a=n[1],o=i.split(".");this.major=parseInt(o[0],10),this.minor=parseInt(o[1],10),this.patch=parseInt(o[2],10),this.prerelease=null!=a?a:null}),[{key:"toString",value:function(){var t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}]),ve=new de("2.0.5");function me(t){return Object.assign({core:ve},t)}var be=me({id:"button",type:"blade",accept:function(t){var e=Pt(t,(function(t){return{title:t.required.string,view:t.required.constant("button"),label:t.optional.string}}));return e?{params:e}:null},controller:function(t){return new he(t.document,{blade:t.blade,buttonProps:D.fromObject({title:t.params.title}),labelProps:D.fromObject({label:t.params.label}),viewProps:t.viewProps})},api:function(t){return t.controller instanceof he?new se(t.controller):null}}),ge=o((function t(e,n){r(this,t),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new S,this.pool_=n,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}),[{key:"children",get:function(){var t=this;return this.controller_.rack.children.map((function(e){return t.pool_.createApi(e)}))}},{key:"addBinding",value:function(t,e,n){var r=null!=n?n:{},i=this.controller_.element.ownerDocument,a=this.pool_.createBinding(i,function(t,e){if(!P.isBindable(t))throw A.notBindable();return new P(t,e)}(t,e),r),o=this.pool_.createBindingApi(a);return this.add(o,r.index)}},{key:"addFolder",value:function(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}},{key:"addButton",value:function(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}},{key:"addTab",value:function(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}},{key:"add",value:function(t,e){var n=t.controller;return this.controller_.rack.add(n,e),t}},{key:"remove",value:function(t){this.controller_.rack.remove(t.controller)}},{key:"addBlade",value:function(t){var e=this.controller_.element.ownerDocument,n=this.pool_.createBlade(e,t),r=this.pool_.createApi(n);return this.add(r,t.index)}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t)}),{key:e}),this}},{key:"off",value:function(t,e){return this.emitter_.off(t,e),this}},{key:"refresh",value:function(){this.children.forEach((function(t){var e;w(e=t)&&"refresh"in e&&"function"==typeof e.refresh&&t.refresh()}))}},{key:"onRackValueChange_",value:function(t){var e=t.bladeController,n=this.pool_.createApi(e),r=Ot(e.value)?e.value.binding:null;this.emitter_.emit("change",new gt(n,r?r.target.read():e.value.rawValue,t.options.last))}}]),ye=function(t){function e(t,i){var a;return r(this,e),(a=n(this,e,[t])).rackApi_=new ge(t.rackController,i),a}return c(e,t),o(e,[{key:"refresh",value:function(){this.rackApi_.refresh()}}])}(mt),we=function(t){function e(t){var i;return r(this,e),(i=n(this,e,[{blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}])).rackController=t.rackController,i}return c(e,t),o(e,[{key:"importState",value:function(t){var n=this;return St(t,(function(t){return d(e,"importState",n)([t])}),(function(t){return{children:t.required.array(t.required.raw)}}),(function(t){return n.rackController.rack.children.every((function(e,n){return e.importState(t.children[n])}))}))}},{key:"exportState",value:function(){var t=this;return Vt((function(){return d(e,"exportState",t)([])}),{children:this.rackController.rack.children.map((function(t){return t.exportState()}))})}}])}(Qt);function _e(t){return"rackController"in t}var xe=o((function t(e){r(this,t),this.emitter=new S,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}),[{key:"items",get:function(){return this.items_}},{key:"allItems",value:function(){return Array.from(this.cache_)}},{key:"find",value:function(t){var e,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=g(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(this.allItems());try{for(n.s();!(e=n.n()).done;){var r=e.value;if(t(r))return r}}catch(t){n.e(t)}finally{n.f()}return null}},{key:"includes",value:function(t){return this.cache_.has(t)}},{key:"add",value:function(t,e){var n=this;if(this.includes(t))throw A.shouldNeverHappen();var r=void 0!==e?e:this.items_.length;this.items_.splice(r,0,t),this.cache_.add(t);var i=this.extract_(t);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((function(t){n.cache_.add(t)}))),this.emitter.emit("add",{index:r,item:t,root:this,target:this})}},{key:"remove",value:function(t){var e=this,n=this.items_.indexOf(t);if(!(n<0)){this.items_.splice(n,1),this.cache_.delete(t);var r=this.extract_(t);r&&(r.allItems().forEach((function(t){e.cache_.delete(t)})),r.emitter.off("add",this.onSubListAdd_),r.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:n,item:t,root:this,target:this})}}},{key:"onSubListAdd_",value:function(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}},{key:"onSubListRemove_",value:function(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}]);function ke(t){return _e(t)?t.rackController.rack.bcSet_:null}var Ce=o((function t(e){var n,i;r(this,t),this.emitter=new S,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(n=e.blade)&&void 0!==n?n:null,null===(i=this.blade_)||void 0===i||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new xe(ke),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}),[{key:"children",get:function(){return this.bcSet_.items}},{key:"add",value:function(t,e){var n;null===(n=t.parent)||void 0===n||n.remove(t),t.parent=this,this.bcSet_.add(t,e)}},{key:"remove",value:function(t){t.parent=null,this.bcSet_.remove(t)}},{key:"find",value:function(t){return this.bcSet_.allItems().filter(t)}},{key:"onSetAdd_",value:function(t){this.updatePositions_();var e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),e){var n=t.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),jt(n))n.value.emitter.on("change",this.onChildValueChange_);else if(_e(n)){var r=n.rackController.rack;if(r){var i=r.emitter;i.on("layout",this.onRackLayout_),i.on("valuechange",this.onRackValueChange_)}}}}},{key:"onSetRemove_",value:function(t){this.updatePositions_();var e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),e){var n=t.item;if(jt(n))n.value.emitter.off("change",this.onChildValueChange_);else if(_e(n)){var r=n.rackController.rack;if(r){var i=r.emitter;i.off("layout",this.onRackLayout_),i.off("valuechange",this.onRackValueChange_)}}}}},{key:"updatePositions_",value:function(){var t=this,e=this.bcSet_.items.filter((function(t){return!t.viewProps.get("hidden")})),n=e[0],r=e[e.length-1];this.bcSet_.items.forEach((function(e){var i=[];e===n&&(i.push("first"),t.blade_&&!t.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),e===r&&(i.push("last"),t.blade_&&!t.blade_.get("positions").includes("verylast")||i.push("verylast")),e.blade.set("positions",i)}))}},{key:"onChildPositionsChange_",value:function(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onChildViewPropsChange_",value:function(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onChildDispose_",value:function(){var t=this;this.bcSet_.items.filter((function(t){return t.viewProps.get("disposed")})).forEach((function(e){t.bcSet_.remove(e)}))}},{key:"onChildValueChange_",value:function(t){var e=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(jt(r)&&r.value===e)return r}return null}(this.find(jt),t.sender);if(!e)throw A.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}},{key:"onRackLayout_",value:function(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onRackValueChange_",value:function(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}},{key:"onBladePositionsChange_",value:function(){this.updatePositions_()}}]),Ee=o((function t(e){var n=this;r(this,t),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;var i=new Ce({blade:e.root?void 0:e.blade,viewProps:e.viewProps});i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),this.rack=i,this.viewProps.handleDispose((function(){for(var t=n.rack.children.length-1;t>=0;t--)n.rack.children[t].viewProps.set("disposed",!0)}))}),[{key:"onRackAdd_",value:function(t){t.root&&Lt(this.element,t.bladeController.view.element,t.index)}},{key:"onRackRemove_",value:function(t){t.root&&zt(t.bladeController.view.element)}}]);function Ae(){return new D({positions:M([],{equals:x})})}var Pe=function(t){function e(t){return r(this,e),n(this,e,[t])}return c(e,t),o(e,[{key:"styleExpanded",get:function(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}},{key:"styleHeight",get:function(){if(!this.styleExpanded)return"0";var t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!y(t)?"".concat(t,"px"):"auto"}},{key:"bindExpandedClass",value:function(t,e){var n=this,r=function(){n.styleExpanded?t.classList.add(e):t.classList.remove(e)};qt(this,"expanded",r),qt(this,"temporaryExpanded",r)}},{key:"cleanUpTransition",value:function(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}],[{key:"create",value:function(t){var n={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null};return new e(D.createCore(n))}}])}(D);function Se(t,e){e.style.height=t.styleHeight}function Ve(t,e){t.value("expanded").emitter.on("beforechange",(function(){if(t.set("completed",!1),y(t.get("expandedHeight"))){var n=(r=t,u=0,o=function(){r.set("expandedHeight",null),r.set("temporaryExpanded",!0),Dt(i),u=i.clientHeight,r.set("temporaryExpanded",null),Dt(i)},s=(a=i=e).style.transition,a.style.transition="none",o(),a.style.transition=s,u);n>0&&t.set("expandedHeight",n)}var r,i,a,o,s,u;t.set("shouldFixHeight",!0),Dt(e)})),t.emitter.on("change",(function(){Se(t,e)})),Se(t,e),e.addEventListener("transitionend",(function(e){"height"===e.propertyName&&t.cleanUpTransition()}))}var je=function(t){function e(t,i){var a;return r(this,e),(a=n(this,e,[t,i])).emitter_=new S,a.controller.foldable.value("expanded").emitter.on("change",(function(t){a.emitter_.emit("fold",new yt(a,t.sender.rawValue))})),a.rackApi_.on("change",(function(t){a.emitter_.emit("change",t)})),a}return c(e,t),o(e,[{key:"expanded",get:function(){return this.controller.foldable.get("expanded")},set:function(t){this.controller.foldable.set("expanded",t)}},{key:"title",get:function(){return this.controller.props.get("title")},set:function(t){this.controller.props.set("title",t)}},{key:"children",get:function(){return this.rackApi_.children}},{key:"addBinding",value:function(t,e,n){return this.rackApi_.addBinding(t,e,n)}},{key:"addFolder",value:function(t){return this.rackApi_.addFolder(t)}},{key:"addButton",value:function(t){return this.rackApi_.addButton(t)}},{key:"addTab",value:function(t){return this.rackApi_.addTab(t)}},{key:"add",value:function(t,e){return this.rackApi_.add(t,e)}},{key:"remove",value:function(t){this.rackApi_.remove(t)}},{key:"addBlade",value:function(t){return this.rackApi_.addBlade(t)}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t)}),{key:e}),this}},{key:"off",value:function(t,e){return this.emitter_.off(t,e),this}}])}(ye),Oe=Gt("cnt"),Me=o((function t(e,n){var i,a=this;r(this,t),this.className_=Gt(null!==(i=n.viewName)&&void 0!==i?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Oe()),n.viewProps.bindClassModifiers(this.element),this.foldable_=n.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),qt(this.foldable_,"completed",ue(this.element,this.className_(void 0,"cpl")));var o=e.createElement("button");o.classList.add(this.className_("b")),qt(n.props,"title",(function(t){y(t)?a.element.classList.add(a.className_(void 0,"not")):a.element.classList.remove(a.className_(void 0,"not"))})),n.viewProps.bindDisabled(o),this.element.appendChild(o),this.buttonElement=o;var s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);var u=e.createElement("div");u.classList.add(this.className_("t")),le(n.props.value("title"),u),this.buttonElement.appendChild(u),this.titleElement=u;var l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);var c=e.createElement("div");c.classList.add(this.className_("c")),this.element.appendChild(c),this.containerElement=c})),De=function(t){function e(t,i){var a,o;r(this,e);var s=Pe.create(null===(o=i.expanded)||void 0===o||o),u=new Me(t,{foldable:s,props:i.props,viewName:i.root?"rot":void 0,viewProps:i.viewProps});return(a=n(this,e,[Object.assign(Object.assign({},i),{rackController:new Ee({blade:i.blade,element:u.containerElement,root:i.root,viewProps:i.viewProps}),view:u})])).onTitleClick_=a.onTitleClick_.bind(a),a.props=i.props,a.foldable=s,Ve(a.foldable,a.view.containerElement),a.rackController.rack.emitter.on("add",(function(){a.foldable.cleanUpTransition()})),a.rackController.rack.emitter.on("remove",(function(){a.foldable.cleanUpTransition()})),a.view.buttonElement.addEventListener("click",a.onTitleClick_),a}return c(e,t),o(e,[{key:"document",get:function(){return this.view.element.ownerDocument}},{key:"importState",value:function(t){var n=this;return St(t,(function(t){return d(e,"importState",n)([t])}),(function(t){return{expanded:t.required.boolean,title:t.optional.string}}),(function(t){return n.foldable.set("expanded",t.expanded),n.props.set("title",t.title),!0}))}},{key:"exportState",value:function(){var t=this;return Vt((function(){return d(e,"exportState",t)([])}),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}},{key:"onTitleClick_",value:function(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}])}(we),Te=me({id:"folder",type:"blade",accept:function(t){var e=Pt(t,(function(t){return{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}}));return e?{params:e}:null},controller:function(t){return new De(t.document,{blade:t.blade,expanded:t.params.expanded,props:D.fromObject({title:t.params.title}),viewProps:t.viewProps})},api:function(t){return t.controller instanceof De?new je(t.controller,t.pool):null}}),Be=Gt("");function Ie(t,e){return ue(t,Be(void 0,e))}var Re=function(t){function e(t){var i,a;r(this,e),(i=n(this,e,[t])).onDisabledChange_=i.onDisabledChange_.bind(i),i.onParentChange_=i.onParentChange_.bind(i),i.onParentGlobalDisabledChange_=i.onParentGlobalDisabledChange_.bind(i);var o,s=h((o=M(i.getGlobalDisabled_()),[new O(o),function(t,e){o.setRawValue(t,e)}]),2);return i.globalDisabled_=s[0],i.setGlobalDisabled_=s[1],i.value("disabled").emitter.on("change",i.onDisabledChange_),i.value("parent").emitter.on("change",i.onParentChange_),null===(a=i.get("parent"))||void 0===a||a.globalDisabled.emitter.on("change",i.onParentGlobalDisabledChange_),i}return c(e,t),o(e,[{key:"globalDisabled",get:function(){return this.globalDisabled_}},{key:"bindClassModifiers",value:function(t){Ft(this.globalDisabled_,Ie(t,"disabled")),qt(this,"hidden",Ie(t,"hidden"))}},{key:"bindDisabled",value:function(t){Ft(this.globalDisabled_,(function(e){t.disabled=e}))}},{key:"bindTabIndex",value:function(t){Ft(this.globalDisabled_,(function(e){t.tabIndex=e?-1:0}))}},{key:"handleDispose",value:function(t){this.value("disposed").emitter.on("change",(function(e){e&&t()}))}},{key:"importState",value:function(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}},{key:"exportState",value:function(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}},{key:"getGlobalDisabled_",value:function(){var t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}},{key:"updateGlobalDisabled_",value:function(){this.setGlobalDisabled_(this.getGlobalDisabled_())}},{key:"onDisabledChange_",value:function(){this.updateGlobalDisabled_()}},{key:"onParentGlobalDisabledChange_",value:function(){this.updateGlobalDisabled_()}},{key:"onParentChange_",value:function(t){var e,n=t.previousRawValue;null==n||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}],[{key:"create",value:function(t){var n,r,i,a=null!=t?t:{};return new e(D.createCore({disabled:null!==(n=a.disabled)&&void 0!==n&&n,disposed:!1,hidden:null!==(r=a.hidden)&&void 0!==r&&r,parent:null!==(i=a.parent)&&void 0!==i?i:null}))}}])}(D),Le=Gt("tbp"),ze=o((function t(e,n){r(this,t),this.element=e.createElement("div"),this.element.classList.add(Le()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("div");i.classList.add(Le("c")),this.element.appendChild(i),this.containerElement=i})),Ne=Gt("tbi"),Ue=o((function t(e,n){var i=this;r(this,t),this.element=e.createElement("div"),this.element.classList.add(Ne()),n.viewProps.bindClassModifiers(this.element),qt(n.props,"selected",(function(t){t?i.element.classList.add(Ne(void 0,"sel")):i.element.classList.remove(Ne(void 0,"sel"))}));var a=e.createElement("button");a.classList.add(Ne("b")),n.viewProps.bindDisabled(a),this.element.appendChild(a),this.buttonElement=a;var o=e.createElement("div");o.classList.add(Ne("t")),le(n.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o})),Fe=o((function t(e,n){r(this,t),this.emitter=new S,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new Ue(e,{props:n.props,viewProps:n.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}),[{key:"onClick_",value:function(){this.emitter.emit("click",{sender:this})}}]),qe=function(t){function e(t,i){var a;r(this,e);var o=new ze(t,{viewProps:i.viewProps});return(a=n(this,e,[Object.assign(Object.assign({},i),{rackController:new Ee({blade:i.blade,element:o.containerElement,viewProps:i.viewProps}),view:o})])).onItemClick_=a.onItemClick_.bind(a),a.ic_=new Fe(t,{props:i.itemProps,viewProps:Re.create()}),a.ic_.emitter.on("click",a.onItemClick_),a.props=i.props,qt(a.props,"selected",(function(t){a.itemController.props.set("selected",t),a.viewProps.set("hidden",!t)})),a}return c(e,t),o(e,[{key:"itemController",get:function(){return this.ic_}},{key:"importState",value:function(t){var n=this;return St(t,(function(t){return d(e,"importState",n)([t])}),(function(t){return{selected:t.required.boolean,title:t.required.string}}),(function(t){return n.ic_.props.set("selected",t.selected),n.ic_.props.set("title",t.title),!0}))}},{key:"exportState",value:function(){var t=this;return Vt((function(){return d(e,"exportState",t)([])}),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}},{key:"onItemClick_",value:function(){this.props.set("selected",!0)}}])}(we),Ke=function(t){function e(t,i){var a;return r(this,e),(a=n(this,e,[t,i])).emitter_=new S,a.onSelect_=a.onSelect_.bind(a),a.pool_=i,a.rackApi_.on("change",(function(t){a.emitter_.emit("change",t)})),a.controller.tab.selectedIndex.emitter.on("change",a.onSelect_),a}return c(e,t),o(e,[{key:"pages",get:function(){return this.rackApi_.children}},{key:"addPage",value:function(t){var e=this.controller.view.element.ownerDocument,n=new qe(e,{blade:Ae(),itemProps:D.fromObject({selected:!1,title:t.title}),props:D.fromObject({selected:!1}),viewProps:Re.create()}),r=this.pool_.createApi(n);return this.rackApi_.add(r,t.index)}},{key:"removePage",value:function(t){this.rackApi_.remove(this.rackApi_.children[t])}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t)}),{key:e}),this}},{key:"off",value:function(t,e){return this.emitter_.off(t,e),this}},{key:"onSelect_",value:function(t){this.emitter_.emit("select",new wt(this,t.rawValue))}}])}(ye),Ge=function(t){function e(){return r(this,e),n(this,e,arguments)}return c(e,t),o(e,[{key:"title",get:function(){var t;return null!==(t=this.controller.itemController.props.get("title"))&&void 0!==t?t:""},set:function(t){this.controller.itemController.props.set("title",t)}},{key:"selected",get:function(){return this.controller.props.get("selected")},set:function(t){this.controller.props.set("selected",t)}},{key:"children",get:function(){return this.rackApi_.children}},{key:"addButton",value:function(t){return this.rackApi_.addButton(t)}},{key:"addFolder",value:function(t){return this.rackApi_.addFolder(t)}},{key:"addTab",value:function(t){return this.rackApi_.addTab(t)}},{key:"add",value:function(t,e){this.rackApi_.add(t,e)}},{key:"remove",value:function(t){this.rackApi_.remove(t)}},{key:"addBinding",value:function(t,e,n){return this.rackApi_.addBinding(t,e,n)}},{key:"addBlade",value:function(t){return this.rackApi_.addBlade(t)}}])}(ye),$e=o((function t(){r(this,t),this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=M(!0),this.selectedIndex=M(-1),this.items_=[]}),[{key:"add",value:function(t,e){var n=null!=e?e:this.items_.length;this.items_.splice(n,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}},{key:"remove",value:function(t){var e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}},{key:"keepSelection_",value:function(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);var t=this.items_.findIndex((function(t){return t.rawValue}));t<0?(this.items_.forEach((function(t,e){t.rawValue=0===e})),this.selectedIndex.rawValue=0):(this.items_.forEach((function(e,n){e.rawValue=n===t})),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}},{key:"onItemSelectedChange_",value:function(t){if(t.rawValue){var e=this.items_.findIndex((function(e){return e===t.sender}));this.items_.forEach((function(t,n){t.rawValue=n===e})),this.selectedIndex.rawValue=e}else this.keepSelection_()}}]),He=Gt("tab"),Ye=o((function t(e,n){r(this,t),this.element=e.createElement("div"),this.element.classList.add(He(),Oe()),n.viewProps.bindClassModifiers(this.element),Ft(n.empty,ue(this.element,He(void 0,"nop")));var i=e.createElement("div");i.classList.add(He("t")),this.element.appendChild(i),this.itemsElement=i;var a=e.createElement("div");a.classList.add(He("i")),this.element.appendChild(a);var o=e.createElement("div");o.classList.add(He("c")),this.element.appendChild(o),this.contentsElement=o})),We=function(t){function e(t,i){var a;r(this,e);var o=new $e,s=new Ye(t,{empty:o.empty,viewProps:i.viewProps});(a=n(this,e,[{blade:i.blade,rackController:new Ee({blade:i.blade,element:s.contentsElement,viewProps:i.viewProps}),view:s}])).onRackAdd_=a.onRackAdd_.bind(a),a.onRackRemove_=a.onRackRemove_.bind(a);var u=a.rackController.rack;return u.emitter.on("add",a.onRackAdd_),u.emitter.on("remove",a.onRackRemove_),a.tab=o,a}return c(e,t),o(e,[{key:"add",value:function(t,e){this.rackController.rack.add(t,e)}},{key:"remove",value:function(t){this.rackController.rack.remove(this.rackController.rack.children[t])}},{key:"onRackAdd_",value:function(t){if(t.root){var e=t.bladeController;Lt(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}}},{key:"onRackRemove_",value:function(t){if(t.root){var e=t.bladeController;zt(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}}])}(we),Xe=me({id:"tab",type:"blade",accept:function(t){var e=Pt(t,(function(t){return{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}}));return e&&0!==e.pages.length?{params:e}:null},controller:function(t){var e=new We(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach((function(n){var r=new qe(t.document,{blade:Ae(),itemProps:D.fromObject({selected:!1,title:n.title}),props:D.fromObject({selected:!1}),viewProps:Re.create()});e.add(r)})),e},api:function(t){return t.controller instanceof We?new Ke(t.controller,t.pool):t.controller instanceof qe?new Ge(t.controller,t.pool):null}});function Qe(t,e){var n=t.accept(e.params);if(!n)return null;var r=Pt(e.params,(function(t){return{disabled:t.optional.boolean,hidden:t.optional.boolean}}));return t.controller({blade:Ae(),document:e.document,params:Object.assign(Object.assign({},n.params),{disabled:null==r?void 0:r.disabled,hidden:null==r?void 0:r.hidden}),viewProps:Re.create({disabled:null==r?void 0:r.disabled,hidden:null==r?void 0:r.hidden})})}var Ze=function(t){function e(){return r(this,e),n(this,e,arguments)}return c(e,t),o(e,[{key:"options",get:function(){return this.controller.valueController.props.get("options")},set:function(t){this.controller.valueController.props.set("options",t)}}])}(xt),Je=o((function t(){r(this,t),this.disabled=!1,this.emitter=new S}),[{key:"dispose",value:function(){}},{key:"tick",value:function(){this.disabled||this.emitter.emit("tick",{sender:this})}}]),tn=o((function t(e,n){r(this,t),this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new S,this.interval_=n,this.setTimer_()}),[{key:"disabled",get:function(){return this.disabled_},set:function(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}},{key:"dispose",value:function(){this.clearTimer_()}},{key:"clearTimer_",value:function(){if(null!==this.timerId_){var t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}}},{key:"setTimer_",value:function(){if(this.clearTimer_(),!(this.interval_<=0)){var t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}}},{key:"onTick_",value:function(){this.disabled_||this.emitter.emit("tick",{sender:this})}}]),en=o((function t(e){r(this,t),this.constraints=e}),[{key:"constrain",value:function(t){return this.constraints.reduce((function(t,e){return e.constrain(t)}),t)}}]);function nn(t,e){if(t instanceof e)return t;if(t instanceof en){var n=t.constraints.reduce((function(t,n){return t||(n instanceof e?n:null)}),null);if(n)return n}return null}var rn=o((function t(e){r(this,t),this.values=D.fromObject({options:e})}),[{key:"constrain",value:function(t){var e=this.values.get("options");return 0===e.length||e.filter((function(e){return e.value===t})).length>0?t:e[0].value}}]);function an(t){var e,n=At;return Array.isArray(t)?null===(e=Pt({items:t},(function(t){return{items:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))}})))||void 0===e?void 0:e.items:"object"===b(t)?n.required.raw(t).value:void 0}function on(t){if(Array.isArray(t))return t;var e=[];return Object.keys(t).forEach((function(n){e.push({text:n,value:t[n]})})),e}function sn(t){return y(t)?null:new rn(on(t))}var un=Gt("lst"),ln=o((function t(e,n){var i=this;r(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.props_=n.props,this.element=e.createElement("div"),this.element.classList.add(un()),n.viewProps.bindClassModifiers(this.element);var a=e.createElement("select");a.classList.add(un("s")),n.viewProps.bindDisabled(a),this.element.appendChild(a),this.selectElement=a;var o=e.createElement("div");o.classList.add(un("m")),o.appendChild(Rt(e,"dropdown")),this.element.appendChild(o),n.value.emitter.on("change",this.onValueChange_),this.value_=n.value,qt(this.props_,"options",(function(t){Nt(i.selectElement),t.forEach((function(t){var n=e.createElement("option");n.textContent=t.text,i.selectElement.appendChild(n)})),i.update_()}))}),[{key:"update_",value:function(){var t=this.props_.get("options").map((function(t){return t.value}));this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}},{key:"onValueChange_",value:function(){this.update_()}}]),cn=o((function t(e,n){r(this,t),this.onSelectChange_=this.onSelectChange_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new ln(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}),[{key:"onSelectChange_",value:function(t){var e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}},{key:"importProps",value:function(t){var e=this;return St(t,null,(function(t){return{options:t.required.custom(an)}}),(function(t){return e.props.set("options",on(t.options)),!0}))}},{key:"exportProps",value:function(){return Vt(null,{options:this.props.get("options")})}}]),fn=Gt("pop"),pn=o((function t(e,n){r(this,t),this.element=e.createElement("div"),this.element.classList.add(fn()),n.viewProps.bindClassModifiers(this.element),Ft(n.shows,ue(this.element,fn(void 0,"v")))})),hn=o((function t(e,n){r(this,t),this.shows=M(!1),this.viewProps=n.viewProps,this.view=new pn(e,{shows:this.shows,viewProps:this.viewProps})})),dn=Gt("txt"),vn=o((function t(e,n){r(this,t),this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(dn()),n.viewProps.bindClassModifiers(this.element),this.props_=n.props,this.props_.emitter.on("change",this.onChange_);var i=e.createElement("input");i.classList.add(dn("i")),i.type="text",n.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,n.value.emitter.on("change",this.onChange_),this.value_=n.value,this.refresh()}),[{key:"refresh",value:function(){var t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}},{key:"onChange_",value:function(){this.refresh()}}]),mn=o((function t(e,n){r(this,t),this.onInputChange_=this.onInputChange_.bind(this),this.parser_=n.parser,this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new vn(e,{props:n.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}),[{key:"onInputChange_",value:function(t){var e=t.currentTarget.value,n=this.parser_(e);y(n)||(this.value.rawValue=n),this.view.refresh()}}]);function bn(t){return"false"!==t&&!!t}function gn(t){return function(t){return String(t)}(t)}var yn=rt(0);function wn(t){return yn(t)+"%"}function _n(t){return String(t)}function xn(t){return t}function kn(t){var e=t.primary,n=t.secondary,r=t.forward,i=t.backward,a=!1;function o(t){a||(a=!0,t(),a=!1)}e.emitter.on("change",(function(t){o((function(){n.setRawValue(r(e.rawValue,n.rawValue),t.options)}))})),n.emitter.on("change",(function(t){o((function(){e.setRawValue(i(e.rawValue,n.rawValue),t.options)})),o((function(){n.setRawValue(r(e.rawValue,n.rawValue),t.options)}))})),o((function(){n.setRawValue(r(e.rawValue,n.rawValue),{forceEmit:!1,last:!0})}))}function Cn(t,e){var n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function En(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function An(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function Pn(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function Sn(t,e){var n,r,i=e.ownerDocument.defaultView,a=e.getBoundingClientRect();return{x:t.pageX-((null!==(n=i&&i.scrollX)&&void 0!==n?n:0)+a.left),y:t.pageY-((null!==(r=i&&i.scrollY)&&void 0!==r?r:0)+a.top)}}var Vn=o((function t(e){r(this,t),this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new S,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}),[{key:"computePosition_",value:function(t){var e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}},{key:"onMouseDown_",value:function(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();var n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Sn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}},{key:"onDocumentMouseMove_",value:function(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Sn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}},{key:"onDocumentMouseUp_",value:function(t){var e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Sn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}},{key:"onTouchStart_",value:function(t){t.preventDefault();var e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}},{key:"onTouchMove_",value:function(t){var e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}},{key:"onTouchEnd_",value:function(t){var e,n=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:void 0),sender:this,shiftKey:t.shiftKey})}}]),jn=Gt("txt"),On=o((function t(e,n){r(this,t),this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(jn(),jn(void 0,"num")),n.arrayPosition&&this.element.classList.add(jn(void 0,n.arrayPosition)),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("input");i.classList.add(jn("i")),i.type="text",n.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=n.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(jn()),this.inputElement.classList.add(jn("i"));var a=e.createElement("div");a.classList.add(jn("k")),this.element.appendChild(a),this.knobElement=a;var o=e.createElementNS(Mt,"svg");o.classList.add(jn("g")),this.knobElement.appendChild(o);var s=e.createElementNS(Mt,"path");s.classList.add(jn("gb")),o.appendChild(s),this.guideBodyElem_=s;var u=e.createElementNS(Mt,"path");u.classList.add(jn("gh")),o.appendChild(u),this.guideHeadElem_=u;var l=e.createElement("div");l.classList.add(Gt("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.refresh()}),[{key:"onDraggingChange_",value:function(t){if(null!==t.rawValue){this.element.classList.add(jn(void 0,"drg"));var e=t.rawValue/this.props_.get("pointerScale"),n=e+(e>0?-1:e<0?1:0),r=ot(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",["M ".concat(n+r,",0 L").concat(n,",4 L").concat(n+r,",8"),"M ".concat(e,",-1 L").concat(e,",9")].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d","M 0,4 L".concat(e,",4"));var i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue),this.tooltipElem_.style.left="".concat(e,"px")}else this.element.classList.remove(jn(void 0,"drg"))}},{key:"refresh",value:function(){var t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}},{key:"onChange_",value:function(){this.refresh()}}]),Mn=o((function t(e,n){var i;r(this,t),this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=n.parser,this.props=n.props,this.sliderProps_=null!==(i=n.sliderProps)&&void 0!==i?i:null,this.value=n.value,this.viewProps=n.viewProps,this.dragging_=M(null),this.view=new On(e,{arrayPosition:n.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);var a=new Vn(this.view.knobElement);a.emitter.on("down",this.onPointerDown_),a.emitter.on("move",this.onPointerMove_),a.emitter.on("up",this.onPointerUp_)}),[{key:"constrainValue_",value:function(t){var e,n,r=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("min"),i=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("max"),a=t;return void 0!==r&&(a=Math.max(a,r)),void 0!==i&&(a=Math.min(a,i)),a}},{key:"onInputChange_",value:function(t){var e=t.currentTarget.value,n=this.parser_(e);y(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}},{key:"onInputKeyDown_",value:function(t){var e=Cn(this.props.get("keyScale"),En(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}},{key:"onInputKeyUp_",value:function(t){0!==Cn(this.props.get("keyScale"),En(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},{key:"onPointerDown_",value:function(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}},{key:"computeDraggingValue_",value:function(t){if(!t.point)return null;var e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}},{key:"onPointerMove_",value:function(t){var e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}},{key:"onPointerUp_",value:function(t){var e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}]),Dn=Gt("sld"),Tn=o((function t(e,n){r(this,t),this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Dn()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("div");i.classList.add(Dn("t")),n.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;var a=e.createElement("div");a.classList.add(Dn("k")),this.trackElement.appendChild(a),this.knobElement=a,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.update_()}),[{key:"update_",value:function(){var t=ot(it(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width="".concat(t,"%")}},{key:"onChange_",value:function(){this.update_()}}]),Bn=o((function t(e,n){r(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.props=n.props,this.view=new Tn(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}),[{key:"handlePointerEvent_",value:function(t,e){t.point&&this.value.setRawValue(it(ot(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}},{key:"onPointerDownOrMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(t){var e=Cn(this.props.get("keyScale"),An(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}},{key:"onKeyUp_",value:function(t){0!==Cn(this.props.get("keyScale"),An(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),In=Gt("sldtxt"),Rn=o((function t(e,n){r(this,t),this.element=e.createElement("div"),this.element.classList.add(In());var i=e.createElement("div");i.classList.add(In("s")),this.sliderView_=n.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);var a=e.createElement("div");a.classList.add(In("t")),this.textView_=n.textView,a.appendChild(this.textView_.element),this.element.appendChild(a)})),Ln=o((function t(e,n){r(this,t),this.value=n.value,this.viewProps=n.viewProps,this.sliderC_=new Bn(e,{props:n.sliderProps,value:n.value,viewProps:this.viewProps}),this.textC_=new Mn(e,{parser:n.parser,props:n.textProps,sliderProps:n.sliderProps,value:n.value,viewProps:n.viewProps}),this.view=new Rn(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}),[{key:"sliderController",get:function(){return this.sliderC_}},{key:"textController",get:function(){return this.textC_}},{key:"importProps",value:function(t){var e=this;return St(t,null,(function(t){return{max:t.required.number,min:t.required.number}}),(function(t){var n=e.sliderC_.props;return n.set("max",t.max),n.set("min",t.min),!0}))}},{key:"exportProps",value:function(){var t=this.sliderC_.props;return Vt(null,{max:t.get("max"),min:t.get("min")})}}]);function zn(t){return{sliderProps:new D({keyScale:t.keyScale,max:t.max,min:t.min}),textProps:new D({formatter:M(t.formatter),keyScale:t.keyScale,pointerScale:M(t.pointerScale)})}}var Nn={containerUnitSize:"cnt-usz"};function Un(t){return"--".concat(Nn[t])}function Fn(t){return dt(t)}function qn(t){if(_(t))return Pt(t,Fn)}function Kn(t,e){if(t){var n=[],r=ft(t,e);r&&n.push(r);var i=pt(t);return i&&n.push(i),new en(n)}}function Gn(t){if("inline"===t||"popup"===t)return t}function $n(t,e){t.write(e)}var Hn=Gt("ckb"),Yn=o((function t(e,n){r(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Hn()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("label");i.classList.add(Hn("l")),this.element.appendChild(i),this.labelElement=i;var a=e.createElement("input");a.classList.add(Hn("i")),a.type="checkbox",this.labelElement.appendChild(a),this.inputElement=a,n.viewProps.bindDisabled(this.inputElement);var o=e.createElement("div");o.classList.add(Hn("w")),this.labelElement.appendChild(o);var s=Rt(e,"check");o.appendChild(s),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}),[{key:"update_",value:function(){this.inputElement.checked=this.value.rawValue}},{key:"onValueChange_",value:function(){this.update_()}}]),Wn=o((function t(e,n){r(this,t),this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new Yn(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}),[{key:"onInputChange_",value:function(t){var e=t.currentTarget;this.value.rawValue=e.checked,t.preventDefault(),t.stopPropagation()}},{key:"onLabelMouseDown_",value:function(t){t.preventDefault()}}]),Xn=me({id:"input-bool",type:"input",accept:function(t,e){if("boolean"!=typeof t)return null;var n=Pt(e,(function(t){return{options:t.optional.custom(an),readonly:t.optional.constant(!1)}}));return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return bn},constraint:function(t){return e=[],(n=sn(t.params.options))&&e.push(n),new en(e);var e,n},writer:function(t){return $n}},controller:function(t){var e=t.document,n=t.value,r=t.constraint,i=r&&nn(r,rn);return i?new cn(e,{props:new D({options:i.values.value("options")}),value:n,viewProps:t.viewProps}):new Wn(e,{value:n,viewProps:t.viewProps})},api:function(t){return"boolean"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof cn?new Ze(t.controller):null}}),Qn=Gt("col"),Zn=o((function t(e,n){r(this,t),this.element=e.createElement("div"),this.element.classList.add(Qn()),n.foldable.bindExpandedClass(this.element,Qn(void 0,"expanded")),qt(n.foldable,"completed",ue(this.element,Qn(void 0,"cpl")));var i=e.createElement("div");i.classList.add(Qn("h")),this.element.appendChild(i);var a=e.createElement("div");a.classList.add(Qn("s")),i.appendChild(a),this.swatchElement=a;var o=e.createElement("div");if(o.classList.add(Qn("t")),i.appendChild(o),this.textElement=o,"inline"===n.pickerLayout){var s=e.createElement("div");s.classList.add(Qn("p")),this.element.appendChild(s),this.pickerElement=s}else this.pickerElement=null}));function Jn(t,e,n){var r,i,a,o=st(t,360),s=ot(e/100,0,1),u=ot(n/100,0,1),l=u*s,c=l*(1-Math.abs(o/60%2-1)),f=u-l;return o>=0&&o<60?(r=l,i=c,a=0):o>=60&&o<120?(r=c,i=l,a=0):o>=120&&o<180?(r=0,i=l,a=c):o>=180&&o<240?(r=0,i=c,a=l):o>=240&&o<300?(r=c,i=0,a=l):(r=l,i=0,a=c),[255*(r+f),255*(i+f),255*(a+f)]}function tr(t){return[t[0],t[1],t[2]]}function er(t,e){return[t[0],t[1],t[2],e]}var nr={hsl:{hsl:function(t,e,n){return[t,e,n]},hsv:function(t,e,n){var r=n+e*(100-Math.abs(2*n-100))/200;return[t,0!==r?e*(100-Math.abs(2*n-100))/r:0,n+e*(100-Math.abs(2*n-100))/200]},rgb:function(t,e,n){var r,i,a,o=(t%360+360)%360,s=ot(e/100,0,1),u=ot(n/100,0,1),l=(1-Math.abs(2*u-1))*s,c=l*(1-Math.abs(o/60%2-1)),f=u-l/2;return o>=0&&o<60?(r=l,i=c,a=0):o>=60&&o<120?(r=c,i=l,a=0):o>=120&&o<180?(r=0,i=l,a=c):o>=180&&o<240?(r=0,i=c,a=l):o>=240&&o<300?(r=c,i=0,a=l):(r=l,i=0,a=c),[255*(r+f),255*(i+f),255*(a+f)]}},hsv:{hsl:function(t,e,n){var r=100-Math.abs(n*(200-e)/100-100);return[t,0!==r?e*n/r:0,n*(200-e)/200]},hsv:function(t,e,n){return[t,e,n]},rgb:Jn},rgb:{hsl:function(t,e,n){var r=ot(t/255,0,1),i=ot(e/255,0,1),a=ot(n/255,0,1),o=Math.max(r,i,a),s=Math.min(r,i,a),u=o-s,l=0,c=0,f=(s+o)/2;return 0!==u&&(c=u/(1-Math.abs(o+s-1)),l=(l=r===o?(i-a)/u:i===o?2+(a-r)/u:4+(r-i)/u)/6+(l<0?1:0)),[360*l,100*c,100*f]},hsv:function(t,e,n){var r=ot(t/255,0,1),i=ot(e/255,0,1),a=ot(n/255,0,1),o=Math.max(r,i,a),s=o-Math.min(r,i,a);return[0===s?0:o===r?((i-a)/s%6+6)%6*60:o===i?60*((a-r)/s+2):60*((r-i)/s+4),100*(0===o?0:s/o),100*o]},rgb:function(t,e,n){return[t,e,n]}}};function rr(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function ir(t,e,n){var r,i,a,o=rr(e,n);return["rgb"===e?ot(t[0],0,o[0]):(i=t[0],a=o[0],i===a?a:st(i,a)),ot(t[1],0,o[1]),ot(t[2],0,o[2]),ot(null!==(r=t[3])&&void 0!==r?r:1,0,1)]}function ar(t,e,n,r){var i=rr(e,n),a=rr(e,r);return t.map((function(t,e){return t/i[e]*a[e]}))}function or(t,e,n){var r,i=ar(t,e.mode,e.type,"int");return ar((r=nr[e.mode])[n.mode].apply(r,v(i)),n.mode,"int",n.type)}var sr=function(){function t(e,n){r(this,t),this.type="int",this.mode=n,this.comps_=ir(e,n,this.type)}return o(t,[{key:"getComponents",value:function(t){return er(or(tr(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}},{key:"toRgbaObject",value:function(){var t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}],[{key:"black",value:function(){return new t([0,0,0],"rgb")}}])}(),ur=Gt("colp"),lr=o((function t(e,n){r(this,t),this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(ur()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("div");i.classList.add(ur("hsv"));var a=e.createElement("div");a.classList.add(ur("sv")),this.svPaletteView_=n.svPaletteView,a.appendChild(this.svPaletteView_.element),i.appendChild(a);var o=e.createElement("div");o.classList.add(ur("h")),this.hPaletteView_=n.hPaletteView,o.appendChild(this.hPaletteView_.element),i.appendChild(o),this.element.appendChild(i);var s=e.createElement("div");if(s.classList.add(ur("rgb")),this.textsView_=n.textsView,s.appendChild(this.textsView_.element),this.element.appendChild(s),n.alphaViews){this.alphaViews_={palette:n.alphaViews.palette,text:n.alphaViews.text};var u=e.createElement("div");u.classList.add(ur("a"));var l=e.createElement("div");l.classList.add(ur("ap")),l.appendChild(this.alphaViews_.palette.element),u.appendChild(l);var c=e.createElement("div");c.classList.add(ur("at")),c.appendChild(this.alphaViews_.text.element),u.appendChild(c),this.element.appendChild(u)}}),[{key:"allFocusableElements",get:function(){var t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement].concat(v(this.textsView_.inputViews.map((function(t){return t.inputElement}))));return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}]);function cr(t){return"int"===t?"int":"float"===t?"float":void 0}function fr(t){return Pt(t,(function(t){return{color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(cr)}),expanded:t.optional.boolean,picker:t.optional.custom(Gn),readonly:t.optional.constant(!1)}}))}function pr(t){return t?.1:1}function hr(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}var dr=o((function t(e,n){r(this,t),this.type="float",this.mode=n,this.comps_=ir(e,n,this.type)}),[{key:"getComponents",value:function(t){return er(or(tr(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}},{key:"toRgbaObject",value:function(){var t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}]),vr={int:function(t,e){return new sr(t,e)},float:function(t,e){return new dr(t,e)}};function mr(t,e,n){return vr[n](t,e)}function br(t,e){if(t.type===e)return t;if(function(t){return"int"===t.type}(t)&&"float"===e)return r=(n=t).getComponents(),i=rr(n.mode,"int"),new dr([it(r[0],0,i[0],0,1),it(r[1],0,i[1],0,1),it(r[2],0,i[2],0,1),r[3]],n.mode);var n,r,i;if(function(t){return"float"===t.type}(t)&&"int"===e)return function(t){var e=t.getComponents(),n=rr(t.mode,"int");return new sr([Math.round(it(e[0],0,1,0,n[0])),Math.round(it(e[1],0,1,0,n[1])),Math.round(it(e[2],0,1,0,n[2])),e[3]],t.mode)}(t);throw A.shouldNeverHappen()}function gr(t,e){var n=t.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*e,e):Math.min(parseFloat(t),e)}var yr={deg:function(t){return t},grad:function(t){return 360*t/400},rad:function(t){return 360*t/(2*Math.PI)},turn:function(t){return 360*t}};function wr(t){var e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);var n=parseFloat(e[1]),r=e[2];return yr[r](n)}function _r(t){var e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[gr(e[1],255),gr(e[2],255),gr(e[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function xr(t){var e=_r(t);return e?new sr(e,"rgb"):null}function kr(t){var e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[gr(e[1],255),gr(e[2],255),gr(e[3],255),gr(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Cr(t){var e=kr(t);return e?new sr(e,"rgb"):null}function Er(t){var e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[wr(e[1]),gr(e[2],100),gr(e[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Ar(t){var e=Er(t);return e?new sr(e,"hsl"):null}function Pr(t){var e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[wr(e[1]),gr(e[2],100),gr(e[3],100),gr(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Sr(t){var e=Pr(t);return e?new sr(e,"hsl"):null}function Vr(t){var e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];var n=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function jr(t){var e=Vr(t);return e?new sr(e,"rgb"):null}function Or(t){var e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),it(parseInt(e[4]+e[4],16),0,255,0,1)];var n=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),it(parseInt(n[4],16),0,255,0,1)]:null}function Mr(t){var e=Or(t);return e?new sr(e,"rgb"):null}function Dr(t){var e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;var n=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Tr(t){var e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;var n=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}var Br=[{parser:Vr,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Or,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:_r,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:kr,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Er,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Pr,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Dr,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Tr,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Ir(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"int",n=function(t){return Br.reduce((function(e,n){var r=n.parser,i=n.result;return e||(r(t)?i:null)}),null)}(t);return n?"hex"===n.notation&&"float"!==e?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:e}):null:null}function Rr(t){var e=[jr,Mr,xr,Cr,Ar,Sr];e.push(function(t){return function(e){var n=Dr(e);return n?mr(n,"rgb",t):null}}("int"),function(t){return function(e){var n=Tr(e);return n?mr(n,"rgb",t):null}}("int"));var n=function(t){return function(e){return t.reduce((function(t,n){return null!==t?t:n(e)}),null)}}(e);return function(e){var r=n(e);return r?br(r,t):null}}function Lr(t){var e=Rr("int");if("string"!=typeof t)return sr.black();var n=e(t);return null!=n?n:sr.black()}function zr(t){var e=ot(Math.floor(t),0,255).toString(16);return 1===e.length?"0".concat(e):e}function Nr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",n=tr(t.getComponents("rgb")).map(zr).join("");return"".concat(e).concat(n)}function Ur(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",n=t.getComponents("rgb"),r=[n[0],n[1],n[2],255*n[3]].map(zr).join("");return"".concat(e).concat(r)}function Fr(t){var e=rt(0),n=tr(br(t,"int").getComponents("rgb")).map((function(t){return e(t)}));return"rgb(".concat(n.join(", "),")")}function qr(t){var e=rt(2),n=rt(0),r=br(t,"int").getComponents("rgb").map((function(t,r){return(3===r?e:n)(t)}));return"rgba(".concat(r.join(", "),")")}function Kr(t,e){var n=rt("float"===e?2:0),r=["r","g","b"],i=tr(br(t,e).getComponents("rgb")).map((function(t,e){return"".concat(r[e],": ").concat(n(t))}));return"{".concat(i.join(", "),"}")}function Gr(t){return function(e){return Kr(e,t)}}function $r(t,e){var n=rt(2),r=rt("float"===e?2:0),i=["r","g","b","a"],a=br(t,e).getComponents("rgb").map((function(t,e){var a=3===e?n:r;return"".concat(i[e],": ").concat(a(t))}));return"{".concat(a.join(", "),"}")}function Hr(t){return function(e){return $r(e,t)}}var Yr=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Nr},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Ur},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:Fr},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:qr},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){var e=[rt(0),wn,wn],n=tr(br(t,"int").getComponents("hsl")).map((function(t,n){return e[n](t)}));return"hsl(".concat(n.join(", "),")")}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){var e=[rt(0),wn,wn,rt(2)],n=br(t,"int").getComponents("hsl").map((function(t,n){return e[n](t)}));return"hsla(".concat(n.join(", "),")")}}].concat(v(["int","float"].reduce((function(t,e){return[].concat(v(t),[{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Gr(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Hr(e)}])}),[])));function Wr(t){return Yr.reduce((function(e,n){return e||(r=n.format,i=t,r.alpha===i.alpha&&r.mode===i.mode&&r.notation===i.notation&&r.type===i.type?n.stringifier:null);var r,i}),null)}var Xr=Gt("apl"),Qr=o((function t(e,n){r(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Xr()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);var i=e.createElement("div");i.classList.add(Xr("b")),this.element.appendChild(i);var a=e.createElement("div");a.classList.add(Xr("c")),i.appendChild(a),this.colorElem_=a;var o=e.createElement("div");o.classList.add(Xr("m")),this.element.appendChild(o),this.markerElem_=o;var s=e.createElement("div");s.classList.add(Xr("p")),this.markerElem_.appendChild(s),this.previewElem_=s,this.update_()}),[{key:"update_",value:function(){var t=this.value.rawValue,e=t.getComponents("rgb"),n=new sr([e[0],e[1],e[2],0],"rgb"),r=new sr([e[0],e[1],e[2],255],"rgb"),i=["to right",qr(n),qr(r)];this.colorElem_.style.background="linear-gradient(".concat(i.join(","),")"),this.previewElem_.style.backgroundColor=qr(t);var a=it(e[3],0,1,0,100);this.markerElem_.style.left="".concat(a,"%")}},{key:"onValueChange_",value:function(){this.update_()}}]),Zr=o((function t(e,n){r(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new Qr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}),[{key:"handlePointerEvent_",value:function(t,e){if(t.point){var n=t.point.x/t.bounds.width,r=h(this.value.rawValue.getComponents("hsv"),3),i=r[0],a=r[1],o=r[2];this.value.setRawValue(new sr([i,a,o,n],"hsv"),e)}}},{key:"onPointerDown_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(t){var e=Cn(pr(!0),An(t));if(0!==e){var n=h(this.value.rawValue.getComponents("hsv"),4),r=n[0],i=n[1],a=n[2],o=n[3];this.value.setRawValue(new sr([r,i,a,o+e],"hsv"),{forceEmit:!1,last:!1})}}},{key:"onKeyUp_",value:function(t){0!==Cn(pr(!0),An(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),Jr=Gt("coltxt"),ti=o((function t(e,n){var i=this;r(this,t),this.element=e.createElement("div"),this.element.classList.add(Jr()),n.viewProps.bindClassModifiers(this.element);var a=e.createElement("div");a.classList.add(Jr("m")),this.modeElem_=function(t){var e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce((function(e,n){var r=t.createElement("option");return r.textContent=n.text,r.value=n.value,e.appendChild(r),e}),t.createDocumentFragment())),e}(e),this.modeElem_.classList.add(Jr("ms")),a.appendChild(this.modeSelectElement),n.viewProps.bindDisabled(this.modeElem_);var o=e.createElement("div");o.classList.add(Jr("mm")),o.appendChild(Rt(e,"dropdown")),a.appendChild(o),this.element.appendChild(a);var s=e.createElement("div");s.classList.add(Jr("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=n.inputViews,this.applyInputViews_(),Ft(n.mode,(function(t){i.modeElem_.value=t}))}),[{key:"modeSelectElement",get:function(){return this.modeElem_}},{key:"inputViews",get:function(){return this.inputViews_},set:function(t){this.inputViews_=t,this.applyInputViews_()}},{key:"applyInputViews_",value:function(){var t=this;Nt(this.inputsElem_);var e=this.element.ownerDocument;this.inputViews_.forEach((function(n){var r=e.createElement("div");r.classList.add(Jr("c")),r.appendChild(n.element),t.inputsElem_.appendChild(r)}))}}]);function ei(t,e,n){var r=rr(t,e)[n];return new T({min:0,max:r})}function ni(t,e){var n={colorMode:e.colorMode,colorType:e.colorType,parser:tt,viewProps:e.viewProps};return[0,1,2].map((function(r){var i=function(t,e,n){return new Mn(t,{arrayPosition:0===n?"fst":2===n?"lst":"mid",parser:e.parser,props:D.fromObject({formatter:(r=e.colorType,rt("float"===r?2:0)),keyScale:pr(!1),pointerScale:"float"===e.colorType?.01:1}),value:M(0,{constraint:ei(e.colorMode,e.colorType,n)}),viewProps:e.viewProps});var r}(t,n,r);return kn({primary:e.value,secondary:i.value,forward:function(t){return br(t,e.colorType).getComponents(e.colorMode)[r]},backward:function(t,n){var i=e.colorMode,a=br(t,e.colorType).getComponents(i);return a[r]=n,br(mr(er(tr(a),a[3]),i,e.colorType),"int")}}),i}))}var ri=o((function t(e,n){r(this,t),this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=n.colorType,this.value=n.value,this.viewProps=n.viewProps,this.colorMode=M(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new ti(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}),[{key:"createComponentControllers_",value:function(t){var e=this.colorMode.rawValue;return function(t){return"hex"!==t}(e)?ni(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(t,e){var n=new mn(t,{parser:Rr("int"),props:D.fromObject({formatter:Nr}),value:M(sr.black()),viewProps:e.viewProps});return kn({primary:e.value,secondary:n.value,forward:function(t){return new sr(tr(t.getComponents()),t.mode)},backward:function(t,e){return new sr(er(tr(e.getComponents(t.mode)),t.getComponents()[3]),t.mode)}}),[n]}(t,{value:this.value,viewProps:this.viewProps})}},{key:"onModeSelectChange_",value:function(t){var e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((function(t){return t.view}))}}]),ii=Gt("hpl"),ai=o((function t(e,n){r(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(ii()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);var i=e.createElement("div");i.classList.add(ii("c")),this.element.appendChild(i);var a=e.createElement("div");a.classList.add(ii("m")),this.element.appendChild(a),this.markerElem_=a,this.update_()}),[{key:"update_",value:function(){var t=h(this.value.rawValue.getComponents("hsv"),1)[0];this.markerElem_.style.backgroundColor=Fr(new sr([t,100,100],"hsv"));var e=it(t,0,360,0,100);this.markerElem_.style.left="".concat(e,"%")}},{key:"onValueChange_",value:function(){this.update_()}}]),oi=o((function t(e,n){r(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new ai(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}),[{key:"handlePointerEvent_",value:function(t,e){if(t.point){var n=it(ot(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),r=h(this.value.rawValue.getComponents("hsv"),4),i=r[1],a=r[2],o=r[3];this.value.setRawValue(new sr([n,i,a,o],"hsv"),e)}}},{key:"onPointerDown_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(t){var e=Cn(pr(!1),An(t));if(0!==e){var n=h(this.value.rawValue.getComponents("hsv"),4),r=n[0],i=n[1],a=n[2],o=n[3];this.value.setRawValue(new sr([r+e,i,a,o],"hsv"),{forceEmit:!1,last:!1})}}},{key:"onKeyUp_",value:function(t){0!==Cn(pr(!1),An(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),si=Gt("svp"),ui=o((function t(e,n){r(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(si()),n.viewProps.bindClassModifiers(this.element),n.viewProps.bindTabIndex(this.element);var i=e.createElement("canvas");i.height=64,i.width=64,i.classList.add(si("c")),this.element.appendChild(i),this.canvasElement=i;var a=e.createElement("div");a.classList.add(si("m")),this.element.appendChild(a),this.markerElem_=a,this.update_()}),[{key:"update_",value:function(){var t,e,n=(e=(t=this.canvasElement).ownerDocument.defaultView)&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null;if(n){for(var r=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,a=this.canvasElement.height,o=n.getImageData(0,0,i,a),s=o.data,u=0;u<a;u++)for(var l=0;l<i;l++){var c=it(l,0,i,0,100),f=it(u,0,a,100,0),p=Jn(r[0],c,f),h=4*(u*i+l);s[h]=p[0],s[h+1]=p[1],s[h+2]=p[2],s[h+3]=255}n.putImageData(o,0,0);var d=it(r[1],0,100,0,100);this.markerElem_.style.left="".concat(d,"%");var v=it(r[2],0,100,100,0);this.markerElem_.style.top="".concat(v,"%")}}},{key:"onValueChange_",value:function(){this.update_()}}]),li=o((function t(e,n){r(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new ui(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}),[{key:"handlePointerEvent_",value:function(t,e){if(t.point){var n=it(t.point.x,0,t.bounds.width,0,100),r=it(t.point.y,0,t.bounds.height,100,0),i=h(this.value.rawValue.getComponents("hsv"),4),a=i[0],o=i[3];this.value.setRawValue(new sr([a,n,r,o],"hsv"),e)}}},{key:"onPointerDown_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(t){Pn(t.key)&&t.preventDefault();var e=h(this.value.rawValue.getComponents("hsv"),4),n=e[0],r=e[1],i=e[2],a=e[3],o=pr(!1),s=Cn(o,An(t)),u=Cn(o,En(t));0===s&&0===u||this.value.setRawValue(new sr([n,r+s,i+u,a],"hsv"),{forceEmit:!1,last:!1})}},{key:"onKeyUp_",value:function(t){var e=pr(!1),n=Cn(e,An(t)),r=Cn(e,En(t));0===n&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),ci=o((function t(e,n){r(this,t),this.value=n.value,this.viewProps=n.viewProps,this.hPaletteC_=new oi(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new li(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=n.supportsAlpha?{palette:new Zr(e,{value:this.value,viewProps:this.viewProps}),text:new Mn(e,{parser:tt,props:D.fromObject({pointerScale:.01,keyScale:.1,formatter:rt(2)}),value:M(0,{constraint:new T({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&kn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:function(t){return t.getComponents()[3]},backward:function(t,e){var n=t.getComponents();return n[3]=e,new sr(n,t.mode)}}),this.textsC_=new ri(e,{colorType:n.colorType,value:this.value,viewProps:this.viewProps}),this.view=new lr(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:n.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}),[{key:"textsController",get:function(){return this.textsC_}}]),fi=Gt("colsw"),pi=o((function t(e,n){r(this,t),this.onValueChange_=this.onValueChange_.bind(this),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.element=e.createElement("div"),this.element.classList.add(fi()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("div");i.classList.add(fi("sw")),this.element.appendChild(i),this.swatchElem_=i;var a=e.createElement("button");a.classList.add(fi("b")),n.viewProps.bindDisabled(a),this.element.appendChild(a),this.buttonElement=a,this.update_()}),[{key:"update_",value:function(){var t=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ur(t)}},{key:"onValueChange_",value:function(){this.update_()}}]),hi=o((function t(e,n){r(this,t),this.value=n.value,this.viewProps=n.viewProps,this.view=new pi(e,{value:this.value,viewProps:this.viewProps})})),di=o((function t(e,n){var i=this;r(this,t),this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=Pe.create(n.expanded),this.swatchC_=new hi(e,{value:this.value,viewProps:this.viewProps});var a=this.swatchC_.view.buttonElement;a.addEventListener("blur",this.onButtonBlur_),a.addEventListener("click",this.onButtonClick_),this.textC_=new mn(e,{parser:n.parser,props:D.fromObject({formatter:n.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Zn(e,{foldable:this.foldable_,pickerLayout:n.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===n.pickerLayout?new hn(e,{viewProps:this.viewProps}):null;var o=new ci(e,{colorType:n.colorType,supportsAlpha:n.supportsAlpha,value:this.value,viewProps:this.viewProps});o.view.allFocusableElements.forEach((function(t){t.addEventListener("blur",i.onPopupChildBlur_),t.addEventListener("keydown",i.onPopupChildKeydown_)})),this.pickerC_=o,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(o.view.element),kn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:function(t){return t},backward:function(t,e){return e}})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ve(this.foldable_,this.view.pickerElement))}),[{key:"textController",get:function(){return this.textC_}},{key:"onButtonBlur_",value:function(t){if(this.popC_){var e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}}},{key:"onButtonClick_",value:function(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}},{key:"onPopupChildBlur_",value:function(t){if(this.popC_){var e=this.popC_.view.element,n=Ut(t);n&&e.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!Tt(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}}},{key:"onPopupChildKeydown_",value:function(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}]);function vi(t){return tr(t.getComponents("rgb")).reduce((function(t,e){return t<<8|255&Math.floor(e)}),0)}function mi(t){return t.getComponents("rgb").reduce((function(t,e,n){return t<<8|255&Math.floor(3===n?255*e:e)}),0)>>>0}function bi(t){return"number"!=typeof t?sr.black():new sr([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function gi(t){return"number"!=typeof t?sr.black():new sr([(e=t)>>24&255,e>>16&255,e>>8&255,it(255&e,0,255,0,1)],"rgb");var e}function yi(t,e){return"object"===b(t)&&!y(t)&&e in t&&"number"==typeof t[e]}function wi(t){return yi(t,"r")&&yi(t,"g")&&yi(t,"b")}function _i(t){return wi(t)&&yi(t,"a")}function xi(t){return wi(t)}function ki(t,e){if(t.mode!==e.mode)return!1;if(t.type!==e.type)return!1;for(var n=t.getComponents(),r=e.getComponents(),i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0}function Ci(t){return"a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b]}function Ei(t,e){return function(n,r){t?function(t,e,n){var r=br(e,n).toRgbaObject();t.writeProperty("r",r.r),t.writeProperty("g",r.g),t.writeProperty("b",r.b),t.writeProperty("a",r.a)}(n,r,e):function(t,e,n){var r=br(e,n).toRgbaObject();t.writeProperty("r",r.r),t.writeProperty("g",r.g),t.writeProperty("b",r.b)}(n,r,e)}}var Ai=me({id:"input-color-number",type:"input",accept:function(t,e){if("number"!=typeof t)return null;if(!function(t){return"color"in t||"color"===t.view}(e))return null;var n,r,i=fr(e);return i?{initialValue:t,params:Object.assign(Object.assign({},i),{supportsAlpha:(n=e,!!(null===(r=null==n?void 0:n.color)||void 0===r?void 0:r.alpha))})}:null},binding:{reader:function(t){return t.params.supportsAlpha?gi:bi},equals:ki,writer:function(t){return e=t.params.supportsAlpha,n=e?mi:vi,function(t,e){$n(t,n(e))};var e,n}},controller:function(t){var e,n,r;return new di(t.document,{colorType:"int",expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:(r=t.params.supportsAlpha,r?function(t){return Ur(t,"0x")}:function(t){return Nr(t,"0x")}),parser:Rr("int"),pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",supportsAlpha:t.params.supportsAlpha,value:t.value,viewProps:t.viewProps})}});function Pi(t){return function(e){var n=function(t,e){if(!xi(t))return br(sr.black(),e);if("int"===e){var n=Ci(t);return new sr(n,"rgb")}if("float"===e){var r=Ci(t);return new dr(r,"rgb")}return br(sr.black(),"int")}(e,t);return br(n,"int")}}function Si(t,e){return function(n){return t?$r(n,e):Kr(n,e)}}var Vi=me({id:"input-color-object",type:"input",accept:function(t,e){var n;if(!xi(t))return null;var r=fr(e);return r?{initialValue:t,params:Object.assign(Object.assign({},r),{colorType:null!==(n=hr(e))&&void 0!==n?n:"int"})}:null},binding:{reader:function(t){return Pi(t.params.colorType)},equals:ki,writer:function(t){return Ei(_i(t.initialValue),t.params.colorType)}},controller:function(t){var e,n,r=_i(t.initialValue);return new di(t.document,{colorType:t.params.colorType,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:Si(r,t.params.colorType),parser:Rr("int"),pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",supportsAlpha:r,value:t.value,viewProps:t.viewProps})}}),ji=me({id:"input-color-string",type:"input",accept:function(t,e){if("string"!=typeof t)return null;if("text"===e.view)return null;var n=Ir(t,hr(e));if(!n)return null;var r=Wr(n);if(!r)return null;var i=fr(e);return i?{initialValue:t,params:Object.assign(Object.assign({},i),{format:n,stringifier:r})}:null},binding:{reader:function(){return Lr},equals:ki,writer:function(t){var e,n,r=(e=t.params.format,(n=Wr(e))?function(t,e){$n(t,n(e))}:null);if(!r)throw A.notBindable();return r}},controller:function(t){var e,n;return new di(t.document,{colorType:t.params.format.type,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.stringifier,parser:Rr("int"),pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",supportsAlpha:t.params.format.alpha,value:t.value,viewProps:t.viewProps})}}),Oi=o((function t(e){r(this,t),this.components=e.components,this.asm_=e.assembly}),[{key:"constrain",value:function(t){var e=this,n=this.asm_.toComponents(t).map((function(t,n){var r,i;return null!==(i=null===(r=e.components[n])||void 0===r?void 0:r.constrain(t))&&void 0!==i?i:t}));return this.asm_.fromComponents(n)}}]),Mi=Gt("pndtxt"),Di=o((function t(e,n){var i=this;r(this,t),this.textViews=n.textViews,this.element=e.createElement("div"),this.element.classList.add(Mi()),this.textViews.forEach((function(t){var n=e.createElement("div");n.classList.add(Mi("a")),n.appendChild(t.element),i.element.appendChild(n)}))})),Ti=o((function t(e,n){var i=this;r(this,t),this.value=n.value,this.viewProps=n.viewProps,this.acs_=n.axes.map((function(t,r){return function(t,e,n){return new Mn(t,{arrayPosition:0===n?"fst":n===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[n].textProps,value:M(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}(e,n,r)})),this.acs_.forEach((function(t,e){kn({primary:i.value,secondary:t.value,forward:function(t){return n.assembly.toComponents(t)[e]},backward:function(t,r){var i=n.assembly.toComponents(t);return i[e]=r,n.assembly.fromComponents(i)}})})),this.view=new Di(e,{textViews:this.acs_.map((function(t){return t.view}))})}),[{key:"textControllers",get:function(){return this.acs_}}]),Bi=function(t){function e(){return r(this,e),n(this,e,arguments)}return c(e,t),o(e,[{key:"max",get:function(){return this.controller.valueController.sliderController.props.get("max")},set:function(t){this.controller.valueController.sliderController.props.set("max",t)}},{key:"min",get:function(){return this.controller.valueController.sliderController.props.get("min")},set:function(t){this.controller.valueController.sliderController.props.set("min",t)}}])}(xt),Ii=me({id:"input-number",type:"input",accept:function(t,e){if("number"!=typeof t)return null;var n=Pt(e,(function(t){return Object.assign(Object.assign({},dt(t)),{options:t.optional.custom(an),readonly:t.optional.constant(!1)})}));return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return et},constraint:function(t){return function(t,e){var n=[],r=ft(t,e);r&&n.push(r);var i=pt(t);i&&n.push(i);var a=sn(t.options);return a&&n.push(a),new en(n)}(t.params,t.initialValue)},writer:function(t){return $n}},controller:function(t){var e=t.value,n=t.constraint,r=n&&nn(n,rn);if(r)return new cn(t.document,{props:new D({options:r.values.value("options")}),value:e,viewProps:t.viewProps});var i=ht(t.params,e.rawValue),a=n&&nn(n,T);return a?new Ln(t.document,Object.assign(Object.assign({},zn(Object.assign(Object.assign({},i),{keyScale:M(i.keyScale),max:a.values.value("max"),min:a.values.value("min")}))),{parser:tt,value:e,viewProps:t.viewProps})):new Mn(t.document,{parser:tt,props:D.fromObject(i),value:e,viewProps:t.viewProps})},api:function(t){return"number"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Ln?new Bi(t.controller):t.controller.valueController instanceof cn?new Ze(t.controller):null}}),Ri=o((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,t),this.x=e,this.y=n}),[{key:"getComponents",value:function(){return[this.x,this.y]}},{key:"toObject",value:function(){return{x:this.x,y:this.y}}}],[{key:"isObject",value:function(t){if(y(t))return!1;var e=t.x,n=t.y;return"number"==typeof e&&"number"==typeof n}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y}}]),Li={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return i(Ri,v(t))}},zi=Gt("p2d"),Ni=o((function t(e,n){r(this,t),this.element=e.createElement("div"),this.element.classList.add(zi()),n.viewProps.bindClassModifiers(this.element),Ft(n.expanded,ue(this.element,zi(void 0,"expanded")));var i=e.createElement("div");i.classList.add(zi("h")),this.element.appendChild(i);var a=e.createElement("button");a.classList.add(zi("b")),a.appendChild(Rt(e,"p2dpad")),n.viewProps.bindDisabled(a),i.appendChild(a),this.buttonElement=a;var o=e.createElement("div");if(o.classList.add(zi("t")),i.appendChild(o),this.textElement=o,"inline"===n.pickerLayout){var s=e.createElement("div");s.classList.add(zi("p")),this.element.appendChild(s),this.pickerElement=s}else this.pickerElement=null})),Ui=Gt("p2dp"),Fi=o((function t(e,n){r(this,t),this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Ui()),"popup"===n.layout&&this.element.classList.add(Ui(void 0,"p")),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("div");i.classList.add(Ui("p")),n.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;var a=e.createElementNS(Mt,"svg");a.classList.add(Ui("g")),this.padElement.appendChild(a),this.svgElem_=a;var o=e.createElementNS(Mt,"line");o.classList.add(Ui("ax")),o.setAttributeNS(null,"x1","0"),o.setAttributeNS(null,"y1","50%"),o.setAttributeNS(null,"x2","100%"),o.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(o);var s=e.createElementNS(Mt,"line");s.classList.add(Ui("ax")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","0"),s.setAttributeNS(null,"x2","50%"),s.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(s);var u=e.createElementNS(Mt,"line");u.classList.add(Ui("l")),u.setAttributeNS(null,"x1","50%"),u.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(u),this.lineElem_=u;var l=e.createElement("div");l.classList.add(Ui("m")),this.padElement.appendChild(l),this.markerElem_=l,n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}),[{key:"allFocusableElements",get:function(){return[this.padElement]}},{key:"update_",value:function(){var t=h(this.value.rawValue.getComponents(),2),e=t[0],n=t[1],r=this.props_.get("max"),i=it(e,-r,+r,0,100),a=it(n,-r,+r,0,100),o=this.props_.get("invertsY")?100-a:a;this.lineElem_.setAttributeNS(null,"x2","".concat(i,"%")),this.lineElem_.setAttributeNS(null,"y2","".concat(o,"%")),this.markerElem_.style.left="".concat(i,"%"),this.markerElem_.style.top="".concat(o,"%")}},{key:"onValueChange_",value:function(){this.update_()}},{key:"onPropsChange_",value:function(){this.update_()}},{key:"onFoldableChange_",value:function(){this.update_()}}]);function qi(t,e,n){return[Cn(e[0],An(t)),Cn(e[1],En(t))*(n?1:-1)]}var Ki=o((function t(e,n){r(this,t),this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new Fi(e,{layout:n.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}),[{key:"handlePointerEvent_",value:function(t,e){if(t.point){var n=this.props.get("max"),r=it(t.point.x,0,t.bounds.width,-n,+n),i=it(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-n,+n);this.value.setRawValue(new Ri(r,i),e)}}},{key:"onPointerDown_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onPadKeyDown_",value:function(t){Pn(t.key)&&t.preventDefault();var e=h(qi(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY")),2),n=e[0],r=e[1];0===n&&0===r||this.value.setRawValue(new Ri(this.value.rawValue.x+n,this.value.rawValue.y+r),{forceEmit:!1,last:!1})}},{key:"onPadKeyUp_",value:function(t){var e=h(qi(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY")),2),n=e[0],r=e[1];0===n&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),Gi=o((function t(e,n){var i,a,o=this;r(this,t),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=Pe.create(n.expanded),this.popC_="popup"===n.pickerLayout?new hn(e,{viewProps:this.viewProps}):null;var s=new Ki(e,{layout:n.pickerLayout,props:new D({invertsY:M(n.invertsY),max:M(n.max),xKeyScale:n.axes[0].textProps.value("keyScale"),yKeyScale:n.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((function(t){t.addEventListener("blur",o.onPopupChildBlur_),t.addEventListener("keydown",o.onPopupChildKeydown_)})),this.pickerC_=s,this.textC_=new Ti(e,{assembly:Li,axes:n.axes,parser:n.parser,value:this.value,viewProps:this.viewProps}),this.view=new Ni(e,{expanded:this.foldable_.value("expanded"),pickerLayout:n.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("blur",this.onPadButtonBlur_),null===(a=this.view.buttonElement)||void 0===a||a.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),kn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:function(t){return t},backward:function(t,e){return e}})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ve(this.foldable_,this.view.pickerElement))}),[{key:"textController",get:function(){return this.textC_}},{key:"onPadButtonBlur_",value:function(t){if(this.popC_){var e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}}},{key:"onPadButtonClick_",value:function(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}},{key:"onPopupChildBlur_",value:function(t){if(this.popC_){var e=this.popC_.view.element,n=Ut(t);n&&e.contains(n)||n&&n===this.view.buttonElement&&!Tt(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}}},{key:"onPopupChildKeydown_",value:function(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}]);function $i(t){return Ri.isObject(t)?new Ri(t.x,t.y):new Ri}function Hi(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Yi(t,e){var n,r;if(!y(t.min)||!y(t.max))return Math.max(Math.abs(null!==(n=t.min)&&void 0!==n?n:0),Math.abs(null!==(r=t.max)&&void 0!==r?r:0));var i=lt(t);return Math.max(10*Math.abs(i),10*Math.abs(e))}function Wi(t,e){var n,r,i=Yi(k(t,null!==(n=t.x)&&void 0!==n?n:{}),e.x),a=Yi(k(t,null!==(r=t.y)&&void 0!==r?r:{}),e.y);return Math.max(i,a)}function Xi(t){if(!("y"in t))return!1;var e=t.y;return!!e&&"inverted"in e&&!!e.inverted}var Qi=me({id:"input-point2d",type:"input",accept:function(t,e){if(!Ri.isObject(t))return null;var n=Pt(e,(function(t){return Object.assign(Object.assign({},Fn(t)),{expanded:t.optional.boolean,picker:t.optional.custom(Gn),readonly:t.optional.constant(!1),x:t.optional.custom(qn),y:t.optional.object(Object.assign(Object.assign({},Fn(t)),{inverted:t.optional.boolean}))})}));return n?{initialValue:t,params:n}:null},binding:{reader:function(){return $i},constraint:function(t){return e=t.params,n=t.initialValue,new Oi({assembly:Li,components:[Kn(Object.assign(Object.assign({},e),e.x),n.x),Kn(Object.assign(Object.assign({},e),e.y),n.y)]});var e,n},equals:Ri.equals,writer:function(){return Hi}},controller:function(t){var e,n,r=t.document,i=t.value,a=t.constraint,o=[t.params.x,t.params.y];return new Gi(r,{axes:i.rawValue.getComponents().map((function(e,n){var r;return vt({constraint:a.components[n],initialValue:e,params:k(t.params,null!==(r=o[n])&&void 0!==r?r:{})})})),expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,invertsY:Xi(t.params),max:Wi(t.params,i.rawValue),parser:tt,pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",value:i,viewProps:t.viewProps})}}),Zi=o((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,t),this.x=e,this.y=n,this.z=i}),[{key:"getComponents",value:function(){return[this.x,this.y,this.z]}},{key:"toObject",value:function(){return{x:this.x,y:this.y,z:this.z}}}],[{key:"isObject",value:function(t){if(y(t))return!1;var e=t.x,n=t.y,r=t.z;return"number"==typeof e&&"number"==typeof n&&"number"==typeof r}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}}]),Ji={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return i(Zi,v(t))}};function ta(t){return Zi.isObject(t)?new Zi(t.x,t.y,t.z):new Zi}function ea(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}var na=me({id:"input-point3d",type:"input",accept:function(t,e){if(!Zi.isObject(t))return null;var n=Pt(e,(function(t){return Object.assign(Object.assign({},Fn(t)),{readonly:t.optional.constant(!1),x:t.optional.custom(qn),y:t.optional.custom(qn),z:t.optional.custom(qn)})}));return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return ta},constraint:function(t){return e=t.params,n=t.initialValue,new Oi({assembly:Ji,components:[Kn(Object.assign(Object.assign({},e),e.x),n.x),Kn(Object.assign(Object.assign({},e),e.y),n.y),Kn(Object.assign(Object.assign({},e),e.z),n.z)]});var e,n},equals:Zi.equals,writer:function(t){return ea}},controller:function(t){var e=t.value,n=t.constraint,r=[t.params.x,t.params.y,t.params.z];return new Ti(t.document,{assembly:Ji,axes:e.rawValue.getComponents().map((function(e,i){var a;return vt({constraint:n.components[i],initialValue:e,params:k(t.params,null!==(a=r[i])&&void 0!==a?a:{})})})),parser:tt,value:e,viewProps:t.viewProps})}}),ra=o((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r(this,t),this.x=e,this.y=n,this.z=i,this.w=a}),[{key:"getComponents",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"toObject",value:function(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}],[{key:"isObject",value:function(t){if(y(t))return!1;var e=t.x,n=t.y,r=t.z,i=t.w;return"number"==typeof e&&"number"==typeof n&&"number"==typeof r&&"number"==typeof i}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}}]),ia={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return i(ra,v(t))}};function aa(t){return ra.isObject(t)?new ra(t.x,t.y,t.z,t.w):new ra}function oa(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}var sa=me({id:"input-point4d",type:"input",accept:function(t,e){if(!ra.isObject(t))return null;var n=Pt(e,(function(t){return Object.assign(Object.assign({},Fn(t)),{readonly:t.optional.constant(!1),w:t.optional.custom(qn),x:t.optional.custom(qn),y:t.optional.custom(qn),z:t.optional.custom(qn)})}));return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return aa},constraint:function(t){return e=t.params,n=t.initialValue,new Oi({assembly:ia,components:[Kn(Object.assign(Object.assign({},e),e.x),n.x),Kn(Object.assign(Object.assign({},e),e.y),n.y),Kn(Object.assign(Object.assign({},e),e.z),n.z),Kn(Object.assign(Object.assign({},e),e.w),n.w)]});var e,n},equals:ra.equals,writer:function(t){return oa}},controller:function(t){var e=t.value,n=t.constraint,r=[t.params.x,t.params.y,t.params.z,t.params.w];return new Ti(t.document,{assembly:ia,axes:e.rawValue.getComponents().map((function(e,i){var a;return vt({constraint:n.components[i],initialValue:e,params:k(t.params,null!==(a=r[i])&&void 0!==a?a:{})})})),parser:tt,value:e,viewProps:t.viewProps})}}),ua=me({id:"input-string",type:"input",accept:function(t,e){if("string"!=typeof t)return null;var n=Pt(e,(function(t){return{readonly:t.optional.constant(!1),options:t.optional.custom(an)}}));return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return _n},constraint:function(t){return e=[],(n=sn(t.params.options))&&e.push(n),new en(e);var e,n},writer:function(t){return $n}},controller:function(t){var e=t.document,n=t.value,r=t.constraint,i=r&&nn(r,rn);return i?new cn(e,{props:new D({options:i.values.value("options")}),value:n,viewProps:t.viewProps}):new mn(e,{parser:function(t){return t},props:D.fromObject({formatter:xn}),value:n,viewProps:t.viewProps})},api:function(t){return"string"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof cn?new Ze(t.controller):null}}),la={defaultInterval:200,defaultRows:3},ca=Gt("mll"),fa=o((function t(e,n){r(this,t),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=e.createElement("div"),this.element.classList.add(ca()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("textarea");i.classList.add(ca("i")),i.style.height="calc(var(".concat(Un("containerUnitSize"),") * ").concat(n.rows,")"),i.readOnly=!0,n.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}),[{key:"update_",value:function(){var t=this,e=this.textareaElem_,n=e.scrollTop===e.scrollHeight-e.clientHeight,r=[];this.value.rawValue.forEach((function(e){void 0!==e&&r.push(t.formatter_(e))})),e.textContent=r.join("\n"),n&&(e.scrollTop=e.scrollHeight)}},{key:"onValueUpdate_",value:function(){this.update_()}}]),pa=o((function t(e,n){r(this,t),this.value=n.value,this.viewProps=n.viewProps,this.view=new fa(e,{formatter:n.formatter,rows:n.rows,value:this.value,viewProps:this.viewProps})})),ha=Gt("sgl"),da=o((function t(e,n){r(this,t),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=e.createElement("div"),this.element.classList.add(ha()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("input");i.classList.add(ha("i")),i.readOnly=!0,i.type="text",n.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}),[{key:"update_",value:function(){var t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}},{key:"onValueUpdate_",value:function(){this.update_()}}]),va=o((function t(e,n){r(this,t),this.value=n.value,this.viewProps=n.viewProps,this.view=new da(e,{formatter:n.formatter,value:this.value,viewProps:this.viewProps})})),ma=me({id:"monitor-bool",type:"monitor",accept:function(t,e){if("boolean"!=typeof t)return null;var n=Pt(e,(function(t){return{readonly:t.required.constant(!0),rows:t.optional.number}}));return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return bn}},controller:function(t){var e;return 1===t.value.rawValue.length?new va(t.document,{formatter:gn,value:t.value,viewProps:t.viewProps}):new pa(t.document,{formatter:gn,rows:null!==(e=t.params.rows)&&void 0!==e?e:la.defaultRows,value:t.value,viewProps:t.viewProps})}}),ba=function(t){function e(){return r(this,e),n(this,e,arguments)}return c(e,t),o(e,[{key:"max",get:function(){return this.controller.valueController.props.get("max")},set:function(t){this.controller.valueController.props.set("max",t)}},{key:"min",get:function(){return this.controller.valueController.props.get("min")},set:function(t){this.controller.valueController.props.set("min",t)}}])}(xt),ga=Gt("grl"),ya=o((function t(e,n){r(this,t),this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ga()),n.viewProps.bindClassModifiers(this.element),this.formatter_=n.formatter,this.props_=n.props,this.cursor_=n.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);var i=e.createElementNS(Mt,"svg");i.classList.add(ga("g")),i.style.height="calc(var(".concat(Un("containerUnitSize"),") * ").concat(n.rows,")"),this.element.appendChild(i),this.svgElem_=i;var a=e.createElementNS(Mt,"polyline");this.svgElem_.appendChild(a),this.lineElem_=a;var o=e.createElement("div");o.classList.add(ga("t"),Gt("tt")()),this.element.appendChild(o),this.tooltipElem_=o,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}),[{key:"graphElement",get:function(){return this.svgElem_}},{key:"update_",value:function(){var t=this.element,e=t.clientWidth,n=t.clientHeight,r=this.value.rawValue.length-1,i=this.props_.get("min"),a=this.props_.get("max"),o=[];this.value.rawValue.forEach((function(t,s){if(void 0!==t){var u=it(s,0,r,0,e),l=it(t,i,a,n,0);o.push([u,l].join(","))}})),this.lineElem_.setAttributeNS(null,"points",o.join(" "));var s=this.tooltipElem_,u=this.value.rawValue[this.cursor_.rawValue];if(void 0!==u){var l=it(this.cursor_.rawValue,0,r,0,e),c=it(u,i,a,n,0);s.style.left="".concat(l,"px"),s.style.top="".concat(c,"px"),s.textContent="".concat(this.formatter_(u)),s.classList.contains(ga("t","a"))||(s.classList.add(ga("t","a"),ga("t","in")),Dt(s),s.classList.remove(ga("t","in")))}else s.classList.remove(ga("t","a"))}},{key:"onValueUpdate_",value:function(){this.update_()}},{key:"onCursorChange_",value:function(){this.update_()}}]),wa=o((function t(e,n){if(r(this,t),this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.cursor_=M(-1),this.view=new ya(e,{cursor:this.cursor_,formatter:n.formatter,rows:n.rows,props:this.props,value:this.value,viewProps:this.viewProps}),Tt(e)){var i=new Vn(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}),[{key:"importProps",value:function(t){var e=this;return St(t,null,(function(t){return{max:t.required.number,min:t.required.number}}),(function(t){return e.props.set("max",t.max),e.props.set("min",t.min),!0}))}},{key:"exportProps",value:function(){return Vt(null,{max:this.props.get("max"),min:this.props.get("min")})}},{key:"onGraphMouseLeave_",value:function(){this.cursor_.rawValue=-1}},{key:"onGraphMouseMove_",value:function(t){var e=this.view.element.clientWidth;this.cursor_.rawValue=Math.floor(it(t.offsetX,0,e,0,this.value.rawValue.length))}},{key:"onGraphPointerDown_",value:function(t){this.onGraphPointerMove_(t)}},{key:"onGraphPointerMove_",value:function(t){t.data.point?this.cursor_.rawValue=Math.floor(it(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}},{key:"onGraphPointerUp_",value:function(){this.cursor_.rawValue=-1}}]);function _a(t){return y(t.format)?rt(2):t.format}function xa(t){return"graph"===t.view}var ka=me({id:"monitor-number",type:"monitor",accept:function(t,e){if("number"!=typeof t)return null;var n=Pt(e,(function(t){return{format:t.optional.function,max:t.optional.number,min:t.optional.number,readonly:t.required.constant(!0),rows:t.optional.number,view:t.optional.string}}));return n?{initialValue:t,params:n}:null},binding:{defaultBufferSize:function(t){return xa(t)?64:1},reader:function(t){return et}},controller:function(t){return xa(t.params)?function(t){var e,n,r;return new wa(t.document,{formatter:_a(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:la.defaultRows,props:D.fromObject({max:null!==(n=t.params.max)&&void 0!==n?n:100,min:null!==(r=t.params.min)&&void 0!==r?r:0}),value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new va(t.document,{formatter:_a(t.params),value:t.value,viewProps:t.viewProps}):new pa(t.document,{formatter:_a(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:la.defaultRows,value:t.value,viewProps:t.viewProps})}(t)},api:function(t){return t.controller.valueController instanceof wa?new ba(t.controller):null}}),Ca=me({id:"monitor-string",type:"monitor",accept:function(t,e){if("string"!=typeof t)return null;var n=Pt(e,(function(t){return{multiline:t.optional.boolean,readonly:t.required.constant(!0),rows:t.optional.number}}));return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return _n}},controller:function(t){var e,n=t.value;return n.rawValue.length>1||t.params.multiline?new pa(t.document,{formatter:xn,rows:null!==(e=t.params.rows)&&void 0!==e?e:la.defaultRows,value:n,viewProps:t.viewProps}):new va(t.document,{formatter:xn,value:n,viewProps:t.viewProps})}}),Ea=o((function t(){r(this,t),this.map_=new Map}),[{key:"get",value:function(t){var e;return null!==(e=this.map_.get(t))&&void 0!==e?e:null}},{key:"has",value:function(t){return this.map_.has(t)}},{key:"add",value:function(t,e){var n=this;return this.map_.set(t,e),t.viewProps.handleDispose((function(){n.map_.delete(t)})),e}}]),Aa=o((function t(e){r(this,t),this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}),[{key:"read",value:function(){return this.reader_(this.target.read())}},{key:"write",value:function(t){this.writer_(this.target,t)}},{key:"inject",value:function(t){this.write(this.reader_(t))}}]),Pa=o((function t(e){r(this,t),this.target=e.target,this.reader_=e.reader}),[{key:"read",value:function(){return this.reader_(this.target.read())}}]),Sa=o((function t(e){r(this,t),this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}),[{key:"getAll",value:function(){return[].concat(v(this.pluginsMap_.blades),v(this.pluginsMap_.inputs),v(this.pluginsMap_.monitors))}},{key:"register",value:function(t,e){if(!(n=e.core)||n.major!==ve.major)throw A.notCompatible(t,e.id);var n;"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}},{key:"createInput_",value:function(t,e,n){return this.pluginsMap_.inputs.reduce((function(r,i){return null!=r?r:function(t,e){var n,r=t.accept(e.target.read(),e.params);if(y(r))return null;var i={target:e.target,initialValue:r.initialValue,params:r.params},a=Pt(e.params,(function(t){return{disabled:t.optional.boolean,hidden:t.optional.boolean,label:t.optional.string,tag:t.optional.string}})),o=t.binding.reader(i),s=t.binding.constraint?t.binding.constraint(i):void 0,u=new Aa({reader:o,target:e.target,writer:t.binding.writer(i)}),l=new kt(M(o(r.initialValue),{constraint:s,equals:t.binding.equals}),u),c=t.controller({constraint:s,document:e.document,initialValue:r.initialValue,params:r.params,value:l,viewProps:Re.create({disabled:null==a?void 0:a.disabled,hidden:null==a?void 0:a.hidden})});return new ee(e.document,{blade:Ae(),props:D.fromObject({label:"label"in e.params?null!==(n=null==a?void 0:a.label)&&void 0!==n?n:null:e.target.key}),tag:null==a?void 0:a.tag,value:l,valueController:c})}(i,{document:t,target:e,params:n})}),null)}},{key:"createMonitor_",value:function(t,e,n){return this.pluginsMap_.monitors.reduce((function(r,i){return null!=r?r:function(t,e){var n,r,i,a=t.accept(e.target.read(),e.params);if(y(a))return null;var o,s,u={target:e.target,initialValue:a.initialValue,params:a.params},l=Pt(e.params,(function(t){return{bufferSize:t.optional.number,disabled:t.optional.boolean,hidden:t.optional.boolean,interval:t.optional.number,label:t.optional.string}})),c=t.binding.reader(u),f=null!==(r=null!==(n=null==l?void 0:l.bufferSize)&&void 0!==n?n:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(a.params))&&void 0!==r?r:1,p=new ie({binding:new Pa({reader:c,target:e.target}),bufferSize:f,ticker:(o=e.document,s=null==l?void 0:l.interval,0===s?new Je:new tn(o,null!=s?s:la.defaultInterval))}),h=t.controller({document:e.document,params:a.params,value:p,viewProps:Re.create({disabled:null==l?void 0:l.disabled,hidden:null==l?void 0:l.hidden})});return h.viewProps.bindDisabled(p.ticker),h.viewProps.handleDispose((function(){p.ticker.dispose()})),new ae(e.document,{blade:Ae(),props:D.fromObject({label:"label"in e.params?null!==(i=null==l?void 0:l.label)&&void 0!==i?i:null:e.target.key}),value:p,valueController:h})}(i,{document:t,params:n,target:e})}),null)}},{key:"createBinding",value:function(t,e,n){if(y(e.read()))throw new A({context:{key:e.key},type:"nomatchingcontroller"});var r=this.createInput_(t,e,n);if(r)return r;var i=this.createMonitor_(t,e,n);if(i)return i;throw new A({context:{key:e.key},type:"nomatchingcontroller"})}},{key:"createBlade",value:function(t,e){var n=this.pluginsMap_.blades.reduce((function(n,r){return null!=n?n:Qe(r,{document:t,params:e})}),null);if(!n)throw new A({type:"nomatchingview",context:{params:e}});return n}},{key:"createInputBindingApi_",value:function(t){var e=this.pluginsMap_.inputs.reduce((function(e,n){var r,i;return e||(null!==(i=null===(r=n.api)||void 0===r?void 0:r.call(n,{controller:t}))&&void 0!==i?i:null)}),null);return this.apiCache_.add(t,null!=e?e:new xt(t))}},{key:"createMonitorBindingApi_",value:function(t){var e=this.pluginsMap_.monitors.reduce((function(e,n){var r,i;return e||(null!==(i=null===(r=n.api)||void 0===r?void 0:r.call(n,{controller:t}))&&void 0!==i?i:null)}),null);return this.apiCache_.add(t,null!=e?e:new xt(t))}},{key:"createBindingApi",value:function(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(ne(t))return this.createInputBindingApi_(t);if(oe(t))return this.createMonitorBindingApi_(t);throw A.shouldNeverHappen()}},{key:"createApi",value:function(t){var e=this;if(this.apiCache_.has(t))return this.apiCache_.get(t);if(function(t){return jt(t)&&Ot(t.value)}(t))return this.createBindingApi(t);var n=this.pluginsMap_.blades.reduce((function(n,r){return null!=n?n:r.api({controller:t,pool:e})}),null);if(!n)throw A.shouldNeverHappen();return this.apiCache_.add(t,n)}}]),Va=new Ea,ja=function(t){function e(t){var i;return r(this,e),(i=n(this,e,[t])).emitter_=new S,i.controller.value.emitter.on("change",(function(t){i.emitter_.emit("change",new gt(i,t.rawValue))})),i}return c(e,t),o(e,[{key:"label",get:function(){return this.controller.labelController.props.get("label")},set:function(t){this.controller.labelController.props.set("label",t)}},{key:"options",get:function(){return this.controller.valueController.props.get("options")},set:function(t){this.controller.valueController.props.set("options",t)}},{key:"value",get:function(){return this.controller.value.rawValue},set:function(t){this.controller.value.rawValue=t}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t)}),{key:e}),this}},{key:"off",value:function(t,e){return this.emitter_.off(t,e),this}}])}(mt),Oa=function(t){function e(){return r(this,e),n(this,e,arguments)}return c(e,t),o(e)}(mt),Ma=function(t){function e(t){var i;return r(this,e),(i=n(this,e,[t])).emitter_=new S,i.controller.value.emitter.on("change",(function(t){i.emitter_.emit("change",new gt(i,t.rawValue))})),i}return c(e,t),o(e,[{key:"label",get:function(){return this.controller.labelController.props.get("label")},set:function(t){this.controller.labelController.props.set("label",t)}},{key:"max",get:function(){return this.controller.valueController.sliderController.props.get("max")},set:function(t){this.controller.valueController.sliderController.props.set("max",t)}},{key:"min",get:function(){return this.controller.valueController.sliderController.props.get("min")},set:function(t){this.controller.valueController.sliderController.props.set("min",t)}},{key:"value",get:function(){return this.controller.value.rawValue},set:function(t){this.controller.value.rawValue=t}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t)}),{key:e}),this}},{key:"off",value:function(t,e){return this.emitter_.off(t,e),this}}])}(mt),Da=function(t){function e(t){var i;return r(this,e),(i=n(this,e,[t])).emitter_=new S,i.controller.value.emitter.on("change",(function(t){i.emitter_.emit("change",new gt(i,t.rawValue))})),i}return c(e,t),o(e,[{key:"label",get:function(){return this.controller.labelController.props.get("label")},set:function(t){this.controller.labelController.props.set("label",t)}},{key:"formatter",get:function(){return this.controller.valueController.props.get("formatter")},set:function(t){this.controller.valueController.props.set("formatter",t)}},{key:"value",get:function(){return this.controller.value.rawValue},set:function(t){this.controller.value.rawValue=t}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t)}),{key:e}),this}},{key:"off",value:function(t,e){return this.emitter_.off(t,e),this}}])}(mt),Ta={id:"list",type:"blade",core:ve,accept:function(t){var e=Pt(t,(function(t){return{options:t.required.custom(an),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}}));return e?{params:e}:null},controller:function(t){var e=new rn(on(t.params.options)),n=M(t.params.value,{constraint:e}),r=new cn(t.document,{props:new D({options:e.values.value("options")}),value:n,viewProps:t.viewProps});return new Zt(t.document,{blade:t.blade,props:D.fromObject({label:t.params.label}),value:n,valueController:r})},api:function(t){return t.controller instanceof Zt&&t.controller.valueController instanceof cn?new ja(t.controller):null}},Ba=function(t){function e(t,i){return r(this,e),n(this,e,[t,i])}return c(e,t),o(e,[{key:"element",get:function(){return this.controller.view.element}}])}(je),Ia=function(t){function e(t,i){return r(this,e),n(this,e,[t,{expanded:i.expanded,blade:i.blade,props:i.props,root:!0,viewProps:i.viewProps}])}return c(e,t),o(e)}(De),Ra=Gt("spr"),La=o((function t(e,n){r(this,t),this.element=e.createElement("div"),this.element.classList.add(Ra()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("hr");i.classList.add(Ra("r")),this.element.appendChild(i)})),za=function(t){function e(t,i){return r(this,e),n(this,e,[Object.assign(Object.assign({},i),{view:new La(t,{viewProps:i.viewProps})})])}return c(e,t),o(e)}(Qt),Na={id:"separator",type:"blade",core:ve,accept:function(t){var e=Pt(t,(function(t){return{view:t.required.constant("separator")}}));return e?{params:e}:null},controller:function(t){return new za(t.document,{blade:t.blade,viewProps:t.viewProps})},api:function(t){return t.controller instanceof za?new Oa(t.controller):null}},Ua={id:"slider",type:"blade",core:ve,accept:function(t){var e=Pt(t,(function(t){return{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}}));return e?{params:e}:null},controller:function(t){var e,n,r=null!==(e=t.params.value)&&void 0!==e?e:0,i=new T({max:t.params.max,min:t.params.min}),a=M(r,{constraint:i}),o=new Ln(t.document,Object.assign(Object.assign({},zn({formatter:null!==(n=t.params.format)&&void 0!==n?n:nt,keyScale:M(1),max:i.values.value("max"),min:i.values.value("min"),pointerScale:ct(t.params,r)})),{parser:tt,value:a,viewProps:t.viewProps}));return new Zt(t.document,{blade:t.blade,props:D.fromObject({label:t.params.label}),value:a,valueController:o})},api:function(t){return t.controller instanceof Zt&&t.controller.valueController instanceof Ln?new Ma(t.controller):null}},Fa={id:"text",type:"blade",core:ve,accept:function(t){var e=Pt(t,(function(t){return{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}}));return e?{params:e}:null},controller:function(t){var e,n=M(t.params.value),r=new mn(t.document,{parser:t.params.parse,props:D.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:function(t){return String(t)}}),value:n,viewProps:t.viewProps});return new Zt(t.document,{blade:t.blade,props:D.fromObject({label:t.params.label}),value:n,valueController:r})},api:function(t){return t.controller instanceof Zt&&t.controller.valueController instanceof mn?new Da(t.controller):null}},qa=function(t){function e(t){var i,a,o;r(this,e);var s=null!=t?t:{},u=null!==(a=s.document)&&void 0!==a?a:Bt(),l=function(){var t=new Sa(Va);return[Qi,na,sa,ua,Ii,ji,Vi,Ai,Xn,ma,Ca,ka,be,Te,Xe].forEach((function(e){t.register("core",e)})),t}();return(i=n(this,e,[new Ia(u,{expanded:s.expanded,blade:Ae(),props:D.fromObject({title:s.title}),viewProps:Re.create()}),l])).pool_=l,i.containerElem_=null!==(o=s.container)&&void 0!==o?o:function(t){var e=t.createElement("div");return e.classList.add(Gt("dfw")()),t.body&&t.body.appendChild(e),e}(u),i.containerElem_.appendChild(i.element),i.doc_=u,i.usesDefaultWrapper_=!s.container,i.setUpDefaultPlugins_(),i}return c(e,t),o(e,[{key:"document",get:function(){if(!this.doc_)throw A.alreadyDisposed();return this.doc_}},{key:"dispose",value:function(){var t=this.containerElem_;if(!t)throw A.alreadyDisposed();if(this.usesDefaultWrapper_){var n=t.parentElement;n&&n.removeChild(t)}this.containerElem_=null,this.doc_=null,d(e,"dispose",this)([])}},{key:"registerPlugin",value:function(t){var e=this;t.css&&function(t,e,n){if(!t.querySelector("style[data-tp-style=".concat(e,"]"))){var r=t.createElement("style");r.dataset.tpStyle=e,r.textContent=n,t.head.appendChild(r)}}(this.document,"plugin-".concat(t.id),t.css),("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach((function(n){e.pool_.register(t.id,n)}))}},{key:"setUpDefaultPlugins_",value:function(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[Ta,Na,Ua,Xe,Fa]})}}])}(Ba),Ka=new de("4.0.5");t.BladeApi=mt,t.ButtonApi=se,t.FolderApi=je,t.ListBladeApi=ja,t.ListInputBindingApi=Ze,t.Pane=qa,t.Semver=de,t.SeparatorBladeApi=Oa,t.SliderBladeApi=Ma,t.SliderInputBindingApi=Bi,t.TabApi=Ke,t.TabPageApi=Ge,t.TextBladeApi=Da,t.TpChangeEvent=gt,t.VERSION=Ka}(e)}(0,Li.exports)),Li.exports);function Fi(e,n=256){return t.quantize(e,n).map((e=>[(e=t.rgb(e)).r,e.g,e.b,255]))}var qi=function(){if(Ni)return zi;Ni=1,n.thickness=r,n.camberLine=i,n.camberLineSlope=a,n.leadingEdgeRadius=o,n.xUpper=u,n.yUpper=c,n.xLower=s,n.yLower=l,n.evaluate=f,n.parse=e;var t=/^([0-9])([0-9])([0-9]{2})$/;function e(e){if("string"!=typeof e)throw new Error("NACA airfoil code must be a string. Received "+typeof e);var n=e.match(t);if(!n)throw new Error('NACA airfoil expected a string containing a four-digit identifier. Received "'+e+'".');var r=n[1],i=n[2],a=n[3],o=.01*Number(r);return{p:.1*Number(i),m:o,t:.01*Number(a)}}function n(t,n){var p="string"==typeof t?e(t):t;return void 0===n&&(n=1),{thickness:function(t){return r(t,n,p.t)},camberLine:function(t){return i(t,n,p.m,p.p)},camberLineSlope:function(t){return a(t,n,p.m,p.p)},leadingEdgeRadius:function(){return o(p.t,n)},xLower:function(t){return s(t,n,p.m,p.p,p.t)},xUpper:function(t){return u(t,n,p.m,p.p,p.t)},yLower:function(t){return l(t,n,p.m,p.p,p.t)},yUpper:function(t){return c(t,n,p.m,p.p,p.t)},evaluate:function(t){return f(t,n,p.m,p.p,p.t)}}}function r(t,e,n){var r=t/e,i=-.5075*r;return i=r*((i=r*((i=r*(i+1.4215))-1.758))-.63),n*(i+=1.4845*Math.sqrt(r))*e*2}function i(t,e,n,r){var i;return t<r*e?n*t/(r*r)*(2*r-t/e):n*(e-t)/((i=1-r)*i)*(1+t/e-2*r)}function a(t,e,n,r){var i;return t<r*e?2*n/(r*r)*(r-t/e):2*n/((i=1-r)*i)*(r-t/e)}function o(t,e){return 1.1019*t*t*e}function s(t,e,n,i,o){var s=r(t,e,o),u=a(t,e,n,i);return t+.5*s*(u/Math.sqrt(1+u*u))}function u(t,e,n,i,o){var s=r(t,e,o),u=a(t,e,n,i);return t-.5*s*(u/Math.sqrt(1+u*u))}function l(t,e,n,o,s){var u=i(t,e,n,o),l=r(t,e,s),c=a(t,e,n,o);return u-.5*l*(1/Math.sqrt(1+c*c))}function c(t,e,n,o,s){var u=i(t,e,n,o),l=r(t,e,s),c=a(t,e,n,o);return u+.5*l*(1/Math.sqrt(1+c*c))}function f(t,e,n,o,s){var u=i(t,e,n,o),l=.5*r(t,e,s),c=a(t,e,n,o),f=Math.sqrt(1+c*c),p=1/f,h=c/f;return[t-l*h,u+l*p,t+l*h,u-l*p]}return zi=n}();const Ki=1.324717957244746,Gi=1/Ki,$i=1/(Ki*Ki);var Hi,Yi,Wi,Xi,Qi,Zi,Ji,ta,ea,na,ra,ia,aa,oa,sa,ua,la,ca,fa,pa,ha,da,va,ma,ba,ga,ya,wa,_a,xa,ka,Ca,Ea,Aa,Pa,Sa,Va,ja,Oa,Ma,Da,Ta,Ba,Ia,Ra,La,za,Na,Ua,Fa,qa,Ka,Ga,$a,Ha,Ya,Wa,Xa,Qa,Za,Ja,to,eo,no,ro,io,ao,oo,so,uo,lo,co,fo,po,ho,vo,mo,bo,go,yo,wo,_o,xo,ko,Co,Eo,Ao,Po,So,Vo,jo,Oo;function Mo(){return Yi?Hi:(Yi=1,Hi=1e-6)}function Do(){if(Xi)return Wi;return Xi=1,Wi=function(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}}function To(){if(Zi)return Qi;return Zi=1,Qi=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}}function Bo(){if(ta)return Ji;return ta=1,Ji=function(t,e,n){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=n,r}}function Io(){if(na)return ea;return na=1,ea=function(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a);return t},ea}function Ro(){if(ia)return ra;return ia=1,ra=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}}function Lo(){if(oa)return aa;oa=1,aa=function(r,i){var a=t(r[0],r[1],r[2]),o=t(i[0],i[1],i[2]);e(a,a),e(o,o);var s=n(a,o);return s>1?0:Math.acos(s)};var t=Bo(),e=Io(),n=Ro();return aa}function zo(){if(ua)return sa;return ua=1,sa=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}}function No(){if(ca)return la;return ca=1,la=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}}function Uo(){if(pa)return fa;pa=1,fa=function(e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return Math.abs(r-o)<=t*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=t*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-u)<=t*Math.max(1,Math.abs(a),Math.abs(u))};var t=Mo();return fa}function Fo(){if(da)return ha;return da=1,ha=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}}function qo(){if(ma)return va;return ma=1,va=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}}function Ko(){if(ga)return ba;return ga=1,ba=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}}function Go(){if(xa)return _a;return xa=1,_a=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}}function $o(){if(Aa)return Ea;return Aa=1,Ea=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}}function Ho(){if(ja)return Va;return ja=1,Va=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}}function Yo(){if(Ma)return Oa;return Ma=1,Oa=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}}function Wo(){if(Ta)return Da;return Ta=1,Da=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}}function Xo(){if(Ia)return Ba;return Ia=1,Ba=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}}function Qo(){if(La)return Ra;return La=1,Ra=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}}function Zo(){if(Na)return za;return Na=1,za=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}}function Jo(){if(Fa)return Ua;return Fa=1,Ua=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}}function ts(){if(Ka)return qa;return Ka=1,qa=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}}function es(){if(Ya)return Ha;return Ya=1,Ha=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}}function ns(){if(Za)return Qa;return Za=1,Qa=function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}}function rs(){if(no)return eo;return no=1,eo=function(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}}function is(){if(oo)return ao;return oo=1,ao=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}}function as(){if(uo)return so;return uo=1,so=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}}function os(){if(co)return lo;return co=1,lo=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return t[0]=i*u-a*s,t[1]=a*o-r*u,t[2]=r*s-i*o,t}}function ss(){if(po)return fo;return po=1,fo=function(t,e,n,r){var i=e[0],a=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t}}function us(){if(vo)return ho;return vo=1,ho=function(t,e){e=e||1;var n=2*Math.random()*Math.PI,r=2*Math.random()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}}function ls(){if(bo)return mo;return bo=1,mo=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}}function cs(){if(yo)return go;return yo=1,go=function(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}}function fs(){if(_o)return wo;return _o=1,wo=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,f=l*i+u*r-o*a,p=l*a+o*i-s*r,h=-o*r-s*i-u*a;return t[0]=c*l+h*-o+f*-u-p*-s,t[1]=f*l+h*-s+p*-o-c*-u,t[2]=p*l+h*-u+c*-s-f*-o,t}}function ps(){if(ko)return xo;return ko=1,xo=function(t,e,n,r){var i=n[1],a=n[2],o=e[1]-i,s=e[2]-a,u=Math.sin(r),l=Math.cos(r);return t[0]=e[0],t[1]=i+o*l-s*u,t[2]=a+o*u+s*l,t}}function hs(){if(Eo)return Co;return Eo=1,Co=function(t,e,n,r){var i=n[0],a=n[2],o=e[0]-i,s=e[2]-a,u=Math.sin(r),l=Math.cos(r);return t[0]=i+s*u+o*l,t[1]=e[1],t[2]=a+s*l-o*u,t}}function ds(){if(Po)return Ao;return Po=1,Ao=function(t,e,n,r){var i=n[0],a=n[1],o=e[0]-i,s=e[1]-a,u=Math.sin(r),l=Math.cos(r);return t[0]=i+o*l-s*u,t[1]=a+o*u+s*l,t[2]=e[2],t}}function vs(){if(Vo)return So;Vo=1,So=function(e,n,r,i,a,o){var s,u;n||(n=3);r||(r=0);u=i?Math.min(i*n+r,e.length):e.length;for(s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e};var t=Do()();return So}var ms=Oo?jo:(Oo=1,jo={EPSILON:Mo(),create:Do(),clone:To(),angle:Lo(),fromValues:Bo(),copy:zo(),set:No(),equals:Uo(),exactEquals:Fo(),add:qo(),subtract:Ko(),sub:wa?ya:(wa=1,ya=Ko()),multiply:Go(),mul:Ca?ka:(Ca=1,ka=Go()),divide:$o(),div:Sa?Pa:(Sa=1,Pa=$o()),min:Ho(),max:Yo(),floor:Wo(),ceil:Xo(),round:Qo(),scale:Zo(),scaleAndAdd:Jo(),distance:ts(),dist:$a?Ga:($a=1,Ga=ts()),squaredDistance:es(),sqrDist:Xa?Wa:(Xa=1,Wa=es()),length:ns(),len:to?Ja:(to=1,Ja=ns()),squaredLength:rs(),sqrLen:io?ro:(io=1,ro=rs()),negate:is(),inverse:as(),normalize:Io(),dot:Ro(),cross:os(),lerp:ss(),random:us(),transformMat4:ls(),transformMat3:cs(),transformQuat:fs(),rotateX:ps(),rotateY:hs(),rotateZ:ds(),forEach:vs()});const bs="tp";const gs=(ys="txtr",(t,e)=>[bs,"-",ys,"v",t?`_${t}`:"",e?`-${e}`:""].join(""));var ys;class ws{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(gs()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("textarea");n.rows=e.rows,n.cols=22,n.placeholder=e.placeholder,n.classList.add(gs("i")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){this.inputElement.value=this.value_.rawValue}onChange_(){this.refresh()}}class _s{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.rows=e.rows,this.placeholder=e.placeholder,this.view=new ws(t,{value:this.value,viewProps:this.viewProps,rows:this.rows,placeholder:this.placeholder}),this.view.inputElement.addEventListener("keydown",this.onKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputChange_)}onKeyDown_(t){"Enter"===t.key&&t.shiftKey&&t.preventDefault()}onInputChange_(t){if("Enter"===t.key&&t.shiftKey){const e=t.currentTarget.value;this.value.rawValue=e,this.view.refresh()}}}const xs=[{core:{major:2,minor:0,patch:3,prerelease:null},id:"input-template",type:"input",accept(t,e){if("string"!=typeof t)return null;if("textarea"!==e.view)return null;const n=e;return n?{initialValue:t,params:n}:null},binding:{reader:t=>t=>"string"==typeof t?t:"",writer:t=>(t,e)=>{t.write(e)}},controller:t=>new _s(t.document,{value:t.value,rows:t.params.rows??3,placeholder:t.params.placeholder??"Enter text here",viewProps:t.viewProps})}];var ks=Object.freeze({__proto__:null,css:"\n.tp-txtrv{\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n  background-color: rgba(0,0,0,0);\n  border-width: 0;\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  margin: 0;\n  outline: none;\n  padding: 0\n}\n\n.tp-txtrv {\n  background-color: var(--in-bg);\n  border-radius: var(--bld-br);\n  box-sizing: border-box;\n  color: var(--in-fg);\n  font-family: inherit;\n  height: var(--cnt-usz);\n  line-height: var(--cnt-usz);\n  min-width: 0;\n  width: 100%;\n}\n\n.tp-txtrv:hover {\n  background-color: var(--in-bg-h);\n}\n.tp-txtrv:focus {\n  background-color: var(--in-bg-f);\n}\n.tp-txtrv:active{\n  background-color: var(--in-bg-a);\n}\n.tp-txtrv:disabled{\n  opacity: .5;\n}\n.tp-txtrv {\n  display: block;\n  height: auto;\n  padding-bottom: 0;\n  overflow: hidden;\n  position: relative\n}\n.tp-txtrv.tp-v-disabled{\n  opacity: .5;\n}\n.tp-txtrv .tp-txtrv_i{\n  font-family: var(--font-family);\n  background-color: var(--in-bg);\n  border-radius: var(--bld-br);\n  box-sizing: border-box;\n  color: var(--in-fg);\n  font-size: 11px;\n  padding: 4px;\n  line-height: 16px;\n  min-width: 0;\n  width: 100%;\n  border: none;\n  height: 100%;\n  resize: none;\n  margin-bottom: -8px\n}\n.tp-txtrv .tp-txtrv_i:focus{\n  outline: none\n}",id:"textarea",plugins:xs});const Cs=document.createElement("style");document.body.appendChild(Cs),Cs.textContent="\n.tp-dfwv {\n  min-width: 315px;\n}";const Es=window.devicePixelRatio,As=u({extensions:["ANGLE_instanced_arrays","OES_standard_derivatives","OES_texture_float"],pixelRatio:Es}),Ps=window.PARAMS={points:'{\n"foo": "bar"\n}',count:40,closeEnd:!1,alpha:6,kuttaCondition:!0,clustering:!0,m:.04,p:.4,t:.12,c:1,vertexOpacity:1,lineOpacity:.8,lineWidth:1,vertexSize:3,fillOpacity:1,contourOpacity:.1,shadingOpacity:.15,colorscale:"Magma",invertColorscale:!1},Ss=As.texture({data:Fi(t.interpolateMagma,256).flat(),width:256,height:1,min:"linear",mag:"linear"}),Vs=As._gl.canvas,js={x:t.scaleLinear().domain([-.2,1.2]),y:t.scaleLinear().domain([-1,1])},Os=new class{constructor({regl:t,count:e}){this.regl=t,this.count=0,this.panelDataLength=0,this.triFacesCount=0,this.vertexBuffer=null,this.panelData=null,this.solidGeometryBuffer=null}updateGeometry({x:t,y:n}){if(t.length!==n.length)throw new Error("Length mismatch");const r=t.length-1,i=r!==this.count;this.count=r;const a=new Float32Array(2*(r+3)).fill(-1e3);for(let e=0;e<=r;e++)a[2*e+2]=t[e],a[2*e+3]=n[e];i?(this.vertexBuffer&&this.vertexBuffer.destroy(),this.vertexBuffer=this.regl.buffer(a)):this.vertexBuffer.subdata(a);const o=a.subarray(2,2*(r+2)),s=e(o);for(let t=0;t<s.length;t++)s[t]+=1;const u=s.length;i||u!==this.triFacesCount?(this.triElementBuffer&&this.triElementBuffer.destroy(),this.triElementBuffer=this.regl.elements(s)):this.triElementBuffer.subdata(s),this.triFacesCount=u}updateSolution({x:t,y:e},n){const r=t.length-1,i=4*(r+1),a=i!==this.panelDataLength;this.panelDataLength=i;const o=n.shape[0]>r,s=new Float32Array(4*(r+1));for(let n=0;n<r+1;n++)s[4*n]=t[n],s[4*n+1]=e[n];for(let t=0;t<r;t++)s[4*(t+1)+2]=n.get(t),s[4*(t+1)+3]=o?n.get(r):0;a?this.panelData=this.regl.texture({width:r+1,height:1,data:s,min:"nearest",mag:"nearest",wrapS:"clamp",wrapT:"clamp",format:"rgba",type:"float"}):this.panelData.subimage(s)}}({regl:As,count:Ps.count});window.Pane=Ui.Pane;const Ms=new Ui.Pane;Ms.registerPlugin(ks);const Ds=Ms.addFolder({title:"Aerodynamics"}),Ts=Ms.addFolder({title:"Airfoil geometry",expanded:!1}),Bs=Ms.addFolder({title:"Airfoil rendering",expanded:!1}),Is=Ms.addFolder({title:"Pressure field rendering",expanded:!0}),Rs=Ts.addBinding(Ps,"count",{min:3,max:200,step:1,label:"panel count"}),Ls=window.m=Ts.addBinding(Ps,"m",{min:-.2,max:.2,label:"camber (%)"}),zs=Ts.addBinding(Ps,"p",{min:.2,max:.8,label:"max camber loc (%)"}),Ns=Ts.addBinding(Ps,"t",{min:.001,max:.5,label:"thickness (%)"}),Us=Ts.addBinding(Ps,"clustering"),Fs=Ts.addBinding(Ps,"closeEnd",{label:"close end"}),qs=window.pb=Ts.addBinding(Ps,"points",{label:"custom points\n(enter x, y pairs, shift + enter to update)",placeholder:"CSV x,y coords",view:"textarea",multiline:!0,rows:5}),Ks=Ds.addBinding(Ps,"alpha",{min:-20,max:20,step:.05,label:"angle of attack"});Ds.addBinding(Ps,"kuttaCondition",{label:"kutta condition"});const Gs=function(t){return v(t,{vert:"\n    precision highp float;\n    uniform mat4 view;\n\n    #pragma lines: attribute vec2 xy;\n    #pragma lines: position = getPosition(xy);\n    vec4 getPosition(vec2 xy) {\n      if (xy.x < -100.) return vec4(-1);\n      return view * vec4(xy, 0, 1);\n    }\n\n    #pragma lines: width = getWidth();\n    uniform float width;\n    float getWidth() { return width; }\n    ",frag:"\n    precision lowp float;\n    uniform vec4 color;\n    void main () {\n      gl_FragColor = color;\n    }\n    ",uniforms:{color:t.prop("color"),width:(t,e)=>e.lineWidth*t.pixelRatio},depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"}}})}(As),$s=function(t){return t({vert:"\n    precision highp float;\n    uniform mat4 view;\n    uniform float pointSize;\n    attribute vec2 xy;\n    void main () {\n      if (xy.x < -100.) { gl_Position = vec4(1); return; }\n      gl_Position = view * vec4(xy, 0, 1);\n      gl_PointSize = pointSize + 1.0;\n    }",frag:"\n    precision highp float;\n    uniform float pointSize;\n    uniform vec4 color;\n    void main () {\n      float r = length(gl_PointCoord.xy - 0.5) * 2.0 * (pointSize + 1.0);\n      float alpha = smoothstep(pointSize + 1.0, pointSize - 1.0, r);\n      gl_FragColor = vec4(color.rgb, alpha * color.a);\n    }",attributes:{xy:t.prop("vertexBuffer")},depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"}},uniforms:{pointSize:({pixelRatio:t},{pointSize:e=20}={})=>t*e,color:t.prop("color")},primitive:"points",count:t.prop("count")})}(As),Hs=function(t){return t({vert:"\n    precision highp float;\n    attribute vec2 coord;\n    uniform mat4 inverseView;\n    varying vec2 xy;\n    void main () {\n      vec4 uv = vec4(coord, 0, 1);\n      xy = (inverseView * uv).xy;\n      gl_Position = uv;\n    }",frag:(t,{count:e})=>`\n    #extension GL_OES_standard_derivatives : enable\n    precision highp float;\n    varying vec2 xy;\n    uniform sampler2D panelData, colorscale;\n    uniform vec2 vInf;\n    uniform float contourOpacity, shadingOpacity;\n\n    const float pi = ${Math.PI};\n\n    float grid (float parameter, float width, float feather) {\n      float w1 = width - feather * 0.5;\n      float d = fwidth(parameter);\n      return smoothstep(d * (w1 + feather), d * w1, 0.5 - abs(mod(parameter, 1.0) - 0.5));\n    }\n\n    float hypot (vec2 z) {\n      float x = abs(z.x);\n      float y = abs(z.y);\n      float t = min(x, y);\n      x = max(x, y);\n      t = t / x;\n      return x * sqrt(1.0 + t * t);\n    }\n\n    float linearstep(float edge0, float edge1, float x) {\n      return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    }\n\n    float contrastFunction(float x, float power) {\n      x = 2.0 * x - 1.0;\n      return 0.5 + 0.5 * pow(abs(x), power) * sign(x);\n    }\n\n    const float octaveDivisions = 2.0;\n    float shadedContours (float f, float minSpacing, float antialiasWidth, float rampPower, float contourWidth, out float grid) {\n      const int octaves = 8;\n      const float fOctaves = float(octaves);\n      float screenSpaceGrad = length(vec2(dFdx(f), dFdy(f))) / abs(f);\n      float localOctave = log2(screenSpaceGrad * minSpacing) / log2(octaveDivisions);\n      float contourSpacing = pow(octaveDivisions, ceil(localOctave));\n      float plotVar = log2(abs(f)) / contourSpacing;\n      float widthScale = contourSpacing / screenSpaceGrad;\n      float contourSum = 0.0;\n      grid = 0.0;\n      for(int i = 0; i < octaves; i++) {\n        float t = float(i + 1) - fract(localOctave);\n        float weight = smoothstep(0.0, 1.0, t) * smoothstep(fOctaves, fOctaves - 1.0, t);\n        float y = fract(plotVar);\n        contourSum += weight * min(contrastFunction(y, rampPower), (1.0 - y) * 0.5 * widthScale / antialiasWidth);\n\n        grid += weight * linearstep(\n          contourWidth + antialiasWidth,\n          contourWidth - antialiasWidth,\n          (0.5 - abs(fract(plotVar) - 0.5)) * widthScale\n        );\n        widthScale *= octaveDivisions;\n        plotVar /= octaveDivisions;\n      }\n      grid /= fOctaves;\n      return contourSum / fOctaves;\n    }\n\n    void main () {\n      vec4 prev = texture2D(panelData, vec2((float(0) + 0.5) / float(${e+1}), 0.5));\n      vec2 rPrev = xy - prev.xy;\n      vec2 vInduced = vec2(0);\n\n      for (int i = 1; i < ${e+1}; i++) {\n        vec4 next = texture2D(panelData, vec2((float(i) + 0.5) / float(${e+1}), 0.5));\n        vec2 rNext = xy - next.xy;\n        vec2 t = next.xy - prev.xy;\n        float l = length(t);\n        t /= l;\n        vec2 n = vec2(-t.y, t.x);\n        float bij = atan(rPrev.x * rNext.y - rNext.x * rPrev.y, dot(rPrev, rNext));\n        float lograt = 0.5 * log(dot(rNext, rNext) / dot(rPrev, rPrev));\n        float source = next.z;\n        float gamma = next.w;\n        vInduced += source * (-lograt * t + bij * n);\n        vInduced += gamma * (bij * t + lograt * n);\n        prev = next;\n        rPrev = rNext;\n      }\n\n      vec2 v = vInf + (0.5 / pi) * vInduced;\n      float cp = 1.0 - dot(v, v) / dot(vInf, vInf);\n\n      gl_FragColor = texture2D(colorscale, vec2(exp((cp - 1.0) * 0.7), 0.5));\n\n      float g = 0.0;\n      if (shadingOpacity > 1e-4 || contourOpacity > 1e-4) {\n        gl_FragColor.rgb *= 1.0 + shadingOpacity * (shadedContours(1.0 - cp, 8.0, 1.0, 3.0, 1.0, g) - 0.5);\n\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0), g * contourOpacity);\n      }\n    }`,attributes:{coord:[-4,-4,4,-4,0,4]},uniforms:{panelData:t.prop("panelData"),vInf:t.prop("vInf"),colorscale:t.prop("colorscale"),contourOpacity:t.prop("contourOpacity"),shadingOpacity:t.prop("shadingOpacity")},depth:{enable:!1},count:3})}(As),Ys=function(t){return t({vert:"\n    precision highp float;\n    uniform mat4 view;\n    attribute vec2 xy;\n    void main () {\n      gl_Position = view * vec4(xy, 0, 1);\n    }",frag:"\n    precision highp float;\n    uniform vec4 color;\n    void main () {\n      gl_FragColor = color;\n    }",attributes:{xy:t.prop("vertexBuffer")},primitive:"triangles",elements:t.prop("triElementBuffer"),depth:{enable:!1},cull:{enable:!1},uniforms:{color:t.prop("color")},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"}}})}(As);!function(t){const e=nn.create(),n=nn.create();t({context:{view:({viewportWidth:t,viewportHeight:n},{alpha:r})=>{const i=t/n,a=[-.2,1.2];return nn.ortho(e,...a,.5*-(a[1]-a[0])/i,.5*(a[1]-a[0])/i,-1,1),nn.translate(e,e,[.5,0,0]),nn.rotateZ(e,e,-r*Math.PI/180),nn.translate(e,e,[-.5,0,0]),e}},uniforms:{view:t.context("view"),viewInverse:({view:t})=>nn.invert(n,t)}})}(As);const Ws=function(t){b();let e=t({scissor:{enable:!0,box:{x:(t,e)=>t.pixelRatio*e.margin.l,y:(t,e)=>t.pixelRatio*e.margin.b,width:(t,e)=>t.viewportWidth-t.pixelRatio*(e.margin.r+e.margin.l),height:(t,e)=>t.viewportHeight-t.pixelRatio*(e.margin.t+e.margin.b)}},viewport:{x:(t,e)=>t.pixelRatio*e.margin.l,y:(t,e)=>t.pixelRatio*e.margin.b,width:(t,e)=>t.viewportWidth-t.pixelRatio*(e.margin.r+e.margin.l),height:(t,e)=>t.viewportHeight-t.pixelRatio*(e.margin.t+e.margin.b)},uniforms:{viewportResolution:(t,e)=>[t.viewportWidth,t.viewportHeight],framebufferResolution:t=>[t.framebufferWidth,t.framebufferHeight],inverseViewportResolution:(t,e)=>[1/t.viewportWidth,1/t.viewportHeight],inverseFramebufferResolution:t=>[1/t.framebufferWidth,1/t.framebufferHeight],pixelRatio:t.context("pixelRatio")}});return function(t,n){const r=Object.assign({},g);t&&t.margin&&Object.assign(r,t.margin),e({margin:r},n)}}(As),Xs=function(t){const e={view3:Ce.create(),inverseView3:Ce.create(),view:nn.create(),inverseView:nn.create()},n=t({context:{view3:t.prop("view3"),inverseView3:t.prop("inverseView3"),view:t.prop("view"),inverseView:t.prop("inverseView")},uniforms:{view3:t.prop("view3"),inverseView3:t.prop("inverseView3"),view:t.prop("view"),inverseView:t.prop("inverseView")}}),r=function({scales:t,center:n=[.5,0,0],alpha:r}){return sn(e.view3,t),Ce.invert(e.inverseView3,e.view3),dn(e.view,e.view3),nn.translate(e.view,e.view,n),nn.rotateZ(e.view,e.view,-r*Math.PI/180),nn.translate(e.view,e.view,n.map((t=>-t))),nn.invert(e.inverseView,e.view),e};return r.invoke=n,r}(As);Bs.addBinding(Ps,"fillOpacity",{min:0,max:1,label:"fill opacity"}),Bs.addBinding(Ps,"vertexOpacity",{min:0,max:1,label:"point opacity"}),Bs.addBinding(Ps,"vertexSize",{min:1,max:8,label:"point size"}),Bs.addBinding(Ps,"lineOpacity",{min:0,max:1,label:"line opacity"}),Bs.addBinding(Ps,"lineWidth",{min:.5,max:4,label:"line width"}),Is.addBinding(Ps,"contourOpacity",{min:0,max:1,label:"contour opacity"}),Is.addBinding(Ps,"shadingOpacity",{min:0,max:1,label:"shading opacity"});const Qs=Is.addBinding(Ps,"colorscale",{options:Object.fromEntries(["Cividis","Viridis","Inferno","Magma","Plasma","Warm","Cool","CubehelixDefault","Turbo","Rainbow","Sinebow","Blues","Greens","Greys","Oranges","Purples","Reds","BuGn","BuPu","GnBu","OrRd","PuBuGn","PuBu","PuRd","RdPu","YlGnBu","YlGn","YlOrBr","YlOrRd"].map((t=>[t,t]))),view:"text"}),Zs=Is.addBinding(Ps,"invertColorscale",{label:"invert"});let Js,tu=null;function eu(){Js=tu||function({count:t=20,m:e=.04,p:n=.4,t:r=.12,c:i=1,closeEnd:a=!1,clustering:o=!0}={}){const s=[],u=[],l=o?t=>2*t**2/(t**3+1):t=>t;for(let a=0;a<t+1;a++){const o=a>=t/2,c=o?2*a/t:2*(1-a/t),f=l(Math.abs(1-c));s.push(o?qi.xUpper(f,i,e,n,r):qi.xLower(f,i,e,n,r)),u.push(o?qi.yUpper(f,i,e,n,r):qi.yLower(f,i,e,n,r))}if(a){const e=t,[n,r]=function(t,e,n,r,i,a,o,s){const u=(t-n)*(a-s)-(e-r)*(i-o);return[((t*r-e*n)*(i-o)-(t-n)*(i*s-a*o))/u,((t*r-e*n)*(a-s)-(e-r)*(i*s-a*o))/u]}(s[0],u[0],s[1],u[1],s[e],u[e],s[e-1],u[e-1]);s.unshift(n),u.unshift(r),s.push(n),u.push(r)}return{x:s,y:u}}(Ps),Os.updateGeometry(Js);const t=Ii({geometry:Js,vInf:1,...Ps});Os.updateSolution(Js,t),Ps.points=function({x:t,y:e}){const n=t.length,r=[];for(let i=0;i<n;i++)r.push(`${t[i].toFixed(5)}, ${e[i].toFixed(5)}`);return r.join("\n")}(Js),requestAnimationFrame((()=>Ms.refresh()))}const nu=new class{constructor({regl:t,seedCount:e=1e3}){this.regl=t,this.seeds=new Float32Array(2*e),this.seedBuffer=this.regl.buffer(this.seeds)}updateSeeds({matrices:t}){const e=[0,0,0];for(let i=0;i<this.seeds.length;i+=2)r=i/2,(n=e)[0]=(.5+Gi*r)%1,n[1]=(.5+$i*r)%1,e[0]=2*e[0]-1,e[1]=2*e[1]-1,e[2]=0,ms.transformMat4(e,e,t.inverseView),this.seeds[i]=e[0],this.seeds[i+1]=e[1];var n,r;this.seedBuffer.subdata(this.seeds)}}({regl:As});function ru(){As.poll(),Ws({},(()=>{Xs.invoke(iu,(()=>{Hs({...Ps,...Os,vInf:[Math.cos(Ps.alpha*Math.PI/180),Math.sin(Ps.alpha*Math.PI/180)],colorscale:Ss}),Ps.fillOpacity&&Ys({...Os,color:[.1,.1,.1,Ps.fillOpacity]}),Ps.lineOpacity&&Gs({vertexAttributes:{xy:Os.vertexBuffer},vertexCount:Os.count+3,lineWidth:Ps.lineWidth,color:[1,1,1,Ps.lineOpacity],join:"round",cap:"round",joinResolution:4,capResolution:4,insertCaps:!0}),Ps.vertexOpacity&&$s({vertexBuffer:Os.vertexBuffer,count:Os.count+3,pointSize:Ps.vertexSize,color:[1,1,1,Ps.vertexOpacity]})}))}))}[Qs,Zs].forEach((e=>e.on("change",(()=>{const e=Fi(t[`interpolate${Ps.colorscale}`],256);Ps.invertColorscale&&e.reverse(),Ss.subimage(e.flat())})))),qs.on("change",(({value:t})=>{try{tu=function(t){const e=[],n=[],r=t.split(/\r?\n/).map((t=>t.trim().split(/[,\s]+/g).map((t=>parseFloat(t.trim()))))).filter((t=>t.every((t=>isFinite(t))))).flat(),i=Math.floor(r.length/2);for(let t=0;t<i;t++)e.push(r[2*t]),n.push(r[2*t+1]);return{x:e,y:n}}(t)}catch(t){console.error(t)}})),[Ts,Ds].forEach((t=>t.on("change",eu))),[Ts,Ds,Bs,Is].forEach((t=>t.on("change",ru))),Ks.on("change",ou),eu();let iu={};[Fs,Ls,zs,Ns,Rs,Us].forEach((t=>t.on("change",(()=>{tu=null}))));const au=function(t,e){let n=null;return(...r)=>{null===n&&(t(...r),n=setTimeout((()=>{n=null,t(...r)}),e))}}((t=>{nu.updateSeeds({matrices:t}),requestAnimationFrame(ru)}),500);function ou(){js.x.range([0,Vs.width/Es]),js.y.range([Vs.height/Es,0]),l(Vs,js,(function(){iu=Xs({scales:js,...Ps}),au(iu),requestAnimationFrame(ru)}))}ou(),window.addEventListener("resize",ou),Vs.addEventListener("mousemove",(t=>{}))}));
